<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Rohan Alexander</title>
<link>https://rohanalexander.com/blog.html</link>
<atom:link href="https://rohanalexander.com/blog.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.266</generator>
<lastBuildDate>Fri, 17 Dec 2021 05:00:00 GMT</lastBuildDate>
<item>
  <title>What data science can learn from the James Webb Space Telescope</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-12-17-james_webb_space_telescope/james_webb_space_telescope.html</link>
  <description><![CDATA[ 



<p>The slides are <a href="https://rohanalexander.com/pdfs/smile_talk.pdf">here</a>.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Hi, my name is Rohan Alexander. I’m an assistant professor at the University of Toronto in the Faculty of Information and the Department of Statistical Sciences. I’m also the assistant director of CANSSI Ontario, and I’d encourage you all to go to our website - https://canssiontario.utoronto.ca/ - and apply for funding from our programs.</p>
<p>I’d like to thank Josh and Kartheik for the opportunity to talk today.</p>
<p>I know that it’s an auspicious time for all you astronomy-inclined folks with the imminent launch of the James Webb Space Telescope, so I appreciate you coming to listen to me. Hopefully in a year, I can come back and you can tell me about all the wonderful datasets James Webb has provided all of you.</p>
<p>Today I’d like to talk a little about what I see data science as, and why I think astronomers are so good at it; and then talk about a few examples of my work, focusing more on sharing my process and what I learnt, rather than the work itself; and finally close with some open questions.</p>
<p>None of what I’m about to say is cannon, this talk is more my way of trying to work out what I think, so I’d appreciate your reactions and comments.</p>
</section>
<section id="what-is-data-science" class="level2">
<h2 class="anchored" data-anchor-id="what-is-data-science">What is data science?</h2>
<p>When we think about data science, I think that we all have different things in mind.</p>
<p>The only thing that is certain, is that there is no agreed definition of data science, but a lot of people have tried. For instance, <span class="citation" data-cites="hads">Wickham and Grolemund (2016)</span> say it is ‘…an exciting discipline that allows you to turn raw data into understanding, insight, and knowledge.’ Similarly, <span class="citation" data-cites="leekpeng">Leek and Peng (2020)</span> say it is ‘…the process of formulating a quantitative question that can be answered with data, collecting and cleaning the data, analyzing the data, and communicating the answer to the question to a relevant audience.’ <span class="citation" data-cites="nick">Benjamin S. Baumer and Horton (2021)</span> say it is ‘…the science of extracting meaningful information from data.’ And <span class="citation" data-cites="tiffany">Timbers, Campbell, and Lee (2021)</span> say they define ‘data science as the process of generating insight from data through reproducible and auditable processes’.</p>
<p><span class="citation" data-cites="Craiu2019Hiring">Craiu (2019)</span>, who is one of Josh’s bosses and also one of mine, argues that the lack of certainty as to what data science is, might not matter because ‘…who can really say what makes someone a poet or a scientist?’ He goes on to broadly say that a data scientist is ‘…someone with a data driven research agenda, who adheres to or aspires to using a principled implementation of statistical methods and uses efficient computation skills.’</p>
<p>Regardless of who is right, alongside those specific, more-technical, definitions, there is value in having a simple definition, even if we lose a bit of specificity. For instance, probability is often informally defined as ‘counting things’ <span class="citation" data-cites="richard">(McElreath 2020, 10)</span>. In a similar informal sense, data science can be defined as something like: ‘humans measuring stuff, typically related to other humans, and using sophisticated averaging to explain and predict’.</p>
<p>That may sound a touch cute, but Francis Edgeworth, the nineteenth century statistician and economist considered statistics to be the science ‘of those Means which are presented by social phenomena,’ so it is in good company <span class="citation" data-cites="edgeworth1885methods">(Edgeworth 1885)</span>.</p>
<p>In any case, one feature of this definition is that it does not treat data as <em>terra nullius</em>, or nobody’s land. Statisticians tend to see data as the result of some process that we can never know, but that we try to use data to come to understand. Many statisticians care deeply about data and measurement, but there are many cases in statistics where data kind of just appear; they belong to no one. But that is never actually the case.</p>
<p>Data must be gathered, cleaned, and prepared, and these decisions matter. Every dataset is <em>sui generis</em>, or a class by itself, and so when you come to know one dataset well, you just know one dataset, not all datasets.</p>
<p>In my experience, this fact is ingrained into astronomers. My guess is that it’s because most of you get into astronomy being the actual data collectors - that is, you loved looking at the sky through telescopes when you were a kid. Eventually you got more sophisticated and layered on physics and math, but I think that astronomers make such great data scientists because you’re fundamentally lashed to the data collection process.</p>
<p>More broadly, I think that much of data science focuses on the ‘science,’ but it is important that we also focus on ‘data.’ And that is another feature of my cutesy definition of data science which I posited before. A lot of data scientists are generalists, who are interested in a broad range of problems. Often, the thing that unites these is the need to gather, clean, and prepare messy data. And often it is the specifics of those data that require the most time, that update most often, and that are worthy of our most full attention. Unfortunately, it’s not typically the type of thing that is professionally rewarded.</p>
</section>
<section id="astronomical-origins" class="level2">
<h2 class="anchored" data-anchor-id="astronomical-origins">Astronomical origins</h2>
<p>At this point I’d like to look back, for a moment, at the origins of data science. As astronomers, I know that you all are used to looking back in time. My PhD is in economic history, so I’m also very keen on looking back in time also, although usually only decades or centuries, rather than the billions of years that you all tend to look back! Anyway, if we look at the history of statistics, we very quickly find ourselves in astronomy.</p>
<p>For instance, speaking about the development of least squares in the 1700s, <span class="citation" data-cites="stigler">Stigler (1986, 16)</span> describes how it was associated with the following problems:</p>
<ol type="1">
<li>Determining the motion of the moon in a way that takes into account minor perturbations.</li>
<li>Reconciling the non periodic motion of Jupiter and Saturn.</li>
<li>Determining the shape of the earth.</li>
</ol>
<p>The very stuff of astronomy!</p>
<p>In the work associated with least squares, we see statistical names that we still speak of today including Euler, Gauss, and Laplace. But it may be of interest to you all as astronomers that <span class="citation" data-cites="stigler">Stigler (1986)</span> describes the papers at the time as ‘a story of statistical success (by a major astronomer, Mayer (Figure @ref(fig:iceberg)) and statistical failure (by a leading mathematician, Euler)’!</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-12-17-james_webb_space_telescope/stigler.png" class="quarto-discovered-preview-image img-fluid figure-img" style="width:85.0%"></p>
<p></p><figcaption class="figure-caption">Example of Mayer from Stigler, 1986</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The fundamental issue at the time with least squares was that of hesitancy to combine different observations. These days, we just take this for granted and do it without thinking much about it. But if one steps back for a moment, one quickly sees why this was such a mental leap. And again, here we have astronomers, as you are so immersed in your data, as bringing a unique perspective.</p>
<p>Comparing Euler and Mayer, <span class="citation" data-cites="stigler">Stigler (1986, 28)</span> says:</p>
<blockquote class="blockquote">
<p>The two men brought absolutely first-rate intellects to bear on their respective problems, and both problems were in astronomy. Yet there was an essential conceptual difference in their approaches that made it impossible for Euler’…. The differences were these: Mayer approached his problem as a practical astronomer, dealing with observations that he himself had made under what he considered essentially similar observational conditions, despite the differing astronomical conditions. Euler, on the other hand, approached his problem as a mathematician, dealing with observations made by others over several centuries under unknown observational conditions. Mayer could regard errors, or variation, in his observations as random’… and he could take the step of aggregating equations without fear that bad observations would contaminate good ones’…. Euler could not bring himself to accept such a view with respect to his data. He ‘… [took] the mathematician’s view that errors actually increase with aggregation rather than taking the statistician’s view [and here Stigler should actually also add astronomers] that random errors tend to cancel one another.’…</p>
</blockquote>
<p>On the other hand, <span class="citation" data-cites="stigler">Stigler (1986)</span> criticism of Mayer is that ‘…He made no attempt to describe his calculation as a method that would be useful in other problems. He did not do what Legendre did, namely, abstract the method from the application where it first appeared.’ Namely astronomy!</p>
<p>In any case, by around 1800, least squares became more widely appreciated. But, oddly, not in my own area of interest—namely social sciences, where we would take another 70 or 80 years, a veritable lifetime, before we widely applied it.</p>
<p>Before we return to the present, I’d be remiss if I didn’t mention one final historical astronomer, Quetelet. In this talk I’m arguing that it is your foundation in data gathering that makes you such great data scientists. And this is going to be an example where that feature held back social sciences.</p>
<p>Quetelet was a Belgium astronomer, but he also had social sciences interests and made foundational contributions in terms of the ‘average man’ and ‘fitting distributions’. I’d like to touch on a circumstance where his being deeply involved in the data was a handicap.</p>
<p><span class="citation" data-cites="stigler">Stigler (1986, 163)</span> describes how by 1826 Quetelet had become involved in the statistical bureau, and they were planning for a census. As some of you who have taken courses with my wife, Monica Alexander, know, the foundation of demography is births, deaths, and migration. Quetelet argued that births and deaths had been taken care of, but migration had not. He proposed a ratio estimator based on counts in specific geographies—think provinces—which could then be scaled up to the whole country. There was various criticism of this plan, mostly focused on how one could possibly pick appropriate geographies, and Stigler describes how Quetelet then changed his mind.</p>
<p><span class="citation" data-cites="stigler">Stigler (1986)</span> continues</p>
<blockquote class="blockquote">
<p>He [Quetelet] was acutely aware of the infinite number of factors that could affect the quantities he wished to measure, and he lacked the information that could tell him which were indeed important. He, like the generation of social scientists to follow, was reluctant to group together as homogenous, data that he had reason to believe was not’…. In some respects, Quetelet’s view of his social data was like Euler’s view of astronomical data. To be aware of a myriad of potentially important factors, without knowing which are truly important and how their effect may be felt, is often to fear the worst’…. He [Quetelet] could not bring himself to treat large regions as homogeneous, [and so] he could not think of a single rate as applying to a large area’… Astronomers had overcome a similar case of intellectual cold feet in the previous century by comparing observations with fact, by comparing prediction with realization. Success had bolstered confidence in the combination of observations. Social scientists were to require massive empirical data gathered under a wide variety of circumstances before they gained the astronomers’ confidence that the quantities they measured were of sufficient stability that the uncertainty of the estimates was itself susceptible to measurement.</p>
</blockquote>
</section>
<section id="on-balance-between-data-and-science" class="level2">
<h2 class="anchored" data-anchor-id="on-balance-between-data-and-science">On balance between data and science</h2>
<p>Returning to the present, as I’ve been saying, one of the reasons that I think astronomers make such great data scientists, is that you are used to knowing that your data is a biased sample that comes to you via instruments—in your case telescopes.</p>
<p>We always use various instruments to turn the world into data. In astronomy, the development of better telescopes, and eventually satellites and probes, and soon, hopefully, James Webb, enabled new understanding of other worlds. For instance, returning to history again for just a moment, Stigler (1986, p.25) describes how knowledge of that second problem that I mentioned—Jupiter/Saturn non-periodic motion—was ‘due to improved accuracy of astronomical observations’. Returning to the present day, we similarly have new instruments for turning our own world into data being developed each day.</p>
<p>In the social sciences, a census was once a generational-defining event. And it’s appropriate that this talk happens near the Christmas holidays given the role that the census played in that event. But now we have regular surveys, transactions data available by the second, and almost all interactions on the internet become data of some kind. The development of such instruments has enabled exciting new stories to be told with data.</p>
<p>The telescope that we all hope is launching soon—James Webb—has a unique feature, compared with its predecessor in popular imagination - Hubble. And that feature is that it will be sent to L2. My understanding, and please correct me after the talk if I’m wrong, is that the defining feature of L2 is that the Earth’s gravity and the Sun’s gravity and the moon to a certain extent, effectively hold objects there without much in the way of rocket thrust being needed. So the side of the telescope with the instrumentation that needs to be kept cold and dark, can more easily always be kept cold and dark. And so, in this case James Webb can stay there for about 10 years, focusing on answering big questions, without much in the way of needing to worry about pointing the wrong way. We should all be so lucky!</p>
<p>In a way, for James Webb, being at L2 is all about getting the balance right so that it can focus on answering big questions. And I think for the past ten years or so, we’ve had the balance wrong in data science. There has been too much focus on the ‘science’ bit, without sufficient focus on the ‘data’ bit. And we all know what happens when you go too close to the sun.</p>
<p>It is not just the ‘science’ bit that is hard, it is the ‘data’ bit as well. I feel that Foster would have known this, and we are just reinventing things. For instance, researchers went back and examined one of the most popular text datasets in computer science, and they found that around 30 per cent of the data were inappropriately duplicated <span class="citation" data-cites="bandy2021addressing">(Bandy and Vincent 2021)</span>. There is an entire field—linguistics—that specialises in these types of datasets, and inappropriate use of data is one of the dangers of any one field being hegemonic. The strength of data science is that it brings together folks with a variety of backgrounds and training to the task of learning about some dataset. It is not constrained by what was done in the past. But this means that we must go out of our way to show respect for those who do not come from our own tradition, but who are nonetheless as similarly interested in a dataset, or in a question, as we are.</p>
<p>I’m picking on CS a little here, but my home of the social sciences is just as bad and researchers like me are trying to refocus us on data a little more than we have been in the past.</p>
<p>So what are some examples of things that I work on?</p>
</section>
<section id="examples-of-my-work" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-my-work">Examples of my work</h2>
<p>I mentioned that my PhD is in economic history, but I spent most of my PhD trying to deal with big text datasets. And when I say ‘dealing’ I mean using R to clean and tidy them, which was the work of years. My supervisors—John Tang, Tim Hatton, Martine Mariotti, and Zach Ward—gave me the freedom to do what I wanted, with regular weekly meetings. It’s not a topic that traditionally would have been appropriate in economics, and I’m grateful they gave me the space because traditional economics is not for me, but data science is.</p>
<section id="effect-of-elections-and-changed-prime-ministers" class="level3">
<h3 class="anchored" data-anchor-id="effect-of-elections-and-changed-prime-ministers">Effect of elections and changed prime ministers</h3>
<p>One result of this work was the paper—<em>The Increased Effect of Elections and Changing Prime Ministers on Topics Discussed in the Australian Federal Parliament between 1901 and 2018</em>—<span class="citation" data-cites="alexander2021increased">(Alexander and Alexander 2021)</span> which was co-authored with my wife Monica. In Australia there is a written record of what is said in parliament called Hansard. We grabbed the text of everything said between 1901 and 2018 and then built a statistical model to look at whether the topics of discussion changed when there was an election or when there was a change in the prime minister. We found that changes in prime minister tend to be associated with topic changes even when the party in power does not change; and the effect of elections has been increasing since the 1980s, regardless of whether the election results in a change of prime minister.</p>
<section id="lesson-always-start-small-and-then-iterate." class="level4">
<h4 class="anchored" data-anchor-id="lesson-always-start-small-and-then-iterate.">Lesson: Always start small and then iterate.</h4>
<p>I came to that paper hopelessly naive and lost. I didn’t know that text analysis, and natural language processing more generally, was something that was incredibly popular. I didn’t have the skills that I needed, and really all I had was an all-consuming interest in the broad area—I didn’t even have a question. The dataset has over a billion words in it. So the main lesson for me was in dealing with big datasets. And here I don’t mean in terms of technical skills, I mean in terms of approach. These days when I have students and they want to use the Hansard or any large dataset, I start by insisting that they just use one month of data. After they analyse and write that up, then they can go to a year, and then they can continue to build up slowly.</p>
<p>The reason that I know now that’s the best way to go is that I somehow convinced myself that I couldn’t possibly answer any interesting questions until I had a century worth of data. And because I was teaching myself everything as I went, it took me more than a year to just get the data into a usable format.</p>
<p>If you take nothing away from this talk, please I beg you take this away: the most important, vital thing, is that you create a minimal viable product of any research. And that minimal viable product needs to be something that you can finish within a week. If you can’t do that then adjust the scope and the question until you can. Then you achieve that MVP and then you start to scale up to the question that you’re interested in, which is hopefully something that can be published.</p>
</section>
</section>
<section id="explaining-why-text-is-sexist-or-racist-with-gpt-3" class="level3">
<h3 class="anchored" data-anchor-id="explaining-why-text-is-sexist-or-racist-with-gpt-3">Explaining Why Text is Sexist or Racist with GPT-3</h3>
<p>As anyone who has cared for young children knows, the response to almost any statement can be ‘why?’. One can quickly find oneself trying to explain the finer details of photosynthesis to a 3-year-old, and the extent to which one struggles with this tends to put in sharp relief the extent of one’s knowledge. Large language models such as OpenAI’s GPT-3 can generate text that is indistinguishable from that created by humans. They can also classify whether some given text is sexist or racist <span class="citation" data-cites="chiu2021detecting">(Chiu and Alexander 2021)</span>.</p>
<p>In the paper—<em>Explaining Why Text is Sexist or Racist with GPT-3</em>—which was co-authored by Ke-Li Chiu we assess the extent to which GPT-3 can generate explanations for why a given text is sexist or racist. We prompt GPT-3 to generate explanations in a question-and-answer manner: ‘Is the following statement in quotes sexist? Answer yes or no and explain why.’ We then assess the adequacy of the explanations generated by GPT-3. We are interested in firstly, the extent to which it correctly classifies whether the statements are sexist/racist; and secondly, the reasonableness of the explanation that accompanies that classification.</p>
<p>We find that GPT-3 does poorly in the open-ended approach. When we add more structure to guide its responses the model performs better. But even when it correctly classifies racism or sexism, the accompanying explanations are often inaccurate. At times they even contradict the classification. On a technical level, we find a clear relationship between the hyper-parameter temperature and the number of correctly matched attributes, with substantial decreases as temperature increases.</p>
<section id="lesson-always-teach" class="level4">
<h4 class="anchored" data-anchor-id="lesson-always-teach">Lesson: Always teach</h4>
<p>I just used a bunch of terms there and you probably assume that I know what they mean. In writing the paper that preceded this one, I actually fooled myself into thinking that I knew what they meant. It wasn’t until I tried to teach the material that I realised that I didn’t have a clue what was going on.</p>
<p>A lot of my colleagues try to get out of teaching, and I can understand why they would think that, but I’ve found that having to teach has made me a better researcher. For one reason, I found that it’s too easy to fool yourself into thinking you know something until you have to explain it. And I also kind of think that a lot of us in academia need pressure, constraints, and a weekly structure, in order to do our best work.</p>
</section>
</section>
<section id="reproducibility-of-covid-19-pre-prints" class="level3">
<h3 class="anchored" data-anchor-id="reproducibility-of-covid-19-pre-prints">Reproducibility of COVID-19 pre-prints</h3>
<p>The final paper that I’d like to touch on is—<em>Reproducibility of COVID-19 pre-prints</em>—by Annie Collins and me <span class="citation" data-cites="collins2021reproducibility">(Collins and Alexander 2021)</span>. In that paper we are interested in the reproducibility of COVID-19 research. We create a dataset of pre-prints posted to arXiv, bioRxiv, medRxiv, and SocArXiv between 28 January 2020 and 30 June 2021 that are related to COVID-19. We extract the text from these pre-prints and parse them looking for keyword markers signalling the availability of the data and code underpinning the pre-print. For the pre-prints that are in our sample, we are unable to find markers of either open data or open code for 75 per cent of those on arXiv, 67 per cent of those on bioRxiv, 79 per cent of those on medRxiv, and 85 per cent of those on SocArXiv. We conclude that there may be value in having authors categorize the degree of openness of their pre-print as part of the pre-print submissions process, and more broadly, there is a need to better integrate open science training into a wide range of fields.</p>
<section id="lesson-you-always-need-the-code-more-than-once" class="level4">
<h4 class="anchored" data-anchor-id="lesson-you-always-need-the-code-more-than-once">Lesson: You always need the code more than once</h4>
<p>I went into that paper thinking that I’d just quickly write some code to download some files and then be done with it. But then Annie wanted to broaden the scope of the paper, so the code needed to be re-written because she couldn’t understand what I’d done. And then we had to re-run the code because we wanted to update everything before she presented the paper. And that meant re-writing things. And then we to re-run the code before we submitted the paper. Again that meant re-writing things.</p>
<p>We eventually just turned the code into an R package, which is on CRAN as <a href="https://rohanalexander.github.io/heapsofpapers/">heapsofpapers</a> <span class="citation" data-cites="heaps">(Alexander and Mahfouz 2021)</span>. Which is what I should have done from the start. The lesson that I learnt from this paper is that regardless of how certain you are that you’ll never use some particular code again, you’ll always need it.</p>
</section>
</section>
</section>
<section id="open-questions" class="level2">
<h2 class="anchored" data-anchor-id="open-questions">Open questions</h2>
<section id="how-do-we-write-unit-tests-for-data-science" class="level3">
<h3 class="anchored" data-anchor-id="how-do-we-write-unit-tests-for-data-science">How do we write unit tests for data science?</h3>
<p>One thing that working with real computer scientists has taught me is the importance of unit tests. Basically this just means writing down the small checks that we do in our heads all the time. Like if we have a column that purports to the year, then it’s unlikely that it’s a character, and it’s unlikely that it’s an integer larger than 2500, and it’s unlikely that it’s a negative integer. We know all this, but writing unit tests has us write this all down.</p>
<p>In this case it’s obvious what the unit test looks like. But more generally, we often have little idea what our results should look like if they’re running well. The approach that I’ve taken is to add simulation—so we simulate reasonable results, write unit tests based on that, and then bring the real data to bear and adjust as necessary. But I really think that we need extensive work in this area because the current state-of-the-art is lacking.</p>
</section>
<section id="what-happened-to-the-revolution" class="level3">
<h3 class="anchored" data-anchor-id="what-happened-to-the-revolution">What happened to the revolution?</h3>
<p>I don’t understand what happened to the promised machine learning revolution in social sciences. Specifically, I’m yet to see any convincing application of machine learning methods that are designed for prediction to a social sciences problem where what we care about is understanding. I would like to either see evidence of them or a definitive thesis about why this can’t happen. The current situation is untenable where folks, especially those in fields that have been historically female, are made to feel inferior even though their results are no worse.</p>
</section>
<section id="how-do-we-think-about-power" class="level3">
<h3 class="anchored" data-anchor-id="how-do-we-think-about-power">How do we think about power?</h3>
<p>As someone who learnt statistics from economists, but now is partly in a statistics department, I do think that everyone should learn statistics from statisticians. This isn’t anything against economists, but the conversations that I have in the statistics department about what statistical methods are and how they should be used are very different to those that I’ve had in other departments.</p>
<p>I think the problem is that people outside statistics, treat statistics as a recipe in which they follow various steps and then out comes a cake. With regard to ‘power’—it turns out that there were a bunch of instructions that no one bothered to check—they turned the oven on to some temperature without checking that it was 180C, and that’s fine because whatever mess came out was accepted because the people evaluating the cake didn’t know that they needed to check the temperature had been appropriately set. (I’m ditching this analogy right now).</p>
<p>As you know, the issue with power is related to the broader discussion about p-values, which basically no one is taught properly, because it would require changing an awful lot about how we teach statistics i.e.&nbsp;moving away from the recipe approach.</p>
<p>And so, my specific issue is that people think that statistics is a recipe to be followed. They think that because that’s how they are trained especially in social sciences like political science and economics, and that’s what is rewarded. But that’s not what these methods are. Instead, statistics is a collection of different instruments that let us look at our data in a certain way. I think that we need a revolution here, not a metaphorical tucking in of one’s shirt.</p>
</section>
</section>
<section id="thank-you" class="level2">
<h2 class="anchored" data-anchor-id="thank-you">Thank you</h2>
<p>Right. So I think I’ll leave it there. Thank you again to Josh and Kartheik for inviting me.</p>
<p>Let’s cross our fingers for a successful launch of James Webb next week and its subsequent deployment. I do hope that you invite me back when you start getting data from it to analyse!</p>
<p>This is also my last talk for this year, so I’ll take this opportunity to say Merry Christmas, Happy Holidays, and I hope everyone has a wonderful start to 2022.</p>
<p>I’d be happy to take any questions.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thanks very much to Josh for the invitation to speak, and to Monica Alexander for her suggestions and comments.</p>



</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-alexander2021increased" class="csl-entry">
Alexander, Rohan, and Monica Alexander. 2021. <span>“The Increased Effect of Elections and Changing Prime Ministers on Topics Discussed in the Australian Federal Parliament Between 1901 and 2018.”</span> <a href="https://arxiv.org/abs/2111.09299">https://arxiv.org/abs/2111.09299</a>.
</div>
<div id="ref-heaps" class="csl-entry">
Alexander, Rohan, and A Mahfouz. 2021. <em>Heapsofpapers: Easily Download Heaps of PDF and CSV Files</em>. <a href="https://CRAN.R-project.org/package=heapsofpapers">https://CRAN.R-project.org/package=heapsofpapers</a>.
</div>
<div id="ref-bandy2021addressing" class="csl-entry">
Bandy, Jack, and Nicholas Vincent. 2021. <span>“Addressing "Documentation Debt" in Machine Learning Research: A Retrospective Datasheet for BookCorpus.”</span> <a href="https://arxiv.org/abs/2105.05241">https://arxiv.org/abs/2105.05241</a>.
</div>
<div id="ref-nick" class="csl-entry">
Benjamin S. Baumer, Daniel T. Kaplan, and Nicholas J. Horton. 2021. <em>Modern Data Science with r</em>. 2nd ed. <a href="https://mdsr-book.github.io/mdsr2e/">https://mdsr-book.github.io/mdsr2e/</a>.
</div>
<div id="ref-chiu2021detecting" class="csl-entry">
Chiu, Ke-Li, and Rohan Alexander. 2021. <span>“Detecting Hate Speech with GPT-3.”</span> <a href="https://arxiv.org/abs/2103.12407">https://arxiv.org/abs/2103.12407</a>.
</div>
<div id="ref-collins2021reproducibility" class="csl-entry">
Collins, Annie, and Rohan Alexander. 2021. <span>“Reproducibility of COVID-19 Pre-Prints.”</span> <a href="https://arxiv.org/abs/2107.10724">https://arxiv.org/abs/2107.10724</a>.
</div>
<div id="ref-Craiu2019Hiring" class="csl-entry">
Craiu, Radu V. 2019. <span>“The Hiring Gambit: In Search of the Twofer Data Scientist.”</span> <em>Harvard Data Science Review</em> 1 (1). <a href="https://doi.org/10.1162/99608f92.440445cb">https://doi.org/10.1162/99608f92.440445cb</a>.
</div>
<div id="ref-edgeworth1885methods" class="csl-entry">
Edgeworth, Francis Ysidro. 1885. <span>“Methods of Statistics.”</span> <em>Journal of the Statistical Society of London</em>, 181–217.
</div>
<div id="ref-leekpeng" class="csl-entry">
Leek, Jeff, and Roger D. Peng. 2020. <em>Advanced Data Science 2020</em>. <a href="http://jtleek.com/ads2020/index.html">http://jtleek.com/ads2020/index.html</a>.
</div>
<div id="ref-richard" class="csl-entry">
McElreath, Richard. 2020. <em>Statistical Rethinking: A Bayesian Course with Examples in r and Stan</em>. 2nd ed.
</div>
<div id="ref-stigler" class="csl-entry">
Stigler, Stephen. 1986. <em>The History of Statistics</em>. Harvard University Press.
</div>
<div id="ref-tiffany" class="csl-entry">
Timbers, Tiffany-Anne, Trevor Campbell, and Melissa Lee. 2021. <em>Data Science: A First Introduction</em>. <a href="https://ubc-dsci.github.io/introduction-to-datascience/">https://ubc-dsci.github.io/introduction-to-datascience/</a>.
</div>
<div id="ref-hads" class="csl-entry">
Wickham, Hadley, and Garrett Grolemund. 2016. <em>R for Data Science</em>. O’Reilly. <a href="https://r4ds.had.co.nz">https://r4ds.had.co.nz</a>.
</div>
</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-12-17-james_webb_space_telescope/james_webb_space_telescope.html</guid>
  <pubDate>Fri, 17 Dec 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>On the privilege of turning our world into data</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-12-16-on_the_privilege_of_turning_our_world_into_data/on_the_privilege_of_turning_our_world_into_data.html</link>
  <description><![CDATA[ 



<p>The slides are <a href="https://rohanalexander.com/pdfs/young_irish_statisticians.pdf">here</a>.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Hi, my name is Rohan Alexander. I’m an assistant professor at the University of Toronto in the Faculty of Information and the Department of Statistical Sciences. I’m also one of the co-leads of the University of Toronto Data Sciences Institute Thematic Program in Reproducibility. We’d love to develop ties with other institutions who are similarly interested in these issues, so please do get in touch.</p>
<p>I’d like to thank Niamh Cahill for the opportunity to talk today. I always feel a little awed by everything that she’s able to accomplish and all her publications. In preparing for this talk I was looking for imminent historical Irish statisticians, and of course arguably one of the most imminent present-day Irish statisticians is Adrian Raftery, who had a PhD student, Leontine Alkema, who was Niamh’s postdoc advisor. And Niamh certainly lives up to her pedigree.</p>
<p>I must admit that I feel a bit of a fraud talking today at this Young Irish Statisticians group. I’m no longer young, I’m certainly not Irish, and I’m not a statistician. But I do adore your country, and I spend a lot of time with statisticians, and I was once young. That said, I do hope that in a few years you can invite me back and we can do this in person, perhaps at the middle-aged Irish-fans pseudo-statisticians’ group!</p>
<p>Today I’d like to talk a little about the origins of data science, especially mentioning the contributions of some Irish statisticians. I will turn to what I see data science as, and what I see are some of our roles and responsibilities as quantitatively interested folks. I will then go through various applications including: understanding the effect of elections; hate speech detection; and the reproducibility of COVID-19 pre-prints. While going through those applications I will focus more on what I learned and how I developed, rather than specific results. I will close with a few open issues.</p>
<p>None of what I’m about to say is cannon, this talk is more my way of trying to work out what I think, so I’d appreciate your reactions and comments.</p>
</section>
<section id="what-is-data-science" class="level2">
<h2 class="anchored" data-anchor-id="what-is-data-science">What is data science?</h2>
<p>When we think about data science, I think that we all have different things in mind.</p>
<p>The only thing that is certain, is that there is no agreed definition of data science, but a lot of people have tried. For instance, <span class="citation" data-cites="hads">Wickham and Grolemund (2016)</span> say it is ‘…an exciting discipline that allows you to turn raw data into understanding, insight, and knowledge.’ Similarly, <span class="citation" data-cites="leekpeng">Leek and Peng (2020)</span> say it is ‘…the process of formulating a quantitative question that can be answered with data, collecting and cleaning the data, analyzing the data, and communicating the answer to the question to a relevant audience.’ <span class="citation" data-cites="nick">Benjamin S. Baumer and Horton (2021)</span> say it is ‘…the science of extracting meaningful information from data.’ And <span class="citation" data-cites="tiffany">Timbers, Campbell, and Lee (2021)</span> say they define ‘data science as the process of generating insight from data through reproducible and auditable processes’.</p>
<p><span class="citation" data-cites="Craiu2019Hiring">Craiu (2019)</span> argues that the lack of certainty as to what data science is, might not matter because ‘…who can really say what makes someone a poet or a scientist?’ He goes on to broadly say that a data scientist is ‘…someone with a data driven research agenda, who adheres to or aspires to using a principled implementation of statistical methods and uses efficient computation skills.’</p>
<p>Regardless of who is right, alongside those specific, more-technical, definitions, there is value in having a simple definition, even if we lose a bit of specificity. For instance, probability is often informally defined as ‘counting things’ <span class="citation" data-cites="richard">(McElreath 2020, 10)</span>. In a similar informal sense, data science can be defined as something like: ‘humans measuring stuff, typically related to other humans, and using sophisticated averaging to explain and predict’.</p>
<p>That may sound a touch cute, but Francis Edgeworth, the Irish nineteenth century statistician and economist, who went to Trinity College Dublin, considered statistics to be the science ‘of those Means which are presented by social phenomena,’ so it is in good company <span class="citation" data-cites="edgeworth1885methods">(Edgeworth 1885)</span>.</p>
<p>In any case, one feature of this definition is that it does not treat data as terra nullius, or nobody’s land. Statisticians tend to see data as the result of some process that we can never know, but that we try to use data to come to understand. Many statisticians care deeply about data and measurement, but there are many cases in statistics where data kind of just appear; they belong to no one. But that is never actually the case.</p>
<p>Data must be gathered, cleaned, and prepared, and these decisions matter. Every dataset is sui generis, or a class by itself, and so when you come to know one dataset well, you just know one dataset, not all datasets.</p>
<p>More broadly, I think that much of data science focuses on the ‘science,’ but it is important that we also focus on ‘data.’ And that is another feature of my cutesy definition of data science which I posited before. A lot of data scientists are generalists, who are interested in a broad range of problems. Often, the thing that unites these is the need to gather, clean, and prepare messy data. And often it is the specifics of those data that require the most time, that update most often, and that are worthy of our most full attention. Unfortunately, it’s not typically the type of thing that is professionally rewarded.</p>
</section>
<section id="what-we-can-learn-from-a-historical-dublin-census" class="level2">
<h2 class="anchored" data-anchor-id="what-we-can-learn-from-a-historical-dublin-census">What we can learn from a historical Dublin census?</h2>
<p>At this point I’d like to look back, for a moment, at the origins of data science. If we look at the history of statistics, we very quickly find ourselves surrounded by Irish contributions.</p>
<p>In preparing for this talk I was thrilled to learn about the book by the Reverend James Whitelaw, and this is its actual title, ‘An essay on the population of Dublin. Being the result of an actual survey taken in 1798, with great care and precision, and arranged in a manner entirely new’ <span class="citation" data-cites="whatasurvey">(Whitelaw 1905)</span>. I really do think that we all maybe need to adopt a little more of the Whitelaw’s detail in our paper titles!</p>
<p>In any case, <span class="citation" data-cites="whatasurvey">Whitelaw (1905)</span> says that he is fed up with the bad estimates of the size of the population in various capitals. And he particularly singled out London, which he says has estimates that range anywhere between 128,570 and 300,000. Instead, he says that he intends to make an accurate count of the number of inhabitants of Dublin.</p>
<p>He describes how:</p>
<blockquote class="blockquote">
<p>When I first entered on the business, I conceived that I should have little more to do than to transcribe carefully the list of inhabitants affixed to the door of each house by order of the Lord Mayor.</p>
</blockquote>
<p>Like many of us who spend our days in data, he found it was not that simple. Instead, he found:</p>
<blockquote class="blockquote">
<p>(t)he lists on the doors… presented generally to view a confused chaos of names, frequently illegible, and generally short of the actual number by a third, or even one-half’. He goes onto say that instead, he and his assistants braved ’the dread of infectious diseases,… filth, stench, and darkness,… to explore… every room of those wretched habitations, from the cellar to the garret, and on the spot ascertained their population.</p>
</blockquote>
<p>The resulting tables looked something like this (Figure @ref(fig:iceberg)):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-12-16-on_the_privilege_of_turning_our_world_into_data/extract.png" class="quarto-discovered-preview-image img-fluid figure-img" style="width:85.0%"></p>
<p></p><figcaption class="figure-caption">Extract of the survey</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>And in case you’re interested, his estimate of the total population of Dublin in 1798 was estimated at 182,370.</p>
<p>I was surprised by how confident Whitelaw was in his numbers. My PhD is in economic history, where I was interested in Australian economic history, especially political history. And the thing about economic historians is that we have to create, clean, and prepare our own datasets from whatever traces we can find before we can analyse it. So that training focuses one’s mind on measurement, and sampling.</p>
<p>And there’s an odd phenomenon that I’ve observed where the further one is away from decisions to do with the counting, measurement, organisation, and categorisation, the more one tends to trust the resulting datasets. That is, the person that actually does the hard work of constructing our datasets is usually the one that trusts them the least.</p>
<p>I’ve never understood this confidence that people have in datasets that they don’t construct themselves.</p>
<p>It’s an absolute privilege to get to work in data science. To be able to feel, like Reverend Whitelaw did, that one is bringing some order to things. But it’s important to realise the perspective that one brings as one is doing that.</p>
<p>Now my point here isn’t to attack Whitelaw, as he is long dead and incapable of defending himself, but, I skipped over a bunch of the actual quote in Whitelaw. In particular, after talking about that bit about just looking at the lists on the doors:</p>
<blockquote class="blockquote">
<p>As the families of the middle and upper classes always contained some individual who was competent to the task, and as few had any motive to conceal or misrepresent, I found their lists, in general, extremely correct; but among the lower class, which forms the great mass of the population of this city, the case was very different…. This I at first imputed to design, but was afterwards convinced that it proceeded from ignorance and incapacity.</p>
</blockquote>
<p>But how could he possibly know?</p>
<p>To a certain extent we are wasting our time. We have a perfect model of the world—it is the world! But it is too complicated. If we knew perfectly how everything was affected by the uncountable factors that influence it, then we could perfectly forecast a coin toss, a dice roll, and every other seemingly random process each time. But we cannot. Instead, we must simplify things to that which is plausibly measurable, and it is that which we define as data. Our data are a simplification of the messy, complex, world from which they were generated.</p>
<p>There are different approximations of ‘plausibly measurable.’ Hence, datasets are always the result of choices. We must decide whether they are nonetheless reasonable for the task at hand. We use statistical models to help us think deeply about, explore, and hopefully come to better understand, our data.</p>
<p>Much of statistics is focused on considering, thoroughly, the data that we have. And that was appropriate for when our data were predominately agricultural, astronomical, or from the physical sciences. But with the rise of data science, mostly because of the value of its application to datasets generated by humans, we must also actively consider what is not in our dataset. Who is systematically missing from our dataset? Whose data does not fit nicely into the approach that we are using and are hence is being inappropriately simplified? If the process of the world becoming data necessarily involves abstraction and simplification, then we need to be clear about the points at which we can reasonably simplify, and those which would be inappropriate, recognising that this will be application specific.</p>
<p>Data science needs diversity. And it’s one reason that I’m excited by all the initiatives to increase participation by women and other underrepresented groups. We need our labs, our classrooms, and of course, eventually, our startups and businesses to be representative of the broader society.</p>
<p>The process of our world becoming data necessarily involves measurement. As I mentioned before, paradoxically, often those that do the measurement and are deeply immersed in the details have less trust in the data than those that are removed from it. Even seemingly clear tasks, such as measuring distance, defining boundaries, and counting populations, are surprisingly difficult in practice. Turning our world into data requires many decisions and imposes much error. Among many other considerations, we need to decide what will be measured, how accurately we will do this, and who will be doing the measurement.</p>
<p>An important example of how something seemingly simple quickly becomes difficult is maternal mortality. That refers to the number of women who die while pregnant, or soon after a termination, from a cause related to the pregnancy or its management <span class="citation" data-cites="matmortality">(WHO 2019)</span>. It is difficult but critical to turn the tragedy of such a death into cause-specific data because that helps mitigate future deaths. Some countries have well-developed civil registration and vital statistics (CRVS). These collect data about every death. But many countries do not have a CRVS and so not every death is recorded. Even if a death is recorded, defining a cause of death may be difficult, especially when there is a lack of qualified medical personal or equipment. Maternal mortality is especially difficult because there are typically many causes. Some CRVS have a checkbox on the form to specify whether the death should be counted as maternal mortality. But even some developed countries have only recently adopted this. For instance, it was only introduced in the US in 2003, and even in 2015 Alabama, California, and West Virginia had not adopted the standard question <span class="citation" data-cites="macdorman2018failure">(MacDorman and Declercq 2018)</span>.</p>
</section>
<section id="on-balance-between-data-and-science" class="level2">
<h2 class="anchored" data-anchor-id="on-balance-between-data-and-science">On balance between data and science</h2>
<p>I mentioned at the start of the talk that I’m appointed in both the Faculty of Information and the Department of Statistical Sciences. For those who don’t know, faculties of information were created around the turn of the century to train librarians. Library science of course has a long and distinguished history of archiving, categorising, storing, and retrieving information, and for a long time when computers were first developed, a lot of the initial work was done by librarians, or at libraries. I suspect there is a gendered aspect to this, with librarians often being female, but a lot of that work was systematically overlooked and was re-invented later. This continues today, with our library at the University of Toronto doing excellent work that is consistently overlooked. I used to feel a bit funny about being jointly appointed, but it turns out that the first chair of the Department of Statistics at Trinity College Dublin, Gordon Foster, was not only a statistician, but he also created the International Book Numbering System (ISBN), which we still use today.</p>
<p>In 1968 Foster gave the Geary Lecture at the Economic and Social Research Institute in Dublin <span class="citation" data-cites="foster">(Foster 1968)</span>. And I think it is worth revisiting that talk because he was clearly, yet another, Irish statistician who was well ahead of his time.</p>
<p><span class="citation" data-cites="foster">Foster (1968)</span> first describes how:</p>
<blockquote class="blockquote">
<p>[j]ust prior to the time when my own career in statistics was commencing, an important development took place in which I was therefore able to participate straight away, and which has since had a great effect on the development of the subject. I mean of course the invention of the computer.</p>
</blockquote>
<p>It’s funny, but fifty years on, I actually feel the same way about my career!</p>
<p><span class="citation" data-cites="foster">Foster (1968)</span> goes on to say that</p>
<blockquote class="blockquote">
<p>it was something of an achievement to get a programme actually working. It was useful to have handy a screwdriver and scotch-tape, and to know where to kick the machine if it stuck.</p>
</blockquote>
<p>And as someone who gets the privilege to write code for living, I do wonder if much has changed!</p>
<p>It’s interesting that <span class="citation" data-cites="foster">Foster (1968)</span> points very clearly to data science in this talk, where he says:</p>
<blockquote class="blockquote">
<p>(s)tatistics are concerned with the processing and analysis of masses of data and with the development of mathematical methods of extracting information from data. Combine all this activity with computer methods and you have something more than the sum of its parts.</p>
</blockquote>
<p>Talking about computers at the time, <span class="citation" data-cites="foster">Foster (1968)</span> says:</p>
<blockquote class="blockquote">
<p>(t)hey are capable of performing any structured task, from planning a hospital diet, retrieving a legal precedent, or controlling stocks in a warehouse, to playing a reasonably good game of chess… I think, we begin to realise that the endeavour which I have referred to as information technology is no longer something just affecting specialists, but is bringing about changes in society affecting us all.</p>
</blockquote>
<p>How easy it would be to change ‘information technology’ to ‘data science’ in those quotes for them to ring true almost a lifetime after they were spoken.</p>
<p>We always use various instruments to turn the world into data. For instance, in astronomy, the development of better telescopes, and eventually satellites and probes, enabled new understanding of other worlds. We similarly have new instruments for turning our own world into data being developed each day.</p>
<p>In the social sciences, a census was once a generational-defining event. And it’s appropriate that this talk happens near the Christmas holidays given the role that the census played in that event. But now we have regular surveys, transactions data available by the second, and almost all interactions on the internet become data of some kind. The development of such instruments has enabled exciting new stories to be told with data.</p>
<p>I think for the past ten years or so, we’ve had the balance wrong in data science. There has been too much focus on the ‘science’ bit, without sufficient focus on the ‘data’ bit.</p>
<p>It is not just the ‘science’ bit that is hard, it is the ‘data’ bit as well. I feel that Foster would have known this, and we are just reinventing things. For instance, researchers went back and examined one of the most popular text datasets in computer science, and they found that around 30 per cent of the data were inappropriately duplicated <span class="citation" data-cites="bandy2021addressing">(Bandy and Vincent 2021)</span>. There is an entire field—linguistics—that specialises in these types of datasets, and inappropriate use of data is one of the dangers of any one field being hegemonic. The strength of data science is that it brings together folks with a variety of backgrounds and training to the task of learning about some dataset. It is not constrained by what was done in the past. But this means that we must go out of our way to show respect for those who do not come from our own tradition, but who are nonetheless as similarly interested in a dataset, or in a question, as we are.</p>
<p>I’m picking on CS a little here, but my home of the social sciences is just as bad and researchers like me are trying to refocus us on data a little more than we have been in the past.</p>
<p>So what are some examples of things that I work on?</p>
</section>
<section id="examples-of-my-work" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-my-work">Examples of my work</h2>
<p>I mentioned that my PhD is in economic history, but I spent most of my PhD trying to deal with big text datasets. And when I say ‘dealing’ I mean using R to clean and tidy them, which was the work of years. My supervisors—John Tang, Tim Hatton, Martine Mariotti, and Zach Ward—gave me the freedom to do what I wanted, with regular weekly meetings. It’s not a topic that traditionally would have been appropriate in economics, and I’m grateful they gave me the space because traditional economics is not for me, but data science is.</p>
<section id="effect-of-elections-and-changed-prime-ministers" class="level3">
<h3 class="anchored" data-anchor-id="effect-of-elections-and-changed-prime-ministers">Effect of elections and changed prime ministers</h3>
<p>One result of this work was the paper—<em>The Increased Effect of Elections and Changing Prime Ministers on Topics Discussed in the Australian Federal Parliament between 1901 and 2018</em>—<span class="citation" data-cites="alexander2021increased">(Alexander and Alexander 2021)</span> which was co-authored with my wife Monica. In Australia there is a written record of what is said in parliament called Hansard. We grabbed the text of everything said between 1901 and 2018 and then built a statistical model to look at whether the topics of discussion changed when there was an election or when there was a change in the prime minister. We found that changes in prime minister tend to be associated with topic changes even when the party in power does not change; and the effect of elections has been increasing since the 1980s, regardless of whether the election results in a change of prime minister.</p>
<section id="lesson-always-start-small-and-then-iterate." class="level4">
<h4 class="anchored" data-anchor-id="lesson-always-start-small-and-then-iterate.">Lesson: Always start small and then iterate.</h4>
<p>I came to that paper hopelessly naive and lost. I didn’t know that text analysis, and natural language processing more generally, was something that was incredibly popular. I didn’t have the skills that I needed, and really all I had was an all-consuming interest in the broad area - I didn’t even have a question. The dataset has over a billion words in it. So the main lesson for me was in dealing with big datasets. And here I don’t mean in terms of technical skills, I mean in terms of approach. These days when I have students and they want to use the Hansard or any large dataset, I start by insisting that they just use one month of data. After they analyse and write that up, then they can go to a year, and then they can continue to build up slowly.</p>
<p>The reason that I know now that’s the best way to go is that I somehow convinced myself that I couldn’t possibly answer any interesting questions until I had a century worth of data. And because I was teaching myself everything as I went, it took me more than a year to just get the data into a usable format.</p>
<p>If you take nothing away from this talk, please I beg you take this away: the most important, vital thing, is that you create a minimal viable product of any research. And that minimal viable product needs to be something that you can finish within a week. If you can’t do that then adjust the scope and the question until you can. Then you achieve that MVP and then you start to scale up to the question that you’re interested in, which is hopefully something that can be published.</p>
</section>
</section>
<section id="explaining-why-text-is-sexist-or-racist-with-gpt-3" class="level3">
<h3 class="anchored" data-anchor-id="explaining-why-text-is-sexist-or-racist-with-gpt-3">Explaining Why Text is Sexist or Racist with GPT-3</h3>
<p>As anyone who has cared for young children knows, the response to almost any statement can be ‘why?’. One can quickly find oneself trying to explain the finer details of photosynthesis to a 3-year-old, and the extent to which one struggles with this tends to put in sharp relief the extent of one’s knowledge. Large language models such as OpenAI’s GPT-3 can generate text that is indistinguishable from that created by humans. They can also classify whether some given text is sexist or racist <span class="citation" data-cites="chiu2021detecting">(Chiu and Alexander 2021)</span>.</p>
<p>In the paper—<em>Explaining Why Text is Sexist or Racist with GPT-3</em>—which was co-authored by Ke-Li Chiu we assess the extent to which GPT-3 can generate explanations for why a given text is sexist or racist. We prompt GPT-3 to generate explanations in a question-and-answer manner: ‘Is the following statement in quotes sexist? Answer yes or no and explain why.’ We then assess the adequacy of the explanations generated by GPT-3. We are interested in firstly, the extent to which it correctly classifies whether the statements are sexist/racist; and secondly, the reasonableness of the explanation that accompanies that classification.</p>
<p>We find that GPT-3 does poorly in the open-ended approach. When we add more structure to guide its responses the model performs better. But even when it correctly classifies racism or sexism, the accompanying explanations are often inaccurate. At times they even contradict the classification. On a technical level, we find a clear relationship between the hyper-parameter temperature and the number of correctly matched attributes, with substantial decreases as temperature increases.</p>
<section id="lesson-always-teach" class="level4">
<h4 class="anchored" data-anchor-id="lesson-always-teach">Lesson: Always teach</h4>
<p>I just used a bunch of terms there and you probably assume that I know what they mean. In writing the paper that preceded this one, I actually fooled myself into thinking that I knew what they meant. It wasn’t until I tried to teach the material that I realised that I didn’t have a clue what was going on.</p>
<p>A lot of my colleagues try to get out of teaching, and I can understand why they would think that, but I’ve found that having to teach has made me a better researcher. For one reason, I found that it’s too easy to fool yourself into thinking you know something until you have to explain it. And I also kind of think that a lot of us in academia need pressure, constraints, and a weekly structure, in order to do our best work.</p>
</section>
</section>
<section id="reproducibility-of-covid-19-pre-prints" class="level3">
<h3 class="anchored" data-anchor-id="reproducibility-of-covid-19-pre-prints">Reproducibility of COVID-19 pre-prints</h3>
<p>The final paper that I’d like to touch on is—<em>Reproducibility of COVID-19 pre-prints</em>—by Annie Collins and me <span class="citation" data-cites="collins2021reproducibility">(Collins and Alexander 2021)</span>. In that paper we are interested in the reproducibility of COVID-19 research. We create a dataset of pre-prints posted to arXiv, bioRxiv, medRxiv, and SocArXiv between 28 January 2020 and 30 June 2021 that are related to COVID-19. We extract the text from these pre-prints and parse them looking for keyword markers signalling the availability of the data and code underpinning the pre-print. For the pre-prints that are in our sample, we are unable to find markers of either open data or open code for 75 per cent of those on arXiv, 67 per cent of those on bioRxiv, 79 per cent of those on medRxiv, and 85 per cent of those on SocArXiv. We conclude that there may be value in having authors categorize the degree of openness of their pre-print as part of the pre-print submissions process, and more broadly, there is a need to better integrate open science training into a wide range of fields.</p>
<section id="lesson-you-always-need-the-code-more-than-once" class="level4">
<h4 class="anchored" data-anchor-id="lesson-you-always-need-the-code-more-than-once">Lesson: You always need the code more than once</h4>
<p>I went into that paper thinking that I’d just quickly write some code to download some files and then be done with it. But then Annie wanted to broaden the scope of the paper, so the code needed to be re-written because she couldn’t understand what I’d done. And then we had to re-run the code because we wanted to update everything before she presented the paper. And that meant re-writing things. And then we to re-run the code before we submitted the paper. Again that meant re-writing things.</p>
<p>We eventually just turned the code into an R package, which is on CRAN as <a href="https://rohanalexander.github.io/heapsofpapers/">heapsofpapers</a> <span class="citation" data-cites="heaps">(Alexander and Mahfouz 2021)</span>. Which is what I should have done from the start. The lesson that I learnt from this paper is that regardless of how certain you are that you’ll never use some particular code again, you’ll always need it.</p>
</section>
</section>
</section>
<section id="open-questions" class="level2">
<h2 class="anchored" data-anchor-id="open-questions">Open questions</h2>
<section id="how-do-we-write-unit-tests-for-data-science" class="level3">
<h3 class="anchored" data-anchor-id="how-do-we-write-unit-tests-for-data-science">How do we write unit tests for data science?</h3>
<p>One thing that working with real computer scientists has taught me is the importance of unit tests. Basically this just means writing down the small checks that we do in our heads all the time. Like if we have a column that purports to the year, then it’s unlikely that it’s a character, and it’s unlikely that it’s an integer larger than 2500, and it’s unlikely that it’s a negative integer. We know all this, but writing unit tests has us write this all down.</p>
<p>In this case it’s obvious what the unit test looks like. But more generally, we often have little idea what our results should look like if they’re running well. The approach that I’ve taken is to add simulation - so we simulate reasonable results, write unit tests based on that, and then bring the real data to bear and adjust as necessary. But I really think that we need extensive work in this area because the current state-of-the-art is lacking.</p>
</section>
<section id="what-happened-to-the-revolution" class="level3">
<h3 class="anchored" data-anchor-id="what-happened-to-the-revolution">What happened to the revolution?</h3>
<p>I don’t understand what happened to the promised machine learning revolution in social sciences. Specifically, I’m yet to see any convincing application of machine learning methods that are designed for prediction to a social sciences problem where what we care about is understanding. I would like to either see evidence of them or a definitive thesis about why this can’t happen. The current situation is untenable where folks, especially those in fields that have been historically female, are made to feel inferior even though their results are no worse.</p>
</section>
<section id="how-do-we-think-about-power" class="level3">
<h3 class="anchored" data-anchor-id="how-do-we-think-about-power">How do we think about power?</h3>
<p>As someone who learnt statistics from economists, but now is partly in a statistics department, I do think that everyone should learn statistics from statisticians. This isn’t anything against economists, but the conversations that I have in the statistics department about what statistical methods are and how they should be used are very different to those that I’ve had in other departments.</p>
<p>I think the problem is that people outside statistics, treat statistics as a recipe in which they follow various steps and then out comes a cake. With regard to ‘power’—it turns out that there were a bunch of instructions that no one bothered to check—they turned the oven on to some temperature without checking that it was 180C, and that’s fine because whatever mess came out was accepted because the people evaluating the cake didn’t know that they needed to check the temperature had been appropriately set. (I’m ditching this analogy right now).</p>
<p>As you know, the issue with power is related to the broader discussion about p-values, which basically no one is taught properly, because it would require changing an awful lot about how we teach statistics i.e.&nbsp;moving away from the recipe approach.</p>
<p>And so, my specific issue is that people think that statistics is a recipe to be followed. They think that because that’s how they are trained especially in social sciences like political science and economics, and that’s what is rewarded. But that’s not what these methods are. Instead, statistics is a collection of different instruments that let us look at our data in a certain way. I think that we need a revolution here, not a metaphorical tucking in of one’s shirt.</p>
</section>
</section>
<section id="thank-you" class="level2">
<h2 class="anchored" data-anchor-id="thank-you">Thank you</h2>
<p>Right. So I think I’ll leave it there. Thank you again to Niamh for inviting me. And I hope that I haven’t bored you all too much.Merry Christmas, happy holidays, and I hope everyone has a wonderful start to 2022.</p>
<p>I’d be happy to take any questions.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thanks very much to Niamh Cahill for the invitation to speak, and to Monica Alexander for her suggestions and comments.</p>



</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-alexander2021increased" class="csl-entry">
Alexander, Rohan, and Monica Alexander. 2021. <span>“The Increased Effect of Elections and Changing Prime Ministers on Topics Discussed in the Australian Federal Parliament Between 1901 and 2018.”</span> <a href="https://arxiv.org/abs/2111.09299">https://arxiv.org/abs/2111.09299</a>.
</div>
<div id="ref-heaps" class="csl-entry">
Alexander, Rohan, and A Mahfouz. 2021. <em>Heapsofpapers: Easily Download Heaps of PDF and CSV Files</em>. <a href="https://CRAN.R-project.org/package=heapsofpapers">https://CRAN.R-project.org/package=heapsofpapers</a>.
</div>
<div id="ref-bandy2021addressing" class="csl-entry">
Bandy, Jack, and Nicholas Vincent. 2021. <span>“Addressing "Documentation Debt" in Machine Learning Research: A Retrospective Datasheet for BookCorpus.”</span> <a href="https://arxiv.org/abs/2105.05241">https://arxiv.org/abs/2105.05241</a>.
</div>
<div id="ref-nick" class="csl-entry">
Benjamin S. Baumer, Daniel T. Kaplan, and Nicholas J. Horton. 2021. <em>Modern Data Science with r</em>. 2nd ed. <a href="https://mdsr-book.github.io/mdsr2e/">https://mdsr-book.github.io/mdsr2e/</a>.
</div>
<div id="ref-chiu2021detecting" class="csl-entry">
Chiu, Ke-Li, and Rohan Alexander. 2021. <span>“Detecting Hate Speech with GPT-3.”</span> <a href="https://arxiv.org/abs/2103.12407">https://arxiv.org/abs/2103.12407</a>.
</div>
<div id="ref-collins2021reproducibility" class="csl-entry">
Collins, Annie, and Rohan Alexander. 2021. <span>“Reproducibility of COVID-19 Pre-Prints.”</span> <a href="https://arxiv.org/abs/2107.10724">https://arxiv.org/abs/2107.10724</a>.
</div>
<div id="ref-Craiu2019Hiring" class="csl-entry">
Craiu, Radu V. 2019. <span>“The Hiring Gambit: In Search of the Twofer Data Scientist.”</span> <em>Harvard Data Science Review</em> 1 (1). <a href="https://doi.org/10.1162/99608f92.440445cb">https://doi.org/10.1162/99608f92.440445cb</a>.
</div>
<div id="ref-edgeworth1885methods" class="csl-entry">
Edgeworth, Francis Ysidro. 1885. <span>“Methods of Statistics.”</span> <em>Journal of the Statistical Society of London</em>, 181–217.
</div>
<div id="ref-foster" class="csl-entry">
Foster, Gordon. 1968. <span>“Computers, Statistics and Planning: Systems or Chaos?”</span> <em>Geary Lecture</em>. <a href="https://www.esri.ie/system/files/media/file-uploads/2016-03/GLS2.pdf">https://www.esri.ie/system/files/media/file-uploads/2016-03/GLS2.pdf</a>.
</div>
<div id="ref-leekpeng" class="csl-entry">
Leek, Jeff, and Roger D. Peng. 2020. <em>Advanced Data Science 2020</em>. <a href="http://jtleek.com/ads2020/index.html">http://jtleek.com/ads2020/index.html</a>.
</div>
<div id="ref-macdorman2018failure" class="csl-entry">
MacDorman, Marian F, and Eugene Declercq. 2018. <span>“The Failure of United States Maternal Mortality Reporting and Its Impact on Women’s Lives.”</span> <em>Birth (Berkeley, Calif.)</em> 45 (2): 105.
</div>
<div id="ref-richard" class="csl-entry">
McElreath, Richard. 2020. <em>Statistical Rethinking: A Bayesian Course with Examples in r and Stan</em>. 2nd ed.
</div>
<div id="ref-tiffany" class="csl-entry">
Timbers, Tiffany-Anne, Trevor Campbell, and Melissa Lee. 2021. <em>Data Science: A First Introduction</em>. <a href="https://ubc-dsci.github.io/introduction-to-datascience/">https://ubc-dsci.github.io/introduction-to-datascience/</a>.
</div>
<div id="ref-whatasurvey" class="csl-entry">
Whitelaw, James. 1905. <em>An Essay on the Population of Dublin. Being the Result of an Actual Survey Taken in 1798, with Great Care and Precision, and Arranged in a Manner Entirely New</em>. Graisberry; Campbell.
</div>
<div id="ref-matmortality" class="csl-entry">
WHO. 2019. <span>“Trends in Maternal Mortality 2000 to 2017: Estimates by WHO, UNICEF, UNFPA, World Bank Group and the United Nations Population Division.”</span> <a href="https://www.who.int/reproductivehealth/publications/maternal-mortality-2000-2017/en/">https://www.who.int/reproductivehealth/publications/maternal-mortality-2000-2017/en/</a>.
</div>
<div id="ref-hads" class="csl-entry">
Wickham, Hadley, and Garrett Grolemund. 2016. <em>R for Data Science</em>. O’Reilly. <a href="https://r4ds.had.co.nz">https://r4ds.had.co.nz</a>.
</div>
</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-12-16-on_the_privilege_of_turning_our_world_into_data/on_the_privilege_of_turning_our_world_into_data.html</guid>
  <pubDate>Thu, 16 Dec 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>The average age of politicians in the Australian Federal Parliament (1901-2021)</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-12-02-average_age_of_australian_politicians/average_age_of_parliaments.html</link>
  <description><![CDATA[ 



<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Last week I had the opportunity to attend my first thesis defence at a French-language institution (just to clarify - the actual defence was nonetheless conducted in English). Congratulations to Florence Vallée-Dubois on a successful defence. Her thesis looks at population ageing and democratic representation in Canada and is absolutely brilliant.</p>
<p>Her work, and some earlier comments by Ben Readshaw, got me thinking about what the average age of a politician in Australia looks like. Thankfully, this is an example of a question that my new R package with Paul Hodgetts <code>AustralianPoliticians</code> makes easy to answer <span class="citation" data-cites="citeaustralianpoltiicaisn">(Alexander and Hodgetts 2021)</span>.</p>
<p>The average age of politicians in a parliament may have implications for the types of issues that are emphasised and the policies that are put in place. I examine the average age of Australian politicians in the Senate and the House of Representatives. In general, the Senate tends to be slightly older than the House of Representatives. I find a gradual increase in the average age from Federation through to the 1940s. In 1949 there was an expansion of the parliament and the average age noticeably declined. After a period of relative stability in the 1950s and 1960s, there was another noticeable decrease in the 1970s, followed by a gradual aging.</p>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data preparation</h2>
<p>The dataset that I used in this note was primarily collected from records from the Australian Parliamentary Library, Wikipedia, and the Australian Dictionary of Biography. The dataset comprises biographical, political, and other information about every person elected to either the House of Representatives or the Senate. You can get the dataset in a series of CSVs on GitHub or as an R Package <code>AustralianPoliticians</code> available on CRAN.<sup>1</sup></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("AustralianPoliticians")</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(AustralianPoliticians)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>The other packages that are required for the analysis are <code>lubridate</code> <span class="citation" data-cites="citeLubridate">(Grolemund and Wickham 2011)</span>, the <code>tidyverse</code> <span class="citation" data-cites="citeTidyverse">(Wickham et al. 2019)</span>. Additionally this note draws on the <code>knitr</code> <span class="citation" data-cites="citeKnitr">(Xie 2020)</span> and <code>distill</code> <span class="citation" data-cites="citedistill">(Allaire et al. 2021)</span> packages. All analysis is conducted in the statistical programming language R <span class="citation" data-cites="citeR">(R Core Team 2020)</span>.</p>
<p>I’m not going to spend a lot of time on descriptives about the dataset here because that’s needed for a paper, and this is meant to be fun.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> AustralianPoliticians<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_auspol</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all"</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(all)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 20
  uniqueID   surname allOtherNames      firstName commonName
  &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;     
1 Abbott1859 Abbott  Richard Hartley S… Richard   &lt;NA&gt;      
2 Abbott1869 Abbott  Percy Phipps       Percy     &lt;NA&gt;      
3 Abbott1877 Abbott  Macartney          Macartney Mac       
4 Abbott1886 Abbott  Charles Lydiard A… Charles   Aubrey    
5 Abbott1891 Abbott  Joseph Palmer      Joseph    &lt;NA&gt;      
6 Abbott1957 Abbott  Anthony John       Anthony   Tony      
# ℹ 15 more variables: displayName &lt;chr&gt;,
#   earlierOrLaterNames &lt;chr&gt;, title &lt;chr&gt;, gender &lt;chr&gt;,
#   birthDate &lt;date&gt;, birthYear &lt;dbl&gt;, birthPlace &lt;chr&gt;,
#   deathDate &lt;date&gt;, member &lt;dbl&gt;, senator &lt;dbl&gt;,
#   wasPrimeMinister &lt;dbl&gt;, wikidataID &lt;chr&gt;,
#   wikipedia &lt;chr&gt;, adb &lt;chr&gt;, comments &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>member <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
   0    1 
 578 1205 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">all<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>senator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
   0    1 
1155  628 </code></pre>
</div>
</div>
<p>But briefly, there are 1,783 politicians in the dataset, with 1,205 having sat in the House of Representatives, which is the lower house, and 628 having sat in the Senate, which is the upper house. There is some overlap because there are people who sat in both houses.<sup>2</sup></p>
<p>The <code>AustralianPoliticians</code> package contains a number of datasets that are related by the <code>uniqueID</code> variable. This note requires the main dataset - ‘all’ - as well as two supporting datasets that provide more detailed information about the members - ‘mps’ - and the senators - ‘senators’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the members and the dates they were in the house</span></span>
<span id="cb8-2">mps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> AustralianPoliticians<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_auspol</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4">australian_mps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb8-5">  all <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(member <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(mps, </span>
<span id="cb8-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniqueID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(uniqueID, mpFrom, mpTo) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">house =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reps"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> mpFrom,</span>
<span id="cb8-12">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> mpTo)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the senators and the dates they were in the senate</span></span>
<span id="cb9-2">senators <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> AustralianPoliticians<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_auspol</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"senators"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">australian_senators <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-5">  all <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(senator <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(senators, </span>
<span id="cb9-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniqueID"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(uniqueID, senatorFrom, senatorTo) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">house =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"senate"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> senatorFrom,</span>
<span id="cb9-12">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> senatorTo)</span>
<span id="cb9-13"></span>
<span id="cb9-14">australian_politicians <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(australian_mps, australian_senators)</span>
<span id="cb9-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(australian_senators, australian_mps, mps, senators)</span>
<span id="cb9-16"></span>
<span id="cb9-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change the names so that they print nicely in graphs/tables</span></span>
<span id="cb9-18">australian_politicians <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-19">  australian_politicians <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">house =</span></span>
<span id="cb9-21">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb9-22">             house <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"senate"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Senate"</span>,</span>
<span id="cb9-23">             house <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reps"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HoR"</span>,</span>
<span id="cb9-24">             <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OH NO"</span>)</span>
<span id="cb9-25">         )</span>
<span id="cb9-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(australian_politicians)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  uniqueID   from       to         house
  &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;
1 Abbott1869 1913-05-31 1919-11-03 HoR  
2 Abbott1886 1925-11-14 1929-10-12 HoR  
3 Abbott1886 1931-12-19 1937-03-28 HoR  
4 Abbott1891 1940-09-21 1949-10-31 HoR  
5 Abbott1957 1994-03-26 2019-05-18 HoR  
6 Abel1939   1975-12-13 1977-11-10 HoR  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># australian_politicians$house %&gt;% table()</span></span></code></pre></div>
</div>
<p>For each day, I would like to know the average age of everyone sitting in the parliament. There are a variety of ways to do this, but one is to create a dataset of two columns: <code>date</code> and <code>uniqueID.</code> Both of these are repeated, so that for every <code>date</code> there is every <code>uniqueID.</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">start_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1901-01-01"</span>)</span>
<span id="cb12-2">end_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-12-31"</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4">politicians_by_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb12-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uniqueID =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(australian_politicians<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>uniqueID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(),</span>
<span id="cb12-7">                   end_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb12-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq.Date</span>(start_date, end_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>),</span>
<span id="cb12-9">               australian_politicians<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>uniqueID <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>()</span>
<span id="cb12-10">               )</span>
<span id="cb12-11">    )</span>
<span id="cb12-12"></span>
<span id="cb12-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(politicians_by_date)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  uniqueID   date      
  &lt;chr&gt;      &lt;date&gt;    
1 Abbott1869 1901-01-01
2 Abbott1886 1901-01-02
3 Abbott1891 1901-01-03
4 Abbott1957 1901-01-04
5 Abel1939   1901-01-05
6 Adams1951  1901-01-06</code></pre>
</div>
</div>
<p>Although the dataset is long at this point, it will be quite sparse as there are many combinations of <code>date</code> and <code>uniqueID</code> that are irrelevant. In the next step I check if each <code>uniqueID</code> was in parliament on each date, and filter away those that were not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add an explicit end date to the uniqueIDs that are still in parliament and</span></span>
<span id="cb14-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hence have NA in the date they left parliament.</span></span>
<span id="cb14-3">australian_politicians<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>to[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(australian_politicians<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>to)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> end_date</span>
<span id="cb14-4"></span>
<span id="cb14-5">politicians_by_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb14-6">  politicians_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(australian_politicians,</span>
<span id="cb14-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniqueID"</span></span>
<span id="cb14-9">            )</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., australian_politicians, by = "uniqueID"): Detected an unexpected many-to-many relationship between
`x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set
  `relationship = "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">politicians_by_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb16-2">  politicians_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">in_parliament_interval =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interval</span>(from, to),</span>
<span id="cb16-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">in_parliament_at_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%within%</span> in_parliament_interval, </span>
<span id="cb16-5">                                         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb16-6">                                         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-7">         ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(in_parliament_at_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>in_parliament_interval,</span>
<span id="cb16-10">         <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>in_parliament_at_date,</span>
<span id="cb16-11">         <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from,</span>
<span id="cb16-12">         <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>to)</span>
<span id="cb16-13"></span>
<span id="cb16-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(politicians_by_date)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  uniqueID     date       house
  &lt;chr&gt;        &lt;date&gt;     &lt;chr&gt;
1 Bonython1848 1901-04-13 HoR  
2 Braddon1829  1901-04-25 HoR  
3 Brown1861    1901-05-11 HoR  
4 Cameron1851  1901-06-13 HoR  
5 Chanter1845  1901-07-13 HoR  
6 Chapman1864  1901-07-14 HoR  </code></pre>
</div>
</div>
<p>Now that the dataset is a bit more tractable, I add the birthday of every uniqueID and then calculate their age, in days, for every date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">politicians_by_house_and_birthday <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb18-2">  all <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(uniqueID, birthDate, member, senator) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(member, senator), </span>
<span id="cb18-5">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"house"</span>, </span>
<span id="cb18-6">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"in_it"</span></span>
<span id="cb18-7">               ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(in_it <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>in_it) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">house =</span> </span>
<span id="cb18-11">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb18-12">             house <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"senator"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Senate"</span>,</span>
<span id="cb18-13">             house <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"member"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HoR"</span>,</span>
<span id="cb18-14">             <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OH NO"</span>)</span>
<span id="cb18-15">         )</span>
<span id="cb18-16"></span>
<span id="cb18-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if the catch-all has been invoked</span></span>
<span id="cb18-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># politicians_by_house_and_birthday[politicians_by_house_and_birthday$house == "OH NO",]</span></span>
<span id="cb18-19"></span>
<span id="cb18-20">politicians_by_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb18-21">  politicians_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(politicians_by_house_and_birthday,</span>
<span id="cb18-23">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniqueID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"house"</span>)</span>
<span id="cb18-24">            )</span>
<span id="cb18-25"></span>
<span id="cb18-26">politicians_by_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb18-27">  politicians_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(birthDate)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I can't find Trish Wortley's birthday and also</span></span>
<span id="cb18-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># we don't know the birthdates of some of the politicians from around Federation.</span></span>
<span id="cb18-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age_as_at_that_date =</span> date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> birthDate)</span>
<span id="cb18-31"></span>
<span id="cb18-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(politicians_by_date)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  uniqueID   date       house birthDate  age_as_at_that_date
  &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt; &lt;date&gt;     &lt;drtn&gt;             
1 Bonython1… 1901-04-13 HoR   1848-10-15 19172 days         
2 Braddon18… 1901-04-25 HoR   1829-06-11 26250 days         
3 Brown1861  1901-05-11 HoR   1861-10-06 14461 days         
4 Cameron18… 1901-06-13 HoR   1851-11-03 18119 days         
5 Chanter18… 1901-07-13 HoR   1845-02-11 20605 days         
6 Chapman18… 1901-07-14 HoR   1864-07-10 13517 days         </code></pre>
</div>
</div>
<p>I need to work out the average age for each day. There are some politicians for whom we do not know their exact birthdate. Those have been removed in this calculation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">average_age_by_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb20-2">  politicians_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age_as_at_that_date =</span> age_as_at_that_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ddays</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This just converts it into a days count</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(date, house) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(age_as_at_that_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) </span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">average_age_by_date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb22-2">  average_age_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_age_in_years =</span> average_age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) </span>
<span id="cb22-4"></span>
<span id="cb22-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(average_age_by_date)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   date [3]
  date       house  average_age average_age_in_years
  &lt;date&gt;     &lt;chr&gt;        &lt;dbl&gt;                &lt;dbl&gt;
1 1901-03-29 HoR         16765                  45.9
2 1901-03-29 Senate      16086.                 44.1
3 1901-03-30 HoR         17235                  47.2
4 1901-03-30 Senate      18878.                 51.7
5 1901-03-31 HoR         17236                  47.2
6 1901-03-31 Senate      18878.                 51.7</code></pre>
</div>
</div>
<p>I’ll do the same thing except to work out the average by election period. This requires grabbing the election periods (there’s an R package coming soon about this)!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">elections <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/RohanAlexander/australian_federal_elections/master/outputs/elections.csv"</span>,</span>
<span id="cb24-2">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dicc"</span>)</span>
<span id="cb24-3"></span>
<span id="cb24-4">average_age_by_election <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb24-5">  politicians_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(elections <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-7">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> electionDate) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-8">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>comment) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-9">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">house =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HoR"</span>),</span>
<span id="cb24-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"house"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(house <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HoR"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(date, uniqueID) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_election =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(electionWinner), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb24-15">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_election =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(is_election <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(is_election, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, is_election),</span>
<span id="cb24-16">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">election_counter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(is_election))</span>
<span id="cb24-17"></span>
<span id="cb24-18">average_age_by_election <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb24-19">  average_age_by_election <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age_as_at_that_date =</span> age_as_at_that_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ddays</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This just </span></span>
<span id="cb24-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># converts it into a days count</span></span>
<span id="cb24-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(election_counter) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(age_as_at_that_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb24-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">first_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(date)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_age_in_years =</span> average_age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() </span></code></pre></div>
</div>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="over-time" class="level3">
<h3 class="anchored" data-anchor-id="over-time">Over time</h3>
<p>There are considerable changes over time (Figure @ref(fig:maingraph)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">average_age_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter(year(date) == 1904) %&gt;%</span></span>
<span id="cb25-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter(month(date) == 2) %&gt;%</span></span>
<span id="cb25-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter(house == "HoR") %&gt;%</span></span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> average_age_in_years, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> house)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>,</span>
<span id="cb25-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average age (years)"</span>,</span>
<span id="cb25-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"House"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-12-02-average_age_of_australian_politicians/average_age_of_parliaments_files/figure-html/maingraph-1.png" class="quarto-discovered-preview-image img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Average age in the Australian Federal Parliament on a daily basis</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>I’ll just separate each of the houses because there’s a lot going on there (Figures @ref(fig:justrepsthings) and @ref(fig:justsenatethigns)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">average_age_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(house <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HoR"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> average_age_in_years)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F90000"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>,</span>
<span id="cb26-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-12-02-average_age_of_australian_politicians/average_age_of_parliaments_files/figure-html/justrepsthings-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Average age in the lower house on a daily basis</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">average_age_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(house <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Senate"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> average_age_in_years)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0080BD"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>,</span>
<span id="cb27-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-12-02-average_age_of_australian_politicians/average_age_of_parliaments_files/figure-html/justsenatethigns-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Average age in the upper house on a daily basis</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="group-by-election-period" class="level3">
<h3 class="anchored" data-anchor-id="group-by-election-period">Group by election period</h3>
<p>We can also look at a summary of the results, averaged across days, on the basis of each election period (Table @ref(tab:maintable) and Figure @ref(fig:othergraph)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">average_age_by_election <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>average_age) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Election number</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> election_counter,</span>
<span id="cb28-4">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Period begins</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> first_date,</span>
<span id="cb28-5">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Average age (years)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> average_age_in_years) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average age by for each period between lower house elections"</span>,</span>
<span id="cb28-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb28-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">booktabs =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Average age by for each period between lower house elections</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Election number</th>
<th style="text-align: left;">Period begins</th>
<th style="text-align: right;">Average age (years)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">1901-03-29</td>
<td style="text-align: right;">48.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">1903-12-16</td>
<td style="text-align: right;">48.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">1906-12-12</td>
<td style="text-align: right;">49.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">1910-04-13</td>
<td style="text-align: right;">50.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">1913-05-31</td>
<td style="text-align: right;">49.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">1914-09-05</td>
<td style="text-align: right;">51.9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">1917-05-05</td>
<td style="text-align: right;">53.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">1919-12-13</td>
<td style="text-align: right;">52.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">1922-12-16</td>
<td style="text-align: right;">51.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">1925-11-14</td>
<td style="text-align: right;">52.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">1928-11-17</td>
<td style="text-align: right;">50.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: left;">1929-10-12</td>
<td style="text-align: right;">49.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">1931-12-19</td>
<td style="text-align: right;">52.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: left;">1934-09-15</td>
<td style="text-align: right;">51.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: left;">1937-10-23</td>
<td style="text-align: right;">51.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: left;">1940-09-21</td>
<td style="text-align: right;">52.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: left;">1943-08-21</td>
<td style="text-align: right;">51.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">1946-09-28</td>
<td style="text-align: right;">53.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">1949-12-10</td>
<td style="text-align: right;">50.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">1951-04-28</td>
<td style="text-align: right;">52.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: left;">1954-05-29</td>
<td style="text-align: right;">53.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: left;">1955-12-10</td>
<td style="text-align: right;">52.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: left;">1958-11-22</td>
<td style="text-align: right;">52.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: left;">1961-12-09</td>
<td style="text-align: right;">53.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: left;">1963-11-30</td>
<td style="text-align: right;">53.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: left;">1966-11-26</td>
<td style="text-align: right;">52.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: left;">1969-10-25</td>
<td style="text-align: right;">51.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td style="text-align: left;">1972-12-02</td>
<td style="text-align: right;">49.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">29</td>
<td style="text-align: left;">1974-05-18</td>
<td style="text-align: right;">48.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: left;">1975-12-13</td>
<td style="text-align: right;">47.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: left;">1977-12-10</td>
<td style="text-align: right;">47.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">32</td>
<td style="text-align: left;">1980-10-18</td>
<td style="text-align: right;">48.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">33</td>
<td style="text-align: left;">1983-03-05</td>
<td style="text-align: right;">47.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">34</td>
<td style="text-align: left;">1984-12-01</td>
<td style="text-align: right;">48.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">35</td>
<td style="text-align: left;">1987-07-11</td>
<td style="text-align: right;">49.4</td>
</tr>
<tr class="even">
<td style="text-align: right;">36</td>
<td style="text-align: left;">1990-03-24</td>
<td style="text-align: right;">48.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: left;">1993-03-13</td>
<td style="text-align: right;">48.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">38</td>
<td style="text-align: left;">1996-03-02</td>
<td style="text-align: right;">48.9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">39</td>
<td style="text-align: left;">1998-10-03</td>
<td style="text-align: right;">49.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: left;">2001-11-10</td>
<td style="text-align: right;">50.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: left;">2004-10-09</td>
<td style="text-align: right;">51.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">42</td>
<td style="text-align: left;">2007-11-24</td>
<td style="text-align: right;">51.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">43</td>
<td style="text-align: left;">2010-08-21</td>
<td style="text-align: right;">51.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: left;">2013-09-07</td>
<td style="text-align: right;">50.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: left;">2016-07-02</td>
<td style="text-align: right;">50.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: left;">2019-05-18</td>
<td style="text-align: right;">51.7</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">average_age_by_election <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> first_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> average_age_in_years)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>,</span>
<span id="cb29-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-12-02-average_age_of_australian_politicians/average_age_of_parliaments_files/figure-html/othergraph-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Average age in the Australian Federal Parliament, by election period</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="compare-with-average-age" class="level3">
<h3 class="anchored" data-anchor-id="compare-with-average-age">Compare with average age</h3>
<p>To get a sense of whether the parliament is unusual we need know what is happening the broader population over this time. Fortunately, I know someone who is fairly handy when it comes to demography who can help.<sup>3</sup></p>
<p>Although it’s going to average over elections, which we’ve seen is a big source of variation, we can create an average age for each year, and then compare that against data from the Australian Bureau of Statistics (ABS). The ABS provides an estimate of historical population statistics in 3105.0.65.001 - Australian Historical Population Statistics, 2016, which was released in 2019. I want the second data cube - 2 - Population Age and Sex Structure - and within that I want Table 2.18 - Median age by sex, states and territories, 30 June, 1861 onwards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readxl)</span>
<span id="cb30-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'janitor'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">ABS_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3105065001ds0002_2019.xls"</span>, </span>
<span id="cb33-2">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sheet =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Table 2.18"</span>,</span>
<span id="cb33-3">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-4">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area_and_type =</span> x1,) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb33-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x1861, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x1870, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x1871, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x1881, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x1891)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">ABS_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb35-2">  ABS_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(area_and_type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Males"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Females"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Persons"</span>), area_and_type, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb35-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area_and_type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(type), area_and_type, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb35-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(area_and_type, type, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb35-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fill</span>(area_and_type, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"down"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb35-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area_and_type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(area_and_type, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">(f</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">)</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">(g</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>))</span>
<span id="cb35-8"></span>
<span id="cb35-9">ABS_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb35-10">  ABS_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb35-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(area_and_type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australia"</span>,</span>
<span id="cb35-12">         type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Persons"</span>)</span>
<span id="cb35-13"></span>
<span id="cb35-14">ABS_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb35-15">  ABS_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>),</span>
<span id="cb35-17">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>,</span>
<span id="cb35-18">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"median"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb35-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(year, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>),</span>
<span id="cb35-20">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area =</span> area_and_type)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">average_age_by_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb36-2">  politicians_by_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age_as_at_that_date =</span> age_as_at_that_date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ddays</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This just </span></span>
<span id="cb36-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># converts it into a days count</span></span>
<span id="cb36-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(age_as_at_that_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_age_in_years =</span> average_age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() </span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">average_age_by_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(ABS_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(year, average_age_in_years, median) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Politicians =</span> average_age_in_years,</span>
<span id="cb37-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Overall =</span> median) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Politicians, Overall), </span>
<span id="cb37-7">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"population"</span>,</span>
<span id="cb37-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"median"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> median, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> population)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_smooth() +</span></span>
<span id="cb37-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb37-15">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Median age (years)"</span>,</span>
<span id="cb37-16">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 23 rows containing missing values
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2021-12-02-average_age_of_australian_politicians/average_age_of_parliaments_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding remarks</h2>
<p>I’ve had a brief look at the average age of politicians in the Australian Parliament. In general, I’ve found that they’re older than the general population, and that there’s a lot of variation.</p>
<p>More generally, I’ve shown one of the advantages of putting data onto GitHub, and wrapping that in an R Package where possible. If you don’t like my analysis then you can grab the data yourself and play around with it!</p>
<p>As I mentioned at the top, <a href="https://florencevdubois.github.io">Florence Vallée-Dubois</a> does a lot more of this type of work in her thesis ‘Growing old : Population ageing and democratic representation in Canada’ where she looks at ‘whether the social changes brought about by population ageing also have implications for electoral politics and democratic representation.’ There’s probably a lot of similar work that could be done for Australia.</p>
</section>



<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thanks very much to Ben Readshaw and Florence Vallée-Dubois for motivating this note, and to Monica Alexander for her thoughtful comments.</p>



</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-citeaustralianpoltiicaisn" class="csl-entry">
Alexander, Rohan, and Paul A. Hodgetts. 2021. <em>AustralianPoliticians: Provides Datasets about Australian Politicians</em>. <a href="https://CRAN.R-project.org/package=AustralianPoliticians">https://CRAN.R-project.org/package=AustralianPoliticians</a>.
</div>
<div id="ref-citedistill" class="csl-entry">
Allaire, JJ, Rich Iannone, Alison Presmanes Hill, and Yihui Xie. 2021. <em>Distill: ’R Markdown’ Format for Scientific and Technical Writing</em>. <a href="https://CRAN.R-project.org/package=distill">https://CRAN.R-project.org/package=distill</a>.
</div>
<div id="ref-citeLubridate" class="csl-entry">
Grolemund, Garrett, and Hadley Wickham. 2011. <span>“Dates and Times Made Easy with <span class="nocase">lubridate</span>.”</span> <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="https://www.jstatsoft.org/v40/i03/">https://www.jstatsoft.org/v40/i03/</a>.
</div>
<div id="ref-citeR" class="csl-entry">
R Core Team. 2020. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-citeTidyverse" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-citeKnitr" class="csl-entry">
Xie, Yihui. 2020. <em>Knitr: A General-Purpose Package for Dynamic Report Generation in r</em>. <a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Monica Alexander uses an early version of this dataset to look at the average age of death of Australian politicians: https://www.monicaalexander.com/posts/2019-08-09-australian_politicians/.↩︎</p></li>
<li id="fn2"><p>There are a handful of politicians who sat in the parliament, but were never elected - when the first parliament sat, there were initially some who were just appointed, and never went on to seek election. Conversely, there is one politician - Heather Hill - who was elected, but whose election was reversed before she could take her seat. While she never served in either house, she is included in the dataset for purposes of being able to link it to the elections dataset. However she is not included in the number of Australian politicians.↩︎</p></li>
<li id="fn3"><p>If you’re interested in this sort of thing, then a PhD with <a href="https://www.monicaalexander.com">Monica Alexander</a> is probably the way to go.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-12-02-average_age_of_australian_politicians/average_age_of_parliaments.html</guid>
  <pubDate>Thu, 02 Dec 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Review of ‘Data Science: A First Introduction’</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-11-30-review_of_timbers/timbers_review.html</link>
  <description><![CDATA[ 



<p>“Data Science: A First Introduction” by Tiffany-Anne Timbers, Trevor Campbell, and Melissa Lee from University of British Columbia’s Department of Statistics is the first-year data science textbook by which all others will be judged. It is a kind, yet rigorous, textbook that provides a foundation on which students can quickly answer exciting questions. One can imagine the authors saying to a new student ‘I’ve spent my life learning all this exciting stuff, and I can’t wait to share it with you’.</p>
<p>The book is effectively divided into three parts: the first four chapters focus on data; the next six chapters go through statistical methods; and the final three brief chapters introduce tools such as Jupyter, version control, and local installation.</p>
<p>Chapter 1 focuses on R and the <code>tidyverse</code> and is based around a dataset of languages spoken in Canada. It introduces key verbs, such as <code>filter</code>, <code>select</code>, <code>arrange</code>, and <code>slice</code>, as well as <code>ggplot2</code>. Chapter 2 covers how to get data into R; initially using CSV and TSV files, but then turning to SQL. This early focus on SQL (starting at p.&nbsp;41) is a key feature of this book, and one that will pay dividends for students as they progress with subsequent courses. This chapter again uses the Canadian languages dataset. Chapter 3 focuses on cleaning and wrangling data within the tidy data framework. Key verbs including <code>mutate</code>, <code>summarize</code>, <code>map</code>, <code>pivot_wider</code>, and <code>pivot_longer</code> are introduced in this chapter, as is the base pipe operator <code>|&gt;</code>. This example of the authors’ decision to use the latest innovation, is reflected throughout the book in many other choices. The chapter uses a dataset of Canadian city populations and the Canadian languages dataset. Chapter 4 focuses on data visualization with <code>ggplot2</code>, especially scatter plots, line plots, bar plots, histograms, and how to improve on the default plots. The chapter uses the Old Faithful eruptions dataset and the Michelson’s speed of light dataset. The pages in this chapter that tell students how to explain a visualization (pp.&nbsp;168-169) are an absolute treat.</p>
<p>Chapters 5 through to 10 focus on statistical methods. Chapters 5 and 6 are focused on classification, firstly introducing K-nearest neighbors, and then using this to introduce <code>tidymodels</code> and data preprocessing, which Chapter 6 then builds on to focus on test and training datasets, evaluation, and tuning, including lovely discussions of pre-processing and cross-validation. These chapters use the breast cancer dataset. There is a very nice discussion of what it means to be ‘good’ when it comes to accuracy on p.&nbsp;224. Chapter 7 introduces regression using K-nearest neighbors and discusses underfitting and overfitting. It uses a real estate dataset from Sacramento. Chapter 8 turns to classical linear regression including simple and multivariable. There is some discussion of multicollinearity and outliers as well as prediction. This chapter again uses the Sacramento real estate dataset. Chapter 9 focuses on clustering within the context of K-means, including thorough discussions of how it all works, and some of the limitations. It uses the Palmer Penguins dataset. Finally, Chapter 10 discusses statistical inference, and sampling, including a lovely treatment of bootstrapping. It uses a dataset from Airbnb.</p>
<p>Chapters 11 through to 13 focus on tools. Chapter 11 introduces Jupyter including execution and markdown. Chapter 12 introduces version control and GitHub, covering not just commit, push, and pull, but also dealing with GitHub PATs, cloning, and collaboration including merge conflicts. Finally, Chapter 13 briefly covers installing all this locally, on the assumption that the reader to this point has been able to use a cloud solution that was already set-up for them.</p>
<p>To a certain extent data science textbooks are playing catch-up: we’ve long had methods texts in discipline-specific areas, but data sciences today is largely following demand from research/industry to move these methods into other areas – what discipline at a university covers real estate pricing? Into that void, Timbers, Campbell, and Lee, is the standard by which all other introductory data science textbooks will be judged. It is a rare immediate addition to the pantheon of introductory data science textbooks released (or updated) in the past five years, taking its place alongside R4DS, ISLR, and Statistical Rethinking. It introduces data science in a way that specifies exactly what a student needs and anticipates many of their questions. Its content will represent table stakes in terms of what we expect of students after they take first-year classes.</p>
<p>I made it 10 per cent of the way through Timbers et al before I learnt something new. Frankly I was surprised I made it so far. Data science pedagogy has been so disjoint and so many of us are self-taught that it is refreshing to have a class-room-tested textbook that is focused on workflows and reproducibility. The approaches are rigorous and opinionated, and the text is filled with kindness and warmth. It is the book that I wish I had when I first came to learn this material. The book is unashamedly focused on the newest innovations including <code>tidymodels</code> and the native pipe operator, and I soon found myself learning things, on average, at roughly one-thing-per-page, which was an exciting experience for someone who spends his days doing and teaching data science in R. This is a text that I can see myself coming back to regularly, not just in my teaching, but as a reference. I am hopeful that the authors will go on to write “Data Science”, and “Advanced Data Science”, without too much delay!</p>
<p>I mentioned kindness and warmth earlier, but it permeates the book. And there are many sections that proactively address questions that new students often have. For instance, p.&nbsp;11 when a dataset is assigned to a name, the authors acknowledge how perplexing it can be to a student that nothing happens. Pleasingly the authors place reproducibility front-and-center of data science. For instance, the use of seeds is emphasised throughout the text, as is the importance of code that others can run.</p>
<p>There is extensive use of ‘Notes’ to separate more reflective content. One can imagine many of these are the result of the countless hours the authors have spent teaching this material. More generally, all aspects are clearly explained and built-up slowly. Chapter 3, which focuses on tidy data, is a particularly strong example of this. The text places potential research questions throughout, which may help retain student interest throughout.</p>
<p>While it’s clear that I think the book is great, there are a few areas there I wish they had expanded on a little. For instance, on p.&nbsp;3 Timbers et al say ‘when you work with data, it is essential to think about how the data were collected, which affects the conclusions you can draw. If your data are biased, then you results will be biased.’ But there is not much coverage of this throughout the book. I wonder if subsequent editions of this book could consider more explicit coverage of ethics especially around data collection, following say, D’Ignazio and Klein <em>Data Feminism</em>, and also around applications of these methods, following say, O’Neil <em>Weapons of Math Destruction</em>? Similarly, it may make sense to introduce sampling concepts alongside data collection.</p>
<p>A free version of the textbook is available here: https://ubc-dsci.github.io/introduction-to-datascience/ and it is forthcoming from CRC Press. When it’s available I’d recommend that everyone buy it and assign it in their classes.</p>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>I was provided with a PDF version of the book for the purposes of writing a blurb. There are no other financial disclosures. I printed and bound it at my own expense. At my invitation Timbers has previously spoken at an event—Toronto Workshop on Reproducibility—that I organized earlier this year.</p>


</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-11-30-review_of_timbers/timbers_review.html</guid>
  <pubDate>Tue, 30 Nov 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Remarks at Trinity College</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-10-19-trinity_remarks/trinity_remarks.html</link>
  <description><![CDATA[ 



<p>The slides are <a href="https://rohanalexander.com/pdfs/trinity_college_remarks.pdf">here</a>.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Hi, my name is Rohan Alexander. I’m an assistant professor in the Faculty of Information and the Department of Statistical Sciences at the University of Toronto. I’d like to thank Academic Don, Statistics, Manmeet Sangha for the invitation to talk today at Trinity College.</p>
<p>When I asked the undergraduate students that I work with who was associated with ‘Trin’, it was no surprise to me that the college was well represented among the strongest ones. ‘Trinnies’ have a well-deserved reputation for academic excellence and the number of people that have shown up for this event speaks to how that tradition continues even under trying circumstances.</p>
<p>I’ve only got 5 minutes, so I’d like to touch on just two aspects:</p>
<ul>
<li>An example of what I do in data science.</li>
<li>Some steps to get started in data science.</li>
</ul>
</section>
<section id="what-i-do-in-data-science" class="level2">
<h2 class="anchored" data-anchor-id="what-i-do-in-data-science">What I do in data science</h2>
<p>There is no agreed definition of data science, but an informal one is: ‘humans measuring stuff, typically related to other humans, and using sophisticated averaging to explain and predict’.</p>
<p>I like that definition because it does not treat data as terra nullius, or nobody’s land. Data must be gathered, cleaned, and prepared, and these decisions matter. Every dataset is sui generis, or a class by itself.</p>
<p>A lot of what my research does is try to understand the specific nuances of specific datasets, especially in terms of who is included in them, and who is not, and understand how this affects inference.</p>
<p>One example of this is natural language processing. There we use really big models, built on a lot of data, to generate text. To make sure everyone knows what that means, here’s a model that has two parameters: <img src="https://latex.codecogs.com/png.latex?y%20=%20x1%20+%20x2">. And is trained on 5 rows of data.</p>
<p>OpenAI’s GPT-3 has 175 billion parameters and was trained on essentially the whole internet. I’ll do a quick demonstration of asking it: “What is Trinity College, Toronto?”, “Which famous person went to Trinity College, Toronto?”</p>
<p>[Live demo]</p>
<p>GPT-3, like any language model, can generate racist/sexist text. With a student I recently used it to see whether its ability to generate racist/sexist text, also meant that it could recognize racist/sexist text and explain what made it racist/sexist. The results were disappointing and lead to a variety of conclusions, including the fact that we need to do a better job of putting together the enormous datasets that underpin these models.</p>
</section>
<section id="some-steps-to-get-started-in-data-science" class="level2">
<h2 class="anchored" data-anchor-id="some-steps-to-get-started-in-data-science">Some steps to get started in data science</h2>
<p>One way to contribute in data science is to be at the intersection of two areas. Typically statistics and something else. Then you need to immerse yourself in the data. One of the most successful ‘Trinnies’ - Michael Ignatieff (IG-NAH-TEE-UHF) - says about politics that</p>
<blockquote class="blockquote">
<p>The grind of politics, the endless travel, the meetings, the impossible schedule, the constant being on show are all in search of an authority that can be acquired in no other way. You have to learn the country.</p>
</blockquote>
<p>And it’s the same in data science - you need to become an expert in some dataset by doing the grinding, endless, impossible schlep to understand it. Only then can you even begin to consider inference and prediction.</p>
<p>A lot of what you do in class is play house; when what you need to do is actually build something. One thing that helped me in this regard was getting to work with professors.</p>
<p>So how do you get to work with a professor? There’s an easy answer, which I expect is relevant for many ‘Trinnies’, and that’s to just to get an A+ in their class. But more generally, you should send an email that demonstrates that you’ve got:</p>
<ul>
<li>an interest; and</li>
<li>some skills.</li>
</ul>
<p>For instance, these days a lot of papers in the fields that I’m interested in need some type of R package to go alongside them, and it can be hard to find students who can do this. If a student emailed having made an R package, that would demonstrate a lot of interest and skills, and it would be clear how I could involve them. There’s an enormous difference between a student who emails claiming to know R, and a student who emails a link to a GitHub repo that demonstrates it.</p>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding remarks</h2>
<p>Thank you very much to Manmeet for the invitation to be on this panel. It’s a great honour to be here, alongside my colleagues - Sam, Emma, and Morris - and one of my bosses - Helen! Very much looking forward to the discussion.</p>


</section>

 ]]></description>
  <guid>https://rohanalexander.com/posts/2021-10-19-trinity_remarks/trinity_remarks.html</guid>
  <pubDate>Tue, 19 Oct 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Introduction to Andrew Gelman</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-09-17-andrew-gelman-dsi-intro/andrew_gelman_intro.html</link>
  <description><![CDATA[ 



<p>The slides are <a href="https://rohanalexander.com/pdfs/dsi_gelman_intro.pdf">here</a>.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Hi, my name is Rohan Alexander. I’m an assistant professor jointly across Information and Statistical Sciences. I’m also the Assistant Director of the Canadian Statistical Sciences Institute (CANSSI), Ontario, which strengthens research and training in data science. And in that capacity it is a pleasure to introduce our next speaker, Andrew Gelman.</p>
</section>
<section id="andrew-gelman" class="level2">
<h2 class="anchored" data-anchor-id="andrew-gelman">Andrew Gelman</h2>
<p>Andrew Gelman is Higgins Professor of Statistics and Professor of Political Science at Columbia University. He believes ‘the #1 neglected topic in statistics is measurement’</p>
</section>
<section id="rent" class="level2">
<h2 class="anchored" data-anchor-id="rent">Rent</h2>
<p>And so, with apologies to Rent, how should we measure his career? With blog posts? With papers? With software? With cups of coffee? With books? Or by the others who relied?</p>
<p>I’ve been unable to verify his coffee consumption, but by any other measure, Andrew Gelman, puts most to shame.</p>
</section>
<section id="books" class="level2">
<h2 class="anchored" data-anchor-id="books">Books</h2>
<p>He has published many books and I’ll just touch on two.</p>
<p>With co-authors, his foundational Bayesian statistics textbook—<em>Bayesian Data Analysis</em>—was first published in 1995. It has been cited something like 30,000 times. And now on its 3rd edition, it is the basis for many foundational courses on Bayesian statistics.</p>
<p>A more applied textbook, co-authored with Jennifer Hill—<em>Data Analysis using Regression and Multilevel Models</em>—was published in 2006. That book has been cited something like 14,000 times, and forms the foundation for many applied statistics courses.</p>
<p>My wife, Monica, is an assistant professor jointly in statistical sciences and sociology, and in my household these are known, respectively, as the Old and New Testament.</p>
</section>
<section id="blog" class="level2">
<h2 class="anchored" data-anchor-id="blog">Blog</h2>
<p>Gelman’s blog—Statistical Modeling, Causal Inference, and Social Science—launched in 2004—is the go-to place for a fun mix of somewhat-nerdy statistics-focused content. The very first post promised to ‘…report on recent research and ongoing half-baked ideas, including … Bayesian statistics, multilevel modeling, causal inference, and political science.’ 17 years on, the site has very much kept its promise.</p>
</section>
<section id="reproducibility" class="level2">
<h2 class="anchored" data-anchor-id="reproducibility">Reproducibility</h2>
<p>One thing the blog does is enable Gelman to make contributions and influence debate in a way that isn’t possible in papers or books. For instance, it enables him to share short snippets of code, explain how he approaches problems, and sketch solutions.</p>
<p>Gelman’s blog is where he’s done a lot of writing about reproducibility—one of the DSI’s Thematic Programs. Arguably Andrew’s blog posts brought the replication crisis that enveloped social sciences to the fore. A lot of my colleagues now push reproducibility; both in their teaching and in their research. And that’s in large part because we intellectually grew up reading Gelman’s blog posts about it.</p>
</section>
<section id="papers" class="level2">
<h2 class="anchored" data-anchor-id="papers">Papers</h2>
<p>By any measure, Andrew Gelman is a prolific author of papers, with something like 400 based on a recent count. My favourite of these is affectionately known as ‘the XBox paper’ which was published in 2015.</p>
<p>These days the statistical approach that underpinned that paper—multilevel regression with post-stratification or MRP—is used by almost every major polling company to some extent. And teams of undergraduates at the UofT used MRP to correctly forecast a Biden victory last year. If you’re interested in learning more about MRP, Andrew Gelman, Lauren Kennedy and I are putting together a book about MRP that is forthcoming with Cambridge University Press next year.</p>
</section>
<section id="stan" class="level2">
<h2 class="anchored" data-anchor-id="stan">Stan</h2>
<p>Andrew was foundational in the development of Stan - a probabilistic programming language, which has become the predominant way to implement Bayesian models.</p>
<p>Funnily enough the origin of Stan is that Gelman was trying to expand on some of the models in his book with Jennifer Hill that I mentioned earlier. He found that the software was struggling to do it. With co-authors he found that a change in the way random samples were obtained worked well, especially when combined with a few other innovations. One thing led to another, and a revolution in scientific computing ensued.</p>
</section>
<section id="impact-on-others" class="level2">
<h2 class="anchored" data-anchor-id="impact-on-others">Impact on others</h2>
<p>Andrew Gelman is someone who has made incredible contributions in a range of data science and perfectly characterises what we’re trying to do with this Data Sciences Institute. To this point, I’ve stuck with things that are relatively easy to measure. Following the spirit of our guest, I’d like to close with something less easy to measure; and that is, the impact on others.</p>
<p>In my own case, I wouldn’t be speaking here today if it weren’t for Andrew: I learnt statistics from his books, his XBox paper gave my career purpose, I copy-paste his code most days, his blog provided me with a community, and from his example I learnt the type of academic I wanted to be.</p>
<p>And when I asked a few others it seems that feeling was unanimous.</p>
<blockquote class="blockquote">
<p>His blog made me realise that there is a place for people like me, that is, people who want to do good applied stats on interesting social problems. This and reading Gelman Hill influenced my decision to go to grad school.</p>
<p>Monica Alexander</p>
</blockquote>
<blockquote class="blockquote">
<p>Andrew provided a voice that cut through the often confusing and rule based interpretation of statistics to instead provide an interpretation that is reason based. This represented a turning point for me in the way I understood existing statistical problems and rationalised about new challenges.</p>
<p>Lauren Kennedy</p>
</blockquote>
<blockquote class="blockquote">
<p>His class (and writing) showed me the connections between statistics, science, and philosophy and gave me a language through which to express my frustrations with the ways that data is tortured. I particularly appreciated his emphasis that “stats is hard” and it’s OK to make mistakes as long as you learn from them!</p>
<p>James Doss-Gollin</p>
</blockquote>
<blockquote class="blockquote">
<p>Working in government and politics, I channel Andy, both as a statistician and as a teammate. I quote insights from his books, papers, and blog posts. I learn from his humor, openness about being confused, and commitment to doing the right thing.</p>
<p>Shira Mitchell</p>
</blockquote>
<blockquote class="blockquote">
<p>Andrew’s my Obi-Wan-Kenobi.</p>
<p>Bob Carpenter</p>
</blockquote>
<blockquote class="blockquote">
<p>Andrew’s blog made me aware of the shortcomings in my training and research, and gave me motivation to improve. It also gave me the motivation to get out of projects that could become posts in the Zombies category.</p>
<p>Marta Kołczyńska</p>
</blockquote>
<blockquote class="blockquote">
<p>Here’s something that I really appreciate about Andrew and isn’t common enough in academia: if you do good work Andrew will want to work with you (even hire you) regardless of your credentials.</p>
<p>Jonah S Gabry</p>
</blockquote>
<blockquote class="blockquote">
<p>My conception of what good research was - what kind of research I wanted to be doing - completely changed when I read Andrew’s paper on the garden of forking paths. It was one of the main reasons I decided to go back to school for a degree in statistics, and it’s deeply influenced the way I try to do research and the research practices I advocate for at my workplace. Since that paper came out in 2013 I’ve been a dedicated reader of his blog, and his posts have made me fundamentally rethink the way I do research an embarrassing number of times - and they continue to motivate me to try to do careful and thoughtful work.</p>
<p>Isaac Maddow-Zimet</p>
</blockquote>
<p>So it’s a very warm virtual welcome to Toronto, Professor Andrew Gelman. Thank you for everything you’ve done for data science, and thank you for helping us to launch our Data Sciences Institute.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thank you very much to Monica Alexander, and members of my research group, for reading a draft of this. And to Jonah Gabry for the Stan historical background. And thank you to Isaac, Jonah, Marta, Bob, Shira, James, Lauren, and Monica for providing quotes.</p>


</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-09-17-andrew-gelman-dsi-intro/andrew_gelman_intro.html</guid>
  <pubDate>Fri, 17 Sep 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Turning our world into data</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-07-06-turning-our-world-into-data/turning-our-world-into-data.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Hi, I’d like to thank Jesse Gronsbell for letting me talk today. My name is Rohan Alexander, and I’m an assistant professor in the Faculty of Information and the Department of Statistical Sciences at the University of Toronto.</p>
<p>Professor Gronsbell is also a professor in Statistical Sciences, but that’s about where my comparison with Jesse ends. Jesse works on a wide range of biostatistics problems, using classical statistical techniques to solve new problems, especially with large observational health data sets such as electronic health records. It’s a privilege to get to call her a colleague in data science.</p>
<p>I’m just someone who likes to play with data using the statistical programming language R <span class="citation" data-cites="citeR">(R Core Team 2020)</span>. And the nice thing about what we now call data science is that there’s space for both of us. And there’s space for you as well.</p>
</section>
<section id="my-path-to-data-science" class="level2">
<h2 class="anchored" data-anchor-id="my-path-to-data-science">My path to data science</h2>
<p>I’m 34 and so I’m in the ‘data science didn’t exist when I was an undergrad’ generation. Most of you are about 17, or about half my age. When I was 17, I wasn’t thinking about data science summer camps nor self-driving cars, so it’s commendable that you’re already so advanced.</p>
<p>When I was 17 I just went to uni and studied economics, because that’s what my friends were doing. Luckily, I had some terrific mentors including Rabee Tourkey, Flavio Menezes, and Leo Yanes, and what they did was give broad instructions then get out of the way and check in weekly. While I don’t think I delivered anything of value to them, that experience of working directly with professors was formative for me.</p>
<p>One day I was in the library with a friend, and I wanted to go to the pub, but my friend insisted I wait until he’d applied for an internship at the Reserve Bank of Australia (RBA). I didn’t want to go to the pub without him, so I applied for that internship as well while I was waiting.</p>
<p>Be careful who you make friends with because the result was that after uni I worked for a bit at the RBA, which is Australia’s central bank (think: Fed Reserve) and that was great because I learnt about just how vital communication—both written and speaking—is. (My friend didn’t get the internship, but he ended up at Goldman Sachs, so he’s doing just fine.) And also, about navigating a traditional workplace.</p>
<p>After that I started a business with some friends because that was what I was doing when I wasn’t at work, and it seemed to make sense to make that my actual job. And that start-up was great because I learnt about strategy, tactics, execution, teamwork, and leadership; all the stuff that traditional workplaces don’t let junior analysts worry about</p>
</section>
<section id="why-data-science-is-exciting" class="level2">
<h2 class="anchored" data-anchor-id="why-data-science-is-exciting">Why data science is exciting</h2>
<p>I’d like to come back to that earlier point—that data science didn’t exist when I was 17—because it may imply that one should not just be making decisions that optimize for what data science looks like right now, but also what could happen. While that’s a little difficult, that’s also one of the things that makes data science so exciting. As a 17-year-old that might mean choices like:</p>
<ol type="1">
<li>taking courses on fundamentals, not just fashionable applications;</li>
<li>reading books, not just whatever is trending on Hacker News; and</li>
<li>trying to be at the intersection of at least a few different areas, rather than hyper-specialized.</li>
</ol>
<p>When that start-up finished, I started a PhD. My PhD is actually in economic history, so if I had my way, I’d spend my time in dusty, beautiful libraries reading old books and drinking coffee in the morning, and then writing code and drinking wine in the afternoon. Your library at Harvard is very nice, but not quite dusty enough for me, and you’re not allowed wine in there. The Faculty of Information, which is one of my appointments, originally existed to train librarians, so these days I get an office in a library, which is great, and my role is ‘human centered data science’, so it’s very much the best of both worlds. I get to turn our world into data, analyse it, and get paid to do it!</p>
<p>I spent most of my PhD trying to deal with big text datasets. And when I say ‘dealing’ I mean using R to clean and tidy them, which was the work of years. My supervisors—John Tang, Tim Hatton, Martine Mariotti, and Zach Ward—gave me the freedom to do what I wanted, again with regular weekly meetings. It’s not a topic that traditionally would have been appropriate, and I’m grateful they gave me the space because traditional economics is not for me, but data science is. And I hope that you also consider that it could be for you.</p>
</section>
<section id="what-data-science-means-to-me" class="level2">
<h2 class="anchored" data-anchor-id="what-data-science-means-to-me">What data science means to me</h2>
<p>What is data science? There’s not one agreed on definition, but a lot of people have tried. My other appointment is in the Department of Statistical Sciences, and my boss there says <span class="citation" data-cites="Craiu2019Hiring">(Craiu 2019)</span>:</p>
<blockquote class="blockquote">
<p>This unsureness isn’t necessarily the weakness many consider it. After all, who can really say what makes someone a poet or a scientist? Even so, some things can be said. In broad strokes, … someone with a data driven research agenda, who adheres to or aspires to using a principled implementation of statistical methods and uses efficient computation skills.</p>
</blockquote>
<p>I like this definition, but I also think there’s value in having a simple definition, even if we lose a bit of specificity in the process. Probability, which is related to statistics, is often informally defined as ‘counting things’ <span class="citation" data-cites="mcelreath">(McElreath 2020, 10)</span>. In a similar informal sense, I’m currently playing around with a definition of data science that is something like ‘measuring stuff and averaging it, with purpose’.</p>
<p>One reason that I like this definition is that it doesn’t treat data as <em>terra nullius</em>, or nobody’s land. Statisticians tend to see data as the result of some data generating process, which we can never know, but that we try to use data to come to understand. I’m oversimplifying here, and many statisticians care deeply about data, but at the same time, there’s a lot of cases in statistics where the data kind of just appear; they belong to no one. But that’s just never the case.</p>
<p>Data have to be gathered, cleaned, and prepared, and these decisions matter <span class="citation" data-cites="huntington2021influence">(Huntington-Klein et al. 2021)</span>. I’ve come to believe that every dataset is <em>sui generis</em>, or in a class by itself, and so when you come to know one dataset really well, you just know one dataset, not all datasets.</p>
<p>During this data science camp, you’re going to be exposed to an awful lot of ‘science’. I’d like to spend a little more time in defence of ‘data’. And that’s another reason that I like my definition. I argue that the most important word in ‘data science’ is ‘data’ and would love to convince you of it.</p>
<p>I’ll take an example from <span class="citation" data-cites="Jordan2019Artificial">Jordan (2019)</span> where he talks about being in a medical office and being given some probability, based on prenatal screening, that his child, then a fetus, had Down syndrome. By way of background, you can decide to test to know for sure, but that test comes with the risk of the fetus not surviving, so this initial screening probability matters. <span class="citation" data-cites="Jordan2019Artificial">Jordan (2019)</span> describes how he found those probabilities were determined by a study done a decade earlier in the UK. The issue was that in the ensuing 10 years, imaging technology had improved so the test wasn’t expecting such high-resolution images and there had been a subsequent (false) increase in Down syndrome diagnoses when the images improved. There was no problem with the science here, it was the data that were the issue.</p>
</section>
<section id="tips-for-students" class="level2">
<h2 class="anchored" data-anchor-id="tips-for-students">Tips for students</h2>
<p>In my opinion, we are realising that it’s not just the ‘science’ bit that’s hard, it’s the ‘data’ bit as well. For instance, researchers went back and examined one of the most popular text datasets in computer science, and they found that around 30 per cent of the data were inappropriately duplicated <span class="citation" data-cites="bandy2021addressing">(Bandy and Vincent 2021)</span>. There’s a lot of people who could have told the computer scientists that those datasets would have big problems; there’s an entire field—linguistics—that specialises in this stuff. And this is one of the dangers of any one field being hegemonic, and why it’s important that you don’t specialise too early. Instead, pick at least two different areas, learn how the ‘insiders’ speak in each, and then be the person that translates between them.</p>
<p>Data science needs diversity. And it’s one reason that I’m excited to see you all here with your variety of skills and backgrounds—we need you in our research labs. We need your intelligence and enthusiasm. We need you to be in the room making contributions. And I think, just like me, that working directly with professors would be formative and enjoyable for you. I hope you’re lucky enough, like me, to be given the space to find what types of projects you’re intrinsically interested in, because then everything just becomes a lot easier.</p>
<p>How do you push down the door and work with professors? I was very lucky and it was a lot easier for me to get opportunities than it is for you, because there were fewer of us. But basically, what I think you should do is show a professor that you’ve got:</p>
<ol type="a">
<li>an interest; and</li>
<li>some skills.</li>
</ol>
<p>One way to do this is through demonstrating your interest in coding and the data science skills that you’re developing at this camp. For instance, these days a lot of papers in the fields that I’m interested in need some type of R package to go alongside them, and it can be hard to find students who can do this. If a student emailed having made an R package, that would show a lot of interest and skills, and it would be clear how I could involve them. Another thing that is increasingly needed is a datasheet <span class="citation" data-cites="gebru2020datasheets">(Gebru et al. 2020)</span>. So again, you could put together documentation for a dataset and email that. Again, it shows that you’ve got a genuine interest and that you’ve got a base of skills that would enable you to be useful.</p>
<p>Thanks very much for letting me speak. I know that everyone says this to you, and with apologies to Olivia Rodrigo, but being 17 is just such an exciting time of one’s life, and I’m glad to see that you’re making the most of it. One seems to go straight from being the youngest in the room to being the oldest, without any middle. And, just so that you know, you kind of never work life out— everyone is just making it up as they go.</p>
<p>I’d be happy to take any questions.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thank you very much to Monica for reading a draft of this.</p>



</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bandy2021addressing" class="csl-entry">
Bandy, Jack, and Nicholas Vincent. 2021. <span>“Addressing "Documentation Debt" in Machine Learning Research: A Retrospective Datasheet for BookCorpus.”</span> <a href="https://arxiv.org/abs/2105.05241">https://arxiv.org/abs/2105.05241</a>.
</div>
<div id="ref-Craiu2019Hiring" class="csl-entry">
Craiu, Radu V. 2019. <span>“The Hiring Gambit: In Search of the Twofer Data Scientist.”</span> <em>Harvard Data Science Review</em> 1 (1). <a href="https://doi.org/10.1162/99608f92.440445cb">https://doi.org/10.1162/99608f92.440445cb</a>.
</div>
<div id="ref-gebru2020datasheets" class="csl-entry">
Gebru, Timnit, Jamie Morgenstern, Briana Vecchione, Jennifer Wortman Vaughan, Hanna Wallach, Hal Daumé III au2, and Kate Crawford. 2020. <span>“Datasheets for Datasets.”</span> <a href="https://arxiv.org/abs/1803.09010">https://arxiv.org/abs/1803.09010</a>.
</div>
<div id="ref-huntington2021influence" class="csl-entry">
Huntington-Klein, Nick, Andreu Arenas, Emily Beam, Marco Bertoni, Jeffrey R Bloem, Pralhad Burli, Naibin Chen, et al. 2021. <span>“The Influence of Hidden Researcher Decisions in Applied Microeconomics.”</span> <em>Economic Inquiry</em>.
</div>
<div id="ref-Jordan2019Artificial" class="csl-entry">
Jordan, Michael I. 2019. <span>“Artificial Intelligence—the Revolution Hasn’t Happened Yet.”</span> <em>Harvard Data Science Review</em> 1 (1). <a href="https://doi.org/10.1162/99608f92.f06c6e61">https://doi.org/10.1162/99608f92.f06c6e61</a>.
</div>
<div id="ref-mcelreath" class="csl-entry">
McElreath, Richard. 2020. <em>Statistical Rethinking</em>. CRC Press.
</div>
<div id="ref-citeR" class="csl-entry">
R Core Team. 2020. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-07-06-turning-our-world-into-data/turning-our-world-into-data.html</guid>
  <pubDate>Tue, 06 Jul 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Opportunities Provided by Open Data and Reproducibility</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-05-22-baby-steps/baby-steps.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Hi, my name is Rohan Alexander. Thank you very much to Gwen and Josh for the opportunity to speak. I’m a baby professor at the University of Toronto, in the Faculty of Information and the Department of Statistical Sciences. Today I would like to talk about taking some baby steps toward open data and reproducibility. And in particular the opportunities provided by open data and reproducibility across applied statistics and astronomy.</p>
<p>I’d like to talk about three benefits of openness and reproducibility:</p>
<ol type="1">
<li>improved diversity broadly;</li>
<li>improving your own (future) life; and</li>
<li>building on-ramps for your collaborators.</li>
</ol>
<p>And then three baby steps that you could get started with this afternoon:</p>
<ol type="1">
<li>buy a bunch of notebooks;</li>
<li>write a datasheet; and</li>
<li>make a software package.</li>
</ol>
</section>
<section id="three-benefits" class="level2">
<h2 class="anchored" data-anchor-id="three-benefits">Three benefits</h2>
<p>By way of background, <span class="citation" data-cites="monicasrostockreprotalk">M. Alexander (2019)</span> says ‘research is reproducible if it can be reproduced exactly, given all the materials used in the study’. She goes on:</p>
<blockquote class="blockquote">
<p>Reproducibility is not just publishing your analysis code. The entire workflow of a research project––from formulating hypotheses to dissemination of your results––has decisions and steps that ideally should be reproducible.</p>
</blockquote>
<p><span class="citation" data-cites="opendatainstitute">Open Data Institute (2017)</span> defines open data as ‘data that’s available to everyone to access, use and share.’ Open data enables reproducibility and is the bedrock of progress.</p>
<section id="improved-diversity" class="level3">
<h3 class="anchored" data-anchor-id="improved-diversity">Improved diversity</h3>
<p>The first benefit that I see is improved diversity, broadly, in our fields. By making our work accessible to more people, we help to to make education and research resources more equitable. In Canadian STEM fields diversity at an undergraduate level is not great, but it’s also not too bad—we reflect broader Canadian society to some extent—but at each successive level we significantly worsen <span class="citation" data-cites="villemurewebb">(Villemure and Webb 2017)</span>. In my own Department of Statistical Sciences, University Professor Nancy Reid was the only tenured research-track woman in the department for decades. And in astronomy, speaking more broadly, <span class="citation" data-cites="prescordweinstein">Prescord-Weinstein (2021, 132)</span> says ‘I’ve never met a Black woman professor in the field of theoretical cosmology because I am the first—not just the first professor, but also the first Black woman cosmology theory PhD’<sup>1</sup>.</p>
<p>Improving diversity is important because diverse teams are associated with higher performance <span class="citation" data-cites="mckinsey">(Hunt et al. 2020)</span>. That’s just a correlation, but thinking about my own experiences, I do think that diversity in my own team improved my productivity. For instance, I’ve found that students with different experiences push back and criticize me about things that I haven’t considered. Improving those aspects makes the work better.</p>
<p>As an aside, I also think that as Canada’s best university, and a public one at that, we have a duty to be more reflective of Canada. There’s a quote from one of my favourite books that I thought this audience would like, because it features an astronomer is talking to a child, trying to convince him that humanities are important, and the astronomer says:</p>
<blockquote class="blockquote">
<p>Any science is expensive and astronomy is more expensive than most…. If you need hundreds of millions of pounds sooner or later you are going to have to talk to people who don’t understand what you’re doing and don’t want to understand because they hated science at school.</p>
<p><span class="citation" data-cites="dewitt">DeWitt (2000, 396)</span></p>
</blockquote>
<p>It’s entirely correct that these people are in charge because that’s who we voted for. But it would be nice if they didn’t hate astronomy or statistics when they take it at university and possibly part of that is reflecting other experiences than just our own.</p>
</section>
<section id="improving-your-own-future-life" class="level3">
<h3 class="anchored" data-anchor-id="improving-your-own-future-life">Improving your own (future) life</h3>
<p>The second benefit is that ‘future-you’ will be helped. I think that most of us who write code to analyse data for a living have had the feeling of coming back to a project after six months and a lot of the time it’s literally like having to start a new project. The variables make no sense, and the code is unintelligible. The main question for me is always ‘why did I do that?’. And then I spend the afternoon re-coding and almost always end up back where I was.</p>
<p>If we’re spending eight hours a day writing code to analyse data, then almost anything that adds even one per cent to our productivity is worthwhile, let alone something that saves an afternoon. And that’s particularly the case with open data and reproducibility, because these benefits tend to compound over time and accrue not just to you but other researchers. Talking about knowledge that only you have, doesn’t make you knowledgeable, it makes you a crank, and that includes knowledge that only ‘past-you’ has.</p>
</section>
<section id="building-on-ramps" class="level3">
<h3 class="anchored" data-anchor-id="building-on-ramps">Building on-ramps</h3>
<p>The third benefit is that adopting open data and reproducibility can allow us to build better on-ramps for our collaborators. I love applied statistics, and I can’t quite believe that I get paid to do this job, and I really want more people to be able to work with me on my projects. These days I get to work with a lot of students, and I think the best way for me to make it easier for them to get up to speed is to adopt open data and reproducibility principles.</p>
<p>I don’t think of myself as a scary or intimidating person, but I’m regularly told that in anonymous surveys. New, especially undergraduate, collaborators may be hesitant to ask questions because they feel awkward, or they feel they should know the answer or that they worry I’ll think they’re dumb. Some thoughts that may run through their head when they watch me talk through some data analysis: “Why did he remove the 99s?”, “Maybe everyone does that?”, “Can I just look this up after he finishes talking?”, “Is he ever going to finish talking?”, “Oh no, now I missed it, what is he saying now?”. Open data and reproducibility enable them to not be reliant on me and I hope makes it easier for my collaborators to work with me.</p>
</section>
</section>
<section id="three-baby-steps" class="level2">
<h2 class="anchored" data-anchor-id="three-baby-steps">Three baby steps</h2>
<p>Right, so you’re convinced! You want these great benefits! How can you go about getting them? I’m not asking for anything big from you, and I’m not asking you to advocate, or even change much of anything that you do. (Indeed, if you’re faculty then I’m just asking you to spend some research funds and hire some undergrads!<sup>2</sup>)</p>
<section id="buy-a-bunch-of-notebooks" class="level3">
<h3 class="anchored" data-anchor-id="buy-a-bunch-of-notebooks">Buy a bunch of notebooks</h3>
<p>The first is to buy a notebook. (If you’re faculty, then go and buy a bunch for your team.) And then just write one dot point each time you write some code chunk. Let’s say you’re cleaning some text data, and you want to change all the instances of ‘Rohan’ to ‘Monica’. Just before you write the code that does that, or perhaps just after, write a simple dot point in that fancy notebook that you bought that explains what you did and why. That’s it. (Don’t worry too much about what you write initially – you’ll get better at it naturally over time.) At the end of the day, you’ll magically have a plain-English list of everything that was done to the dataset. That can easily be added to an appendix or added as comments and documentation alongside the code. Newton and Da Vinci kept notebooks! And if that doesn’t convince you (and it shouldn’t, see: selection bias) the US NIH describes notebooks in science as ‘legal documents’ that support claims to patents, defend against allegations of fraud, and act as your scientific legacy <span class="citation" data-cites="ryan">(Ryan 2015)</span>.</p>
</section>
<section id="write-a-datasheet" class="level3">
<h3 class="anchored" data-anchor-id="write-a-datasheet">Write a datasheet</h3>
<p>The second thing is writing a datasheet for your dataset. I had a quick look at some of the astronomy data repos and there’s some amazing things around, NASA came up immediately of course, but also a whole bunch associated with folks speaking at this workshop! I’ve never used astronomical datasets, but when I use political or economic datasets of a similar nature, I sometimes find that because I didn’t collect, clean, or prepare the dataset myself, it can be difficult to trust it. This is where datasheets come in <span class="citation" data-cites="gebru2020datasheets">(Gebru et al. 2020)</span>. Datasheets are basically nutrition labels for datasets. It’s really important to understand what you’re feeding your model, but plenty of researchers don’t have any idea. For instance, recently researchers went back and wrote a datasheet for one of the most popular datasets in computer science, and they found that around 30 per cent of the data were duplicated <span class="citation" data-cites="bandy2021addressing">(Bandy and Vincent 2021)</span>!</p>
<p>Instead of telling you how unhealthy various foods are, a datasheet tells you things like:</p>
<ul>
<li>‘Who created the dataset and on behalf of which entity?’</li>
<li>‘Who funded the creation of the dataset?’</li>
<li>‘Does the dataset contain all possible instances or is it a sample (not necessarily random) of instances from a larger set?’</li>
<li>‘Is any information missing from individual instances?’</li>
</ul>
<p>I’ve integrated datasheets into my teaching and an example of one that a student wrote earlier in Winter 2021 is <span class="citation" data-cites="rosenthal">Rosenthal (2021)</span>. I’m not saying that this isn’t helpful for the student who made it—I <em>hope</em> it was—but it’s especially helpful for me when I think about how best to use the dataset that he created.</p>
<p>The speaker after me, <a href="https://www.dunlap.utoronto.ca/~hlozek/">Renée Hlozek</a>, has a bunch of papers documenting datasets, for instance <span class="citation" data-cites="lsstdarkenergysciencecollaboration2021desc">LSST Dark Energy Science Collaboration et al. (2021)</span>, and another about data challenges <span class="citation" data-cites="Hlo_ek_2019">(Hložek 2019)</span> that I think would be interesting to combine with the idea of backfilling datasheets.</p>
</section>
<section id="make-a-software-package." class="level3">
<h3 class="anchored" data-anchor-id="make-a-software-package.">Make a software package.</h3>
<p>The third and final thing is to build out internal APIs for your code and then make them external. Now this may sound intimidating, but you can do it! (Or if you’re faculty, again, it’s something that you can have an undergraduate do.) My PhD is in economic history and basically what that means is that I have a PhD in data gathering and cleaning. To my shame, I have literally written code that ‘downloads a PDF from a URL, saves it to my computer, pauses, and goes and gets another PDF from a very similar URL’, literally hundreds of times. And of course, no one should write the same code hundreds of times.</p>
<p>Last summer I found myself asking a student to go and write code to do that same task and I finally decided that enough was enough. Instead, I had them put together an R package. Now this was literally only the work of a week for them. So instead of everyone in the lab writing code each time they needed to download a PDF, they could just call this R package and use that instead: we wrote an internal API. I decided that I wanted to make it external facing and there’s now an R package—‘heapsofpapers’—that anyone can use <span class="citation" data-cites="heapsofpapers">(R. Alexander and Mahfouz 2021)</span>.</p>
<p>If you want to do this and you use R then just follow ‘Chapter 2 - The Whole Game’ from <span class="citation" data-cites="rpackages">Wickham and Bryan (2021)</span>. Within a few hours you can have a workable solution and within a month or two you can have a great external API.</p>
<p>And for those of you who are more Python focused, the speaker before me, <a href="http://astro.utoronto.ca/~bovy/">Jo Bovy</a>, has all these great Python packages on his <a href="https://github.com/jobovy">GitHub</a>, including a whole course on writing Python packages <span class="citation" data-cites="bovypython">(Bovy 2021)</span>.</p>
<p>Making internal APIs external is one reason that Amazon is worth a trillion dollars <span class="citation" data-cites="benzell2017impact">(Benzell, Lagarda, and Van Alstyne 2017)</span>, and while I can’t promise that it’ll make you a millionaire, I can promise that you’ll get a paper out of it, and more importantly, help your field.</p>
</section>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding remarks</h2>
<p>I think that open data and reproducibility can be intimidating. I have a two-year-old and I imagine that when he first started to walk he was pretty intimidated also. But he did take his first steps and now he runs around the whole day. And I assure you that it’s the same for open data and reproducibility.</p>
<p>I’m looking forward to diving further into the work of the other speakers at this workshop, and thank Gwen and Josh for bringing these two communities together, and for letting me speak today.</p>
</section>



<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thank you very much to Monica for reading a draft of this. If you want something to watch after reading this then I recommend <span class="citation" data-cites="monicatdrtalk">M. Alexander (2021)</span></p>



</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-monicasrostockreprotalk" class="csl-entry">
Alexander, Monica. 2019. <em>Reproducibility in Demographic Research</em>. Max Planck Institute for Demographic Research: Talk given at Open Science Workshop. <a href="https://www.monicaalexander.com/posts/2019-10-20-reproducibility/">https://www.monicaalexander.com/posts/2019-10-20-reproducibility/</a>.
</div>
<div id="ref-monicatdrtalk" class="csl-entry">
———. 2021. <em>Getting Started with Sharing Code</em>. <a href="https://youtu.be/yvM2C6aZ94k">https://youtu.be/yvM2C6aZ94k</a>.
</div>
<div id="ref-heapsofpapers" class="csl-entry">
Alexander, Rohan, and A Mahfouz. 2021. <span>“Heapsofpapers.”</span> <a href="https://rohanalexander.github.io/heapsofpapers/">https://rohanalexander.github.io/heapsofpapers/</a>.
</div>
<div id="ref-bandy2021addressing" class="csl-entry">
Bandy, Jack, and Nicholas Vincent. 2021. <span>“Addressing "Documentation Debt" in Machine Learning Research: A Retrospective Datasheet for BookCorpus.”</span> <a href="https://arxiv.org/abs/2105.05241">https://arxiv.org/abs/2105.05241</a>.
</div>
<div id="ref-benzell2017impact" class="csl-entry">
Benzell, Seth, Guillermo Lagarda, and Marshall W Van Alstyne. 2017. <span>“The Impact of APIs in Firm Performance.”</span> <em>Boston University Questrom School of Business Research Paper</em>, no. 2843326.
</div>
<div id="ref-bovypython" class="csl-entry">
Bovy, Jo. 2021. <em>Python Code Packaging for Scientific Software</em>. <a href="https://pythonpackaging.info">https://pythonpackaging.info</a>.
</div>
<div id="ref-dewitt" class="csl-entry">
DeWitt, Helen. 2000. <em>The Last Samurai</em>. Talk Miramax Books.
</div>
<div id="ref-gebru2020datasheets" class="csl-entry">
Gebru, Timnit, Jamie Morgenstern, Briana Vecchione, Jennifer Wortman Vaughan, Hanna Wallach, Hal Daumé III au2, and Kate Crawford. 2020. <span>“Datasheets for Datasets.”</span> <a href="https://arxiv.org/abs/1803.09010">https://arxiv.org/abs/1803.09010</a>.
</div>
<div id="ref-Hlo_ek_2019" class="csl-entry">
Hložek, Renée. 2019. <span>“Data Challenges as a Tool for Time-Domain Astronomy.”</span> <em>Publications of the Astronomical Society of the Pacific</em> 131 (1005): 118001. <a href="https://doi.org/10.1088/1538-3873/ab311d">https://doi.org/10.1088/1538-3873/ab311d</a>.
</div>
<div id="ref-mckinsey" class="csl-entry">
Hunt, Vivian, Sundiatu Dixon-Fyle, Sara Prince, and Kevin Dolan. 2020. <em>Diversity Wins: How Inclusion Matters</em>. McKinsey &amp; Company. <a href="https://www.mckinsey.com/featured-insights/diversity-and-inclusion/diversity-wins-how-inclusion-matters">https://www.mckinsey.com/featured-insights/diversity-and-inclusion/diversity-wins-how-inclusion-matters</a>.
</div>
<div id="ref-lsstdarkenergysciencecollaboration2021desc" class="csl-entry">
LSST Dark Energy Science Collaboration, Bela Abolfathi, Robert Armstrong, Humna Awan, Yadu N. Babuji, Franz Erik Bauer, George Beckett, et al. 2021. <span>“DESC DC2 Data Release Note.”</span> <a href="https://arxiv.org/abs/2101.04855">https://arxiv.org/abs/2101.04855</a>.
</div>
<div id="ref-opendatainstitute" class="csl-entry">
Open Data Institute. 2017. <em>What Is ’Open Data’ and Why Should We Care?</em> <a href="https://theodi.org/article/what-is-open-data-and-why-should-we-care/">https://theodi.org/article/what-is-open-data-and-why-should-we-care/</a>.
</div>
<div id="ref-prescordweinstein" class="csl-entry">
Prescord-Weinstein, Chandra. 2021. <em>The Disordered Cosmos</em>. Bold Type Books.
</div>
<div id="ref-rosenthal" class="csl-entry">
Rosenthal, Thomas William. 2021. <span>“Datasheet for the COFFEE_COFFEE_COFFEE Dataset, Version 0.1.”</span> <a href="https://github.com/mrpotatocode/COFFEE_COFFEE_COFFEE/blob/main/journal/Week8/DataSheet-0.1.md">https://github.com/mrpotatocode/COFFEE_COFFEE_COFFEE/blob/main/journal/Week8/DataSheet-0.1.md</a>.
</div>
<div id="ref-ryan" class="csl-entry">
Ryan, Philip. 2015. <em>Keeping a Lab Notebook</em>. NIH. <a href="https://youtu.be/-MAIuaOL64I">https://youtu.be/-MAIuaOL64I</a>.
</div>
<div id="ref-villemurewebb" class="csl-entry">
Villemure, Serge, and Anne Webb. 2017. <em>Strengthening Research Excellence Through Equity, Diversity and Inclusion</em>. NSERC Presentation. <a href="https://www.nserc-crsng.gc.ca/_doc/EDI/EDIpresentation_EN.pdf">https://www.nserc-crsng.gc.ca/_doc/EDI/EDIpresentation_EN.pdf</a>.
</div>
<div id="ref-rpackages" class="csl-entry">
Wickham, Hadley, and Jenny Bryan. 2021. <em>R Packages</em>. <a href="https://r-pkgs.org/">https://r-pkgs.org/</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Thanks very much to Vianey Leos Barajas for gifting me this book.↩︎</p></li>
<li id="fn2"><p>Statistical Sciences has something in the order of 4,000 undergrads, which is quite a lot, but the great thing about it is that the top 5 per cent are just incredibly strong. You could hire a few of them for literally $25 an hour, and then just get them to do these three things! Possibly that hiring would even add to the diversity of your team.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-05-22-baby-steps/baby-steps.html</guid>
  <pubDate>Sun, 23 May 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>On work-life balance</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-05-04-work-life-balance/work-life-balance.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Hi, my name is Rohan Alexander. I’m an assistant professor at the University of Toronto, in the Faculty of Information, and the Department of Statistical Sciences. I’d like to thank Tony Tang for the invitation to talk about work-life balance.</p>
<p>The work-life balance that I’m going to talk about today is just something for me, right now. So maybe some of what I’ll talk about will be relevant for you, but maybe my balance won’t be, and that’s okay. My main take-away, in any case, is that you’re smart enough to work out what works for you.</p>
<p>I don’t think there’s only one optimal work-life balance, and if there is one, then it certainly changes over time. While doing my PhD, and also my wife doing her PhD, and us both now in faculty jobs, we’ve had a variety of opportunities to experience a bunch of different approaches to all this. We’ve also now got a two-year-old and another on the way, so I’ve reflected on all this to come up with a few lessons that I’d like to share.</p>
</section>
<section id="lessons" class="level2">
<h2 class="anchored" data-anchor-id="lessons">Lessons</h2>
<section id="lesson-1-youre-smart-enough-to-work-out-what-works-for-you" class="level3">
<h3 class="anchored" data-anchor-id="lesson-1-youre-smart-enough-to-work-out-what-works-for-you">Lesson 1: You’re smart enough to work out what works for you</h3>
<p>The first lesson is that you’re smart enough to work out what works for you. When my first child was born, it was all a bit challenging. As folks who have done or are doing a PhD, we’re trained in, and selected for, certain attributes, and none of those have any relation to your ability to care for an infant when it’s 3am and you’ve not slept, and the child won’t eat. I did what I was trained to do, which was look at the literature, synthesize it, plan, and execute. And of course, that didn’t help.</p>
<p>One of my PhD supervisors had also had a challenging time around the birth of her children, and she emailed me, and she said, ‘you’re smart enough to work out what works for you’. And that’s the key bit. You’re here. The admissions committee doesn’t make mistakes.</p>
<p>Today is all about us giving you advice, but in the end you’re smart enough to work out what work-life balance works for you.</p>
</section>
<section id="lesson-2-ignore-what-everyone-else-says-and-does" class="level3">
<h3 class="anchored" data-anchor-id="lesson-2-ignore-what-everyone-else-says-and-does">Lesson 2: Ignore what everyone else says and does</h3>
<p>The second lesson is to ignore what everyone else is saying. Our friend once said on Twitter there are two types of people: one type says they work all the time, and the other type say they never work. The takeaway is that both types of people are probably exaggerating, and you probably shouldn’t believe either of them. Instead, you need to think about your own circumstances and decide what balance makes sense. And you need to recognize that will change as your circumstances change.</p>
<p>I’ve always been a morning person, so during my PhD I used to get up at 6am to start work and then stop in mid-afternoon and go for a run and then cook dinner early and then maybe do some lighter work in the evening. And I got good at working for long chunks of time. Then the baby arrived. I became a night person for a while, then I became a bursts-of-work person for a while, now I’m back to being a morning person, but it’s more of a 4am start to get a chunk of work done, and then various bursts-of-work, followed by a short morning chunk, and then very little in the afternoon, when I may need to look after him, depending on sleep, and then maybe another chunk at night if he goes down easily.</p>
<p>Ignore what others are doing, and react to your own circumstances.</p>
</section>
<section id="lesson-3-doing-a-phd-is-hard" class="level3">
<h3 class="anchored" data-anchor-id="lesson-3-doing-a-phd-is-hard">Lesson 3: Doing a PhD is hard</h3>
<p>The third lesson is that doing a PhD is really, really hard (and it’s meant to be). The fundamental purpose of doing a PhD is to create new knowledge. Knowledge that literally no one in the world has.</p>
<p>One way to think about it is that you’re going to become the world champion in one tiny little aspect of the world. The days of Oxbridge gentlemen athletes winning Olympic medals are gone, and that’s true also of easy PhDs. What’s left for us is the stuff that takes a huge amount of effort. Recognizing that fact, and the implication that working really hard at this is what it’s going to take, is crucial.</p>
<p>The work-life balance that I experience in a university isn’t, and cannot be, the work-life balance of those that I know outside of universities. This job is just really different. You have to be prepared for things to be hard, and to work hard, and try not to take it personally when things don’t work out straight away. It’s part of the process</p>
</section>
<section id="lesson-4-an-extra-hour-of-work-is-almost-always-worthwhile" class="level3">
<h3 class="anchored" data-anchor-id="lesson-4-an-extra-hour-of-work-is-almost-always-worthwhile">Lesson 4: An extra hour of work is almost always worthwhile</h3>
<p>The fourth lesson builds on this and it’s that putting an extra hour into your work is always worthwhile. The nature of our job—creating new research—means that there is always something to do. This is not a job where you lay 500 bricks in a day and then call it a day. I had a job like that once, briefly, and that job was hard. But when it was done, it was done. Our job—doing research—is not like that. There’s always something else that you can do. And it’s beneficial to do that thing today, because that way you can build on it tomorrow.</p>
<p>There’s enormous compounding in academia. Awards, conference and journal acceptances tend to go to those who already have plenty of them. So how do you get that first one? It’s just hard, but putting an extra hour in will almost always compound over time and be useful. The thing about compounding interest is that initially you don’t notice any benefit, but after a few years there’s an enormous difference.</p>
<section id="lesson-4.5-until-it-isnt" class="level4">
<h4 class="anchored" data-anchor-id="lesson-4.5-until-it-isnt">Lesson 4.5: Until it isn’t</h4>
<p>However, there is a corollary to that fourth lesson, and that is: Until it isn’t. The fourth and a half lesson, as it were. The temptation is to just spend more and more time working. And that’s fine for a while, and is important to be able to do, from time to time. But it doesn’t work for more than a month or two.</p>
<p>But now we have a contradiction. On the one hand, I’ve just told you that there’s enormous benefits to compounding, and we all know about the importance of flow and staying in that state when you can achieve it. And on the other hand, if you take that to its natural conclusion and work all the time, you won’t last in academia for long. So, what do we do?</p>
</section>
</section>
<section id="lesson-5-use-positive-procrastination" class="level3">
<h3 class="anchored" data-anchor-id="lesson-5-use-positive-procrastination">Lesson 5: Use positive procrastination</h3>
<p>This leads to the fifth lesson, which is that you use positive procrastination to your advantage. I wrote this talk when I was tired of writing my book, which I write when I’m tired of trying to write a paper. None of this is wasting time, but the task switching ensures a freshness and enthusiasm. Another advantage of positive procrastination when you’re a PhD student is that it also helps you identify what you’re passionate about.</p>
<p>Now you don’t have to love what you do—plenty of professors don’t—but I do and I’m going to speak now assuming this to be true, because it’s gone part way to resolving this contradiction.</p>
<p>A friend once said that a way to think about passion is that it’s your brain’s way of tricking you into doing things that are boring or are hard. And if you can identify passion then it’ll make your life a lot easier. When I started my PhD, I was in a bit of a malaise. I’d go from subject to subject, and certainly work at them, but not enjoy anything and there were a lot of long coffees with friends. I’d cycle home, and then at night and on the weekends, I’d spend my whole-time using R to do statistical analysis of political data in a reproducible way. Then during the day I’d go to university and go back to my malaise of not knowing what to do. Of course, with some support from various advisors and mentors, I eventually worked out that what I should be doing is using R to do statistical analysis of political data in a reproducible way for my PhD and after that everything got a lot easier! I loved what I was doing and work no longer felt like work.</p>
<p>There’s a limit, of course, to positive procrastination. Because you need to make sure that you’re shooting, and not just setting up shots, as it were. As a PhD student, you probably want to have about three projects, and that’s about it. But I do think that cycling through, especially early in your PhD when it’s easy to just email a professor and take a reading course to write a short paper, is something that more students should do and would help resolve work-life concerns.</p>
<p>And again, the viability of this changes over your career. Now I have about 10-15 different projects because I supervise students, and I have some longer-term gambles that may or may not work out. However, because of how I have to work in fits and starts, I can’t just do what I was trained to do, which is to throw more time into things. I need to try to be smarter about things and look for efficiencies and relationships between them.</p>
</section>
<section id="lesson-6-take-complete-weeks-long-breaks" class="level3">
<h3 class="anchored" data-anchor-id="lesson-6-take-complete-weeks-long-breaks">Lesson 6: Take complete, week/s-long breaks</h3>
<p>And so we reach the sixth and final lesson, which is about having complete breaks, and I learnt this one from someone that I’ll name, and that’s Professor Kelly Lyons. Because once you’ve identified your passion and you understand the power of compounding and flow, it can be easy to just stay caught up in things. But to have an academic career or to finish a PhD without burning out, and if your work-life trick is going to be that you’d be doing what you get paid to do, even if you didn’t get paid to do it, then you need to make sure that remains the case.</p>
<p>Monica and I have started insisting on complete week-long breaks from time to time. Minimal computers, and no GitHub. And this is one aspect where having children certainly helps. Because they want all of your attention.</p>
</section>
</section>
<section id="we-get-to-do-what-we-want" class="level2">
<h2 class="anchored" data-anchor-id="we-get-to-do-what-we-want">We get to do what we want</h2>
<p>Our work-life balance in academia is different to that of doctors, lawyers, and tech bros. We have the best job in the world. But our job is not like others. One of the great things about academia is the flexibility. We get to do whatever we want.</p>
<p>That point bears repeating. We get to do whatever we want. And that means that whatever we’re doing is something that we’re choosing.</p>
<p>Hence, for me, it’s become wrong to think that work and life are separate and that they need to be siloed. People outside of universities talk about work-life balance and the implication is that you need to make time for each. But in academia, that’s not the way that I think of things.</p>
<p>I think it’s a spectrum. For some people, work is work, and life is life and they’re completely separated, while for others all they do is work and that’s their life. For most of us, we’re probably somewhere in between. And I think that’s especially the case in academia. Because you’ve got so much flexibility and ownership over what we do compared with, say, working at a bank. And so, in terms of work-life balance, it’s about trying to work out what works for you. Thinking about what’s important in your life and how that fits into your work. And also, being aware that this balance is going to change especially around life events such as having a baby, which will affect how you can work, as well as the volume. And that this change is good, appropriate, and normal, even if that’s not recognized in the current academic structures.</p>
<p>If you enjoy coding, then taking a break from work might mean doing a fun coding project. If you enjoy hiking, then taking a break from work might mean going hiking. When my wife was doing her PhD, we went on road trips and worked in different environments. We did this because we loved our work, not because anyone was forcing us. We went to different cafes, and ate different foods, and ran in different parks, and went to different pubs, but for most of the day we sat at tables in random Airbnbs and worked. We have great memories of that, but not everyone wants to do that and that’s okay.</p>
<p>Initially, your supervisor will put a huge amount of pressure on you, but I’ve found that as I’ve gotten older the person putting the most pressure on me is myself. Once you’re at that stage, if you think ‘oh I want a break, but I should get this done because the code isn’t working, or I need to get it to my collaborator, or whatever’, then chances are that it’s okay and you should probably just email the collaborator to say that it’ll be a week late and then take the week off. From time to time, I’ll just declare a day off and not open the computer. If you think that maybe you don’t have time for something, then you are probably right and you need to get out of it.</p>
<p>In grad school I’ve found that many people lose their hobbies. But maybe there is value in trying to make time, particularly for exercise. So, things like going for a run or being part of a team might be important for you. During my PhD a lot of my friends continued with rock-climbing, or cycling, or took up walking.</p>
</section>
<section id="between-the-ideal-and-the-reality-falls-the-shadow" class="level2">
<h2 class="anchored" data-anchor-id="between-the-ideal-and-the-reality-falls-the-shadow">Between the ideal and the reality falls the shadow</h2>
<p>Increasingly we see that the composition of academia is changing, for instance, in terms of the proportion of women in masters and PhD programs and junior faculty. However, institutional structures at all stages of academia are still fundamentally designed for people—particularly men—without caring responsibilities; and as such those who do not fit this mould often face enormous challenges</p>
<p>While things have changed, this structural issue has been increasingly brought to light during the pandemic. NSERC submission deadlines remained the same. NSERC grant application requirements remained the same. I said earlier that you should take a week off, but the amount of work to be done remains the same and NSERC doesn’t change its deadlines just because you took a week off. Similarly, departments here didn’t change their teaching, or service requirements.</p>
<p>A lot of people with young children have not done any research for a year, and applied for few grants. Generalising from the literature on the effect of long-term job losses, chances are that, on average, our careers will not recover. And that’s okay. We still get to do what we love. We might not become full professors, but being an associate would be great. It’s still the best job in the world.</p>
<p>While I still think that it is correct to say, as I did above, that one shouldn’t compare oneself to others, the fact remains that the academic structures do exactly that. If you are not of the type that academia is set-up for, then every day you will fail to measure up to those expectations. We are not in a normal job, and that’s okay, but you need to recognize that the structures that job exists within may not be set-up for your circumstances. And it may be that these circumstances will dictate what can be accomplished, rather than your abilities.</p>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding remarks</h2>
<p>I don’t think there’s a one-size-fits-all for work-life balance. You need to work it out for yourself and part of that is just worrying about yourself, ignoring what others do or say they do. You’re smart enough to work out what works for you, so just think. And once you work out what works for you, then set-out to make it easier for others.</p>
<p>I think that there’s value in the struggle. Even if my cohort of academics with young children doesn’t achieve what it may have, there’s value in sticking with it, while that’s possible. Next time, maybe some of us will be the ones who are chairs and NSERC reviewers. Even now, we have opportunities to make things easier for the next cohort, some of whom may be the undergrads that have spent the past year in Zoom classrooms. We have the best job in the world, and sometimes taking a step back and seeing it as bigger than oneself is important.</p>
<p>Thanks very much to Tony for giving me the opportunity to reflect on work-life balance at universities and how that changes over the life course, and I hope that he doesn’t regret providing me with the platform too much. I’d be happy to take any questions.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thank you very much to Monica for reading a draft of this. Thank you also to John, Zach, Martine, Tim, and Jill at the ANU, and Kelly at U of T for helpful conversations about this topic at various points in time.</p>


</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-05-04-work-life-balance/work-life-balance.html</guid>
  <pubDate>Tue, 04 May 2021 04:00:00 GMT</pubDate>
</item>
<item>
  <title>In Appreciation of Greg Wilson</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-03-14-greg-wilson/in-appreciation-of-greg-wilson.html</link>
  <description><![CDATA[ 



<p>As a baby professor there is a lot that causes me to wake up crying during the night. But the main reason is teaching. Having largely spent five years alone in an office working on projects by-myself, the idea that I should stand in front of (or Zoom to) one- to two-hundred students and competently teach is still a tad surprising. <a href="https://third-bit.com">Greg Wilson</a> is the only reason that I no longer wake up wracked with concern about at least this aspect of baby professor life.</p>
<p>Greg established and, until recently, ran instructor training at R Studio. This involved putting together and teaching a two-day course about the Tidyverse (there’s also a Shiny version that I didn’t do). After the course, Greg assessed you on a one-to-one basis and when he was happy he certified you.</p>
<p>The training assumed that you already knew R (essentially to the level of R4DS). It’s not about R, it’s about teaching you how to teach R. We covered an awful lot, but some highlights include:</p>
<ul>
<li>The creation of learner personas to help understand where the student is coming from.</li>
<li>How to formally structure assessment, and other feedback, in a way that builds a student’s knowledge and confidence.</li>
<li>Putting together different aspects in a ‘concept map’ that a student can use to navigate these aspects.</li>
<li>Remaining mindful of cognitive load and active teaching.</li>
<li>Seeing things from the student perspective.</li>
<li>And how to do all this in the real-world i.e.&nbsp;a time-constrained mess of priorities and incomplete information.</li>
</ul>
<p>My guess is that none of this is pedagogical rocket science, but it’s not something that I knew, or even thought about, before Greg’s course. More important than any specific aspect, Greg provided a foundation for my teaching on which I can iterate and evolve. There’s the famous Cheshire Cat quote in Alice in Wonderland about needing to have a destination before it matters in which direction you go. Greg provided that destination. I don’t know whether it improved outcomes for my students; but it certainly reduced how worried I was about teaching.</p>
<p>That all said, I think that the most important thing that I learnt from Greg is ‘Be kind: all else is details.’. Greg taught us this through his example.</p>
<p>By my rough count there are something like 200 R Studio certified Tidyverse instructors. A lot of them are similarly professors who will teach large classes of undergrads, smaller classes of grads, and directly supervise PhD students, who themselves will teach… If Greg caused even a one per cent improvement in the quality of the instruction of those folks, then the potential impact that he’s had is enormous.</p>
<p>I don’t know anything of the circumstances surrounding Greg’s departure from R Studio, and it’s none of my business either way. Greg holds a CS PhD and spent a few years as an assistant professor at the Toronto CS department a few years back. He founded Software Carpentry. In an ideal world we would find space for him at the university. But regardless of what happens, I’ll always be grateful for his teaching, his example, and most importantly, his kindness, and hope to emulate that in my own teaching.</p>
<p>If you’d like to learn more about what Greg taught us you should look at his book <em>Teaching Tech Together</em>: http://teachtogether.tech/en/index.html. It’s all good, but even just skimming ‘The Rules’ is worthwhile.</p>
<p>A month or so ago, Greg stopped by the Faculty of Information at the University of Toronto and taught a class about ‘How to Run a Meeting’. If you’d like to see the recording of that you can do so here: https://youtu.be/qYh6Nzv3RWs.</p>
<p>A bunch of other folks have written more about the training and you can read some of them here:</p>
<ul>
<li>https://silvia.rbind.io/2020-10-07-rstudio-instructor-certification-tidyverse/</li>
<li>https://shelkariuki.netlify.app/post/certification/</li>
<li>https://www.yuqiliao.com/blog/rstudiocertification/</li>
</ul>



 ]]></description>
  <guid>https://rohanalexander.com/posts/2021-03-14-greg-wilson/in-appreciation-of-greg-wilson.html</guid>
  <pubDate>Sun, 14 Mar 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Saturday morning thoughts on grad school applications</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-03-13-grad-school-applications/grad-school-applications.html</link>
  <description><![CDATA[ 



<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Grad school application season is mostly done. I wanted to quickly put together some general thoughts in case they’re helpful for undergraduates applying next year. Please keep in mind that I’m new and interested in applied statistics. This advice probably doesn’t apply for more-experienced, or less-applied, folks.</p>
<p>The main takeaways:</p>
<ul>
<li>There’s a huge amount of luck involved, so don’t tie your self-worth to any particular decision either way.</li>
<li>Worry as much, if not more, about letters and your personal statement as you do about your GPA. There are three bits to the application — transcript, letters, statement/CV. You’re spending four years getting transcripts, so you should also spend a lot of time on the other two.</li>
<li>Communicate a clear reason for wanting to go to the school/program that you’re applying for.</li>
<li>Create a narrative that runs through your entire application.</li>
</ul>
<p><strong>These thoughts are specific to me. You need to get advice from your own advisors, and in particular the faculty that are going to write you letters, but more on that later.</strong></p>
</section>
<section id="cv-and-personal-statement" class="level2">
<h2 class="anchored" data-anchor-id="cv-and-personal-statement">CV and personal statement</h2>
<p>Be clear about why you’re applying, show evidence of your work, and weave that into your narrative. When you do sales, the key to everything is identifying a ‘champion’ in the firm that you want to sell to. Your job in sales is then to give that person the information they need to sell the rest of the firm on it. When you’re applying to grad school, it’s a similar situation. You don’t need all the faculty to love your application - you just need at least one of the reviewers to love it and for no one to hate it enough to veto. Your personal statement is a sales opportunity and will be when the faculty reviewers work out who they advocate for. It’s hard to recover from a bad personal statement. You should get your letter writers to review it before you send it.</p>
<ul>
<li>Use the combination of your CV and personal statement to craft a narrative (which your letters and transcript support).</li>
<li>Articulate the reason that you want to attend the department/school that you’re applying for.
<ul>
<li>This is not a statement like ‘[insert school] is a top-ranked school’.</li>
<li>One way to do this is to find a faculty member that is of interest, look at their papers and website, and write about how your interests align with their work and you want to be involved in it. That said, don’t fake interest, because it’s usually obvious.</li>
<li>Another way is to identify a clear link to your interests, for instance, if you’re into public health then maybe the university is in a state/province that has universal healthcare and so you’d have great data.</li>
<li>Yet another way is to look up the requirements of the program and weave in how you’re really keen to learn about subject X taught by professor Y because of reason Z.</li>
</ul></li>
<li>You don’t need the world’s greatest justification (and no one will hold you to it if you decide you’re actually interested in something else), but the faculty reviewer needs to know why you want to attend their school/department when you could go to any number of other top ranked schools/departments. There’s only a certain number of offers that can be made, so at the very least they need to have some idea of the likelihood that you’ll accept.</li>
<li>Grades in undergrad tests don’t necessarily correspond to doing well in graduate school. Much of graduate school is about learning how to learn, with the goal to eventually ‘learn things that no one else knows’ (i.e.&nbsp;do research) and so it is helpful for reviewing faculty to see evidence that points to your ability to do that. One way to do this is to create projects that show off what you can do publicly and link to them. Ideally your undergrad professors will integrate projects into their curriculum, but if not then you need to DIY. (BTW don’t use Kaggle – hunt, gather, or farm your own data).</li>
<li>For applied quantitative PhDs, it’s great if you are already able to write code in R or Python, and even better if you can include a link to your GitHub account that shows this. Ideally, your GitHub should be in decent order. For instance, have your best projects pinned, and put a lot of effort into making sure these are commented, have READMEs, etc.</li>
<li>Make a website, even if it’s very minimal. You need to control your online presence and having LinkedIn or whatever come up is not great (for the purposes of grad school applications).</li>
<li>One or two years of work experience is great (or even just a summer internship or similar), especially if it links into your overall narrative of why you want to go to that particular grad school.</li>
<li>Don’t have a long personal statement that begins with you as a child and culminates in your application. Instead, be succinct and clear, and weave your accomplishments into a narrative, rather than just list them (that’s what your CV/transcript are for).</li>
</ul>
</section>
<section id="letters" class="level2">
<h2 class="anchored" data-anchor-id="letters">Letters</h2>
<p>The best letters are from folks that know you and your work. You need to spend a huge amount of effort getting decent letters. They’re as important, if not more, as your GPA.</p>
<ul>
<li>The strongest letters are from folks who know you well. Usually, this type of letter looks better than someone who doesn’t know you well, even if they’re a famous professor, and even if you got an A in their class.</li>
<li>If possible try to work for a professor, ideally a quantitative one, because it can be more difficult to understand the evidence that non-quantitative-professors bring.
<ul>
<li>How do you get a job with a professor so that they will write you a letter? The best way is to excel in a course that they teach and then ask to work for them. Or excel in a course and then ask that professor to recommend you to the professor you want to work for.</li>
<li>There’s a language that good letters use. You need to be very thoughtful in your choice of letter writers because you can’t control what is written about you, other than through your choice of letter writer.</li>
</ul></li>
<li>That said, not everyone can work for a professor. The main point is that you need to identify letter writers that really know your work, and you.</li>
<li>Be sure to ask the letter writer if they’re comfortable recommending you to the programs that you’re applying for before you ask them to write a letter for those programs.</li>
<li>There’s a tendency to ask the most-famous-professor to write you a letter. If you’ve worked closely with them and they’ll say nice things about you, then that’s great. But the thing about famous professors is that they have seen a lot of strong students, and so it can be dangerous. Professor Big-Name saying you’re the best student they’ve ever worked with is of course great. Professor Big-Name saying you were fine to work with is still good, but less clear-cut. Professor Big-Name saying you got an A in their class doesn’t say much that isn’t already in your transcript.</li>
</ul>
</section>
<section id="transcript" class="level2">
<h2 class="anchored" data-anchor-id="transcript">Transcript</h2>
<p>Grades are important, but not everything. Your transcript needs to reflect the narrative that you’re telling in the rest of the application.</p>
<ul>
<li>If you are not a 4.0 student, then it’s not the end of the world. But be aware of:
<ul>
<li>GPA minimums, and</li>
<li>That your grades at the end of your degree and/or relevant subjects weigh more heavily.</li>
</ul></li>
<li>Grades are important, but students seem to over-weight the importance of grades – all the components of the application are important, and grades are just one part of it.</li>
</ul>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding remarks</h2>
<p>Getting in anywhere requires a healthy dose of luck. It’s not a reflection of your worth as an academic, and especially not as a person. You can’t control who reviews your application, or who has funding to take students that year, or the other students applying that year. There’s also just incredible competition for these spots. There’s an awful lot of chance involved. There’s nothing you can do about this other than not tie your self-worth to it.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Without wanting to implicate her in anything said here, thanks to Monica Alexander for reading many drafts of this.</p>


</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-03-13-grad-school-applications/grad-school-applications.html</guid>
  <pubDate>Sat, 13 Mar 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Shelter usage in Toronto (2017-2021)</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The extent of homelessness in Toronto was highlighted for the R community in December 2020 when the dataset was used in TidyTuesday. That dataset contained data for 2017 to 2019, inclusive. In this post I expand the dataset through to January 2021 to see what has happened since COVID. I also document and adjust for a systematic error in the 2017 dataset. I compare the usage of shelters this year with last year. I estimate that on Friday, 22 January 2021, when it was -11C with winds of 17km/h, there were roughly 3,634 additional people sleeping somewhere other than a shelter, compared with this time last year.</p>
</section>
<section id="set-up-workspace-and-gather-data" class="level2">
<h2 class="anchored" data-anchor-id="set-up-workspace-and-gather-data">Set up workspace and gather data</h2>
<p>I’ll use the R statistical programming language <span class="citation" data-cites="citeR">(R Core Team 2020)</span>. The datasets are accessed via the <code>opendatatoronto</code> package <span class="citation" data-cites="sharla">(Gelfand 2020)</span>. This package wraps around the <a href="https://open.toronto.ca">City of Toronto’s Open Data Portal</a> and allows the direct import of data rather than the need to visit the website. The website is great, but using the package enhances reproducibility. I’ll use the <code>tidyverse</code> package to make data manipulation easier <span class="citation" data-cites="citetidyverse">(Wickham et al. 2019)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(opendatatoronto)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the data</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Based on https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-12-01/readme.md</span></span>
<span id="cb3-3">all_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-4">  opendatatoronto<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">search_packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily Shelter Occupancy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-5">  opendatatoronto<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list_package_resources</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-6">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"daily-shelter-occupancy-2017-csv"</span>,</span>
<span id="cb3-7">                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"daily-shelter-occupancy-2018-csv"</span>, </span>
<span id="cb3-8">                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"daily-shelter-occupancy-2019-csv"</span>, </span>
<span id="cb3-9">                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"daily-shelter-occupancy-2020.csv"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_split</span>(name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Don't totally understand how this works</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(get_resource, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file"</span>)</span>
<span id="cb3-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_csv</span>(all_data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inputs/raw_data.csv"</span>)</span></code></pre></div>
</div>
<p>Let’s just have a quick look at the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">all_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inputs/raw_data.csv"</span>, </span>
<span id="cb4-2">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"iiccccccccccii"</span>)) </span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The col_types hieroglyphics above stand for integer, integer, character... etc.</span></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(all_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
   file `_id` OCCUPANCY_DATE  ORGANIZATION_NAME SHELTER_NAME
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;             &lt;chr&gt;       
1     1     1 2017-01-01T00:… COSTI Immigrant … COSTI Recep…
2     1     2 2017-01-01T00:… Christie Ossingt… Christie Os…
3     1     3 2017-01-01T00:… Christie Ossingt… Christie Os…
4     1     4 2017-01-01T00:… Christie Refugee… Christie Re…
5     1     5 2017-01-01T00:… City of Toronto   Birchmount …
6     1     6 2017-01-01T00:… City of Toronto   Birkdale Re…
# ℹ 9 more variables: SHELTER_ADDRESS &lt;chr&gt;,
#   SHELTER_CITY &lt;chr&gt;, SHELTER_PROVINCE &lt;chr&gt;,
#   SHELTER_POSTAL_CODE &lt;chr&gt;, FACILITY_NAME &lt;chr&gt;,
#   PROGRAM_NAME &lt;chr&gt;, SECTOR &lt;chr&gt;, OCCUPANCY &lt;int&gt;,
#   CAPACITY &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="data-cleaning-and-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-and-preparation">Data cleaning and preparation</h2>
<section id="make-the-data-easier-to-deal-with" class="level3">
<h3 class="anchored" data-anchor-id="make-the-data-easier-to-deal-with">Make the data easier to deal with</h3>
<p>The column names aren’t overly nice to type, there are a few columns that we’re not really going to use much, and finally a few of the columns have data that are less obvious than they should be. For instance, the ‘file’ tells us the year of the data, but because of the import settings it’s 1, 2… instead of 2017, 2018….</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">toronto_shelters <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb6-2">  all_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-3">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the column names easier to type. Thanks Sharla!</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file_year =</span> </span>
<span id="cb6-5">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb6-6">             file <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>,</span>
<span id="cb6-7">             file <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>,</span>
<span id="cb6-8">             file <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>,</span>
<span id="cb6-9">             file <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>,</span>
<span id="cb6-10">             <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Just make the column easier to deal with</span></span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>id, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>file)</span></code></pre></div>
</div>
<p>The main issue with the data is the dates. In 2017-2019 (inclusive) they <em>appear</em> to be year-month-day, but for 2020 it seems like month-day-year. The separator is also inconsistent between ‘-’ and ‘/’. I’ll first clean that up, check our guesses, and then get to the main issue. I’m going to draw on the <code>lubridate</code> package <span class="citation" data-cites="citelubridate">(Grolemund and Wickham 2011)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb7-2">toronto_shelters <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb7-3">  toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1st line removes times (probs don't actually need to do) and 2nd makes the separation consistent</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(occupancy_date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T[:digit:]{2}:[:digit:]{2}:[:digit:]{2}"</span>),</span>
<span id="cb7-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(occupancy_date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>)</span>
<span id="cb7-7">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parsing differs between 2017-2019 and 2020. Last line is a catch-all - shouldn't get there.</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb7-10">    file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy</span>(occupancy_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), </span>
<span id="cb7-11">    file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2018"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(occupancy_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb7-12">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> NA_Date_</span>
<span id="cb7-13">    )</span>
<span id="cb7-14">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(file_year, date, occupancy_date, organization_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>capacity)</span></code></pre></div>
</div>
</section>
<section id="check-content-of-day-month-and-year" class="level3">
<h3 class="anchored" data-anchor-id="check-content-of-day-month-and-year">Check content of day, month, and year</h3>
<p>Let’s just check that my guess of the date orderings was at least plausible by looking at the distribution of year, month, and day bits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">toronto_shelters <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb8-2">  toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(occupancy_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'one'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'two'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'three'</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remove =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(one) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Year =</span> one, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Number =</span> n) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-5">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count of entries by year for 2017-2019"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-6">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped" data-quarto-postprocess="true">
<caption>Count of entries by year for 2017-2019</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2017</td>
<td style="text-align: right;">38700</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018</td>
<td style="text-align: right;">37770</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019</td>
<td style="text-align: right;">39446</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(two) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Month =</span> two, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Number =</span> n) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-5">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count of entries by month for 2017-2019"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-6">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped" data-quarto-postprocess="true">
<caption>Count of entries by month for 2017-2019</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">9747</td>
</tr>
<tr class="even">
<td style="text-align: left;">02</td>
<td style="text-align: right;">8868</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03</td>
<td style="text-align: right;">9912</td>
</tr>
<tr class="even">
<td style="text-align: left;">04</td>
<td style="text-align: right;">9600</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05</td>
<td style="text-align: right;">9950</td>
</tr>
<tr class="even">
<td style="text-align: left;">06</td>
<td style="text-align: right;">9625</td>
</tr>
<tr class="odd">
<td style="text-align: left;">07</td>
<td style="text-align: right;">9850</td>
</tr>
<tr class="even">
<td style="text-align: left;">08</td>
<td style="text-align: right;">9743</td>
</tr>
<tr class="odd">
<td style="text-align: left;">09</td>
<td style="text-align: right;">9430</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: right;">9694</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11</td>
<td style="text-align: right;">9497</td>
</tr>
<tr class="even">
<td style="text-align: left;">12</td>
<td style="text-align: right;">10000</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(three) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> three, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,</span>
<span id="cb11-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/firstthreeyearsdistrib-1.png" class="quarto-discovered-preview-image img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Distribution of days for 2017-2019</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>And again, but for 2020.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(one) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Month =</span> one, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Number =</span> n) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-5">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count of entries by month for 2020"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-6">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped" data-quarto-postprocess="true">
<caption>Count of entries by month for 2020</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">3503</td>
</tr>
<tr class="even">
<td style="text-align: left;">02</td>
<td style="text-align: right;">3277</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03</td>
<td style="text-align: right;">3555</td>
</tr>
<tr class="even">
<td style="text-align: left;">04</td>
<td style="text-align: right;">3562</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05</td>
<td style="text-align: right;">3671</td>
</tr>
<tr class="even">
<td style="text-align: left;">06</td>
<td style="text-align: right;">3534</td>
</tr>
<tr class="odd">
<td style="text-align: left;">07</td>
<td style="text-align: right;">3601</td>
</tr>
<tr class="even">
<td style="text-align: left;">08</td>
<td style="text-align: right;">3355</td>
</tr>
<tr class="odd">
<td style="text-align: left;">09</td>
<td style="text-align: right;">3210</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: right;">3317</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11</td>
<td style="text-align: right;">3195</td>
</tr>
<tr class="even">
<td style="text-align: left;">12</td>
<td style="text-align: right;">3281</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(two) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> two, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,</span>
<span id="cb13-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/yearsdistribfor2020-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Distribution of days for 2020</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(file_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(three) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Year =</span> three, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Number =</span> n) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-5">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count of entries by year for 2020"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-6">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped" data-quarto-postprocess="true">
<caption>Count of entries by year for 2020</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2020</td>
<td style="text-align: right;">41061</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>That’s all looking fine. We’d know that we have issues if the distribution of the days wasn’t roughly uniform, or if we have values other than [1-12] in the month.</p>
</section>
<section id="check-columns-agree-about-the-year" class="level3">
<h3 class="anchored" data-anchor-id="check-columns-agree-about-the-year">Check columns agree about the year</h3>
<p>Let’s now also check that the year implied by the date matches the year implied by the file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check_year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> file_year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(check_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 18
# ℹ 18 variables: file_year &lt;dbl&gt;, date &lt;date&gt;,
#   occupancy_date &lt;chr&gt;, one &lt;chr&gt;, two &lt;chr&gt;,
#   three &lt;chr&gt;, organization_name &lt;chr&gt;,
#   shelter_name &lt;chr&gt;, shelter_address &lt;chr&gt;,
#   shelter_city &lt;chr&gt;, shelter_province &lt;chr&gt;,
#   shelter_postal_code &lt;chr&gt;, facility_name &lt;chr&gt;,
#   program_name &lt;chr&gt;, sector &lt;chr&gt;, occupancy &lt;int&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">toronto_shelters <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb17-2">  toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>occupancy_date, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>one, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>two, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>three, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>file_year)</span></code></pre></div>
</div>
<p>That’s also fine. And I’ll clean-up by removing the unnecessary columns.</p>
</section>
<section id="one-last-thing---plot-raw-data" class="level3">
<h3 class="anchored" data-anchor-id="one-last-thing---plot-raw-data">One last thing - plot raw data</h3>
<p>Everything seems fine, but it’s always important to ‘Plot. Your. Raw. Data.’, so before moving on, I should plot the raw data to see if there’s anything else going on. (Here, students seem to get confused what ‘raw’ means; I’m using it to refer to as close to the original dataset as possible, so no sums, or averages, etc, if possible. Not necessarily before any cleaning. Sometimes your data are too disperse for that so there will be an element of manipulation. The main point is that you, at the very least, need to plot the data that you’re going to be modelling.)</p>
<p>Let’s just plot the order. As this dataset has been put together by a human we’d expect that it’d be in order of date. Let’s just plot the date in the order it appears in the dataset (Figure @ref(fig:plotorder)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row_number =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(toronto_shelters))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> row_number, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Row number"</span>,</span>
<span id="cb18-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/plotorder-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Comparison of row number with date</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>😱😱😱 This is a bit of a ‘hacky’ graph but it illustrates the point which is that the data are not in order in the dataset. If they were in order, then we’d expect them to be along the diagonal.</p>
<p>It’s super weird that they’re not in order in the raw data. Above, I checked by splitting them into pieces (day, month, year) and the counts were okay. But the ‘hacky’ graph was pretty hacky, so let’s try to summarise the data a little and then have another look. We’ll get a count by date and the sector of the shelter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Based on Lisa Lendway: </span></span>
<span id="cb19-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://github.com/llendway/tidy_tuesday_in_thirty/blob/main/2020_12_01_tidy_tuesday.Rmd</span></span>
<span id="cb19-3">toronto_shelters_by_day <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb19-4">  toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We only want rows with both occupancy and capacity  </span></span>
<span id="cb19-6">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>(occupancy, capacity) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We want to know the occupancy by date and sector</span></span>
<span id="cb19-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(date, sector) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(occupancy),</span>
<span id="cb19-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">capacity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(capacity),</span>
<span id="cb19-11">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">usage =</span> occupancy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> capacity, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'drop'</span>)</span>
<span id="cb19-12"></span>
<span id="cb19-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(toronto_shelters_by_day)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  date       sector   occupancy capacity usage
  &lt;date&gt;     &lt;chr&gt;        &lt;int&gt;    &lt;int&gt; &lt;dbl&gt;
1 2017-01-01 Co-ed          530      582 0.911
2 2017-01-01 Families      1030     1150 0.896
3 2017-01-01 Men           1595     1706 0.935
4 2017-01-01 Women          641      697 0.920
5 2017-01-01 Youth          499      518 0.963
6 2017-01-02 Co-ed          458      582 0.787</code></pre>
</div>
</div>
<p>We are interested in availability of shelter spots in Toronto on the basis of sector for each day. Different sectors focus on different folks: Co-ed, Families, Men, Women, Youth. Now for each day for each sector we have a proportion (note: horrifyingly &gt;1 is possible). In the notes to the data we’re told that the capacity in 2020 may not be accurate, so for this chart we’ll just focus on 2017-2019 (inclusive) (Figure @ref(fig:plotoccupancyrate)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Graph 2017-2019 (inc)</span></span>
<span id="cb21-2">toronto_shelters_by_day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> usage, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb21-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>,</span>
<span id="cb21-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy rate"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/plotoccupancyrate-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Occupancy rate per day in Toronto shelters</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>That one looks kind of okay, but we’ll again see the problem immediately when we plot the raw number occupied (we can bring this through to include 2020 as it’s not to do with capacity) (Figure @ref(fig:plotoccupancy)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">toronto_shelters_by_day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> occupancy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb22-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>,</span>
<span id="cb22-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy (number)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/plotoccupancy-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Occupancy per day in Toronto shelters</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can see that using modified data hides the problem. Let’s focus on 2017, as that’s where the biggest issue is and facet by month (Figure @ref(fig:sheltersin2017)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">toronto_shelters_by_day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> occupancy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb23-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,</span>
<span id="cb23-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy (number)"</span>,</span>
<span id="cb23-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Toronto shelters in 2017"</span>,</span>
<span id="cb23-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy per day"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb23-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersin2017-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Occupancy in Toronto shelters in 2017</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Just to check, let’s plot the same for 2018 (Figure @ref(fig:sheltersin2018)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">toronto_shelters_by_day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> occupancy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb24-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,</span>
<span id="cb24-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy (number)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb24-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dark2"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersin2018-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Daily occupancy in Toronto shelters in 2018</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>This gives us an idea of what we ought to expect in 2017 - why should they be significantly different? To start, focus on January 2017 and see if that makes it clearer what is going on (Figure @ref(fig:sheltersinjan2017)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">toronto_shelters_by_day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> occupancy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb25-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,</span>
<span id="cb25-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy (number)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersinjan2017-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Daily occupancy in Toronto shelters in January 2017</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>This perhaps gives us some idea of what is going on. Let’s just check February and see if it looks similar (Figure @ref(fig:sheltersinfeb2017)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">toronto_shelters_by_day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> occupancy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb26-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,</span>
<span id="cb26-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy (number)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersinfeb2017-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Daily occupancy in Toronto shelters in February 2017</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We’ve clearly got a problem with the first twelve days of the month. We noted at the start that when you look at the data it’s a bit odd in that it’s not in order. Let’s take another look at that by going back to the data as it was given to us (as opposed to the data by day that we’ve been using) (Figure @ref(fig:sheltersin2017byrow)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">counter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(toronto_shelters)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> counter, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> date)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Row in the dataset"</span>,</span>
<span id="cb27-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date of that row"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersin2017byrow-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Date of each row in order in 2017</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Although there’s no rule that says the dataset has to be in order of the date, if it were, then all the points would lie on the diagonal line. We have a lot of deviation from that. To get a sense of what we’re expecting let’s look at all four years (Figure @ref(fig:sheltersdatebyrow)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">counter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(toronto_shelters)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> counter, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> date)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date)),</span>
<span id="cb28-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Row in the dataset"</span>,</span>
<span id="cb28-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date of that row"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersdatebyrow-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Date of each row in order (2017-2020)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>It looks like 2020 is as we’d expect. 2019 has a few odd situations, but not too many. 2018 has a small cluster early in the dataset and then possibly something systematic toward the middle. But it’s clear that 2017 has a large number of systematic issues.</p>
<p>In general, I think that in 2017 the first 12 days are the wrong way around, i.e we think it’s year-month-day, but it’s actually year-day-month, but there are exceptions. As a first pass, let’s just try to flip those first 12 days of each month and see if that helps. It’ll be fairly blunt, but hopefully gets us somewhere.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">toronto_shelters <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb29-2">  toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb29-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date),</span>
<span id="cb29-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date),</span>
<span id="cb29-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">day =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(date),</span>
<span id="cb29-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(date),</span>
<span id="cb29-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">changed_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(</span>
<span id="cb29-9">      date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-01"</span>, </span>
<span id="cb29-10">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-01"</span>, </span>
<span id="cb29-11">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-02"</span>, </span>
<span id="cb29-12">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-02"</span>, </span>
<span id="cb29-13">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-02"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-03"</span>, </span>
<span id="cb29-14">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-03"</span>, </span>
<span id="cb29-15">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-03"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-04"</span>, </span>
<span id="cb29-16">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-04"</span>, </span>
<span id="cb29-17">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-04"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-05"</span>, </span>
<span id="cb29-18">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-05"</span>, </span>
<span id="cb29-19">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-05"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-05"</span>, </span>
<span id="cb29-20">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-06"</span>, </span>
<span id="cb29-21">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-06"</span>, </span>
<span id="cb29-22">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-06"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-07"</span>, </span>
<span id="cb29-23">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-07"</span>, </span>
<span id="cb29-24">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-07"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-08"</span>, </span>
<span id="cb29-25">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-08"</span>, </span>
<span id="cb29-26">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-08"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-09"</span>, </span>
<span id="cb29-27">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-09"</span>, </span>
<span id="cb29-28">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-09"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-10"</span>, </span>
<span id="cb29-29">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-10"</span>, </span>
<span id="cb29-30">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-10"</span>, </span>
<span id="cb29-31">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-11"</span>, </span>
<span id="cb29-32">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-11"</span>, </span>
<span id="cb29-33">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-12-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-12"</span>, </span>
<span id="cb29-34">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-05-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-06-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-07-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-08-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-09-12"</span>, </span>
<span id="cb29-35">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-10-12"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-11-12"</span>),</span>
<span id="cb29-36">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(year, day, month, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>),</span>
<span id="cb29-37">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(year, month, day, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>),</span>
<span id="cb29-38">    ),</span>
<span id="cb29-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">changed_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(changed_date)</span>
<span id="cb29-40">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>year, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>month, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>day)</span></code></pre></div>
</div>
<p>Now let’s take a look (Figure @ref(fig:sheltersdatebyrowadj)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">counter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(toronto_shelters)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> counter, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> changed_date)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Row in the dataset"</span>,</span>
<span id="cb30-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date of that row"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersdatebyrowadj-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Date of each row in order in 2017 after adjustment</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can see that’s almost entirely taken care of the systematic differences. However it’s probably a little blunt. For instance, notice there are now no entries below the diagonal (Figure @ref(fig:sheltersdatebyrowadj2017)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">toronto_shelters_adjusted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb31-2">  toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb31-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We only want rows with occupancy</span></span>
<span id="cb31-4">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>(occupancy, capacity) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb31-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We want to know the occupancy by date and sector</span></span>
<span id="cb31-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(changed_date, sector) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb31-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(occupancy), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'drop'</span>) </span>
<span id="cb31-8"></span>
<span id="cb31-9">toronto_shelters_adjusted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb31-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(changed_date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb31-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(changed_date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> occupancy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb31-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb31-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Changed day"</span>,</span>
<span id="cb31-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy (number)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(changed_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb31-18">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/sheltersdatebyrowadj2017-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Toronto shelters daily occupancy in 2017 after adjustment</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We could keep going here to try to get to the bottom of it, but the baby is going to wake up soon and I’ve got a history of wasting too much time on these types of things. One of the great things about the City of Toronto Data Portal is that each dataset has a publisher and a contact email. I’ll email them and will update this when they get back to me.</p>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<blockquote class="blockquote">
<p>…With a laptop, some free software, and a cup of coffee, I can examine what ought to seem like a staggering amount of information. …I sit here at home, surveying the scope of what’s being inflicted on people across the country and around the world as this disease spreads. … … People sometimes think (or complain) that working with quantitative data like this inures you to the reality of the human lives that lie behind the numbers. Numbers and measures are crude; they pick up the wrong things; they strip out the meaning of what’s happening to real people; they make it easy to ignore what can’t be counted. There’s something to those complaints. But it’s mostly a lazy critique. In practice, I find that far from distancing you from questions of meaning, quantitative data forces you to confront them. The numbers draw you in. Working with data like this is an unending exercise in humility, a constant compulsion to think through what you can and cannot see, and a standing invitation to understand what the measures really capture—what they mean, and for whom. …”</p>
<p>Kieran Healy, 2020, The Kitchen Counter Observatory, 21 May. https://kieranhealy.org/blog/archives/2020/05/21/the-kitchen-counter-observatory/</p>
</blockquote>
<p>Let’s start by looking at the effect of COVID on occupancy. On 17 March Ontario declared a state of emergency, so let’s focus on the time around then (Figure @ref(fig:focuson2020) includes a dashed line at that point).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">toronto_shelters_adjusted <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(changed_date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> changed_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> occupancy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> sector), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020-03-17"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dotted'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb32-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Changed date"</span>,</span>
<span id="cb32-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy (number)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/focuson2020-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Shelter usage in 2020</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>It’s clear that soon after the state of emergency was declared the usage of shelters began to decrease. Understandably the homeless, like all of us, want to socially distance to the extent possible and this likely means avoiding shelters. If you live in Toronto one thing that you’ll notice is that there are a lot of homeless people living in parks since COVID started. While this was fine in summer, the issue is that in winter it is well below 0C overnight.</p>
<p>We might like to see if we can estimate how many additional people are sleeping outside in January. We’ll do this by comparing the number that slept in the shelters in January 2021, compared with the number in the shelters in January 2020, which is before COVID hit Toronto. As Kieran Healy says, an exercise like this is confronting.</p>
<p>While it’s a stretch to say that if they’re not sleeping in a shelter then they must be sleeping outside, it’s also not clear where else they could be if they’re not in a shelter. It’s possible that they have found permanent housing and so are no longer using shelters, however I don’t know of any substantial change in public policy or resource allocation such that the whole difference is due to people finding permanent homes.</p>
<p>We’ll use the data that the city has so far released for 2021. The data provider warns us against using capacity, so we’ll focus on occupancy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">current_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> opendatatoronto<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_resource</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"29852011-c9c2-4b6d-a79a-b718f5ed1ae2"</span>)</span>
<span id="cb33-2"></span>
<span id="cb33-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_csv</span>(current_data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inputs/raw_data-January.csv"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">current_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inputs/raw_data-January.csv"</span>, </span>
<span id="cb34-2">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icccicccicccc"</span>)) </span>
<span id="cb34-3"></span>
<span id="cb34-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(current_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
    `_id` OCCUPANCY_DATE SECTOR SHELTER_POSTAL_CODE CAPACITY
    &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt;                  &lt;int&gt;
1 1914671 2021-01-01T05… Women  M5S 2P1                    8
2 1914672 2021-01-01T05… Famil… M5S 2P1                  174
3 1914673 2021-01-01T05… Famil… M5S 2P1                  140
4 1914674 2021-01-01T05… Famil… M5S 2P1                  360
5 1914675 2021-01-01T05… Co-ed  M5S 2P1                    8
6 1914676 2021-01-01T05… Women  M5S 2P1                    8
# ℹ 8 more variables: SHELTER_PROVINCE &lt;chr&gt;,
#   FACILITY_NAME &lt;chr&gt;, SHELTER_NAME &lt;chr&gt;,
#   OCCUPANCY &lt;int&gt;, ORGANIZATION_NAME &lt;chr&gt;,
#   SHELTER_ADDRESS &lt;chr&gt;, SHELTER_CITY &lt;chr&gt;,
#   PROGRAM_NAME &lt;chr&gt;</code></pre>
</div>
</div>
<p>Just want to do the same basic clean up of the dates as before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">current_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb36-2">  current_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-3">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the column names easier to type. Thanks Sharla!</span></span>
<span id="cb36-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(occupancy_date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T[:digit:]{2}:[:digit:]{2}:[:digit:]{2}"</span>),</span>
<span id="cb36-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ymd</span>(occupancy_date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quiet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb36-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(current_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
       id occupancy_date sector shelter_postal_code capacity
    &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt;                  &lt;int&gt;
1 1914671 2021-01-01     Women  M5S 2P1                    8
2 1914672 2021-01-01     Famil… M5S 2P1                  174
3 1914673 2021-01-01     Famil… M5S 2P1                  140
4 1914674 2021-01-01     Famil… M5S 2P1                  360
5 1914675 2021-01-01     Co-ed  M5S 2P1                    8
6 1914676 2021-01-01     Women  M5S 2P1                    8
# ℹ 9 more variables: shelter_province &lt;chr&gt;,
#   facility_name &lt;chr&gt;, shelter_name &lt;chr&gt;,
#   occupancy &lt;int&gt;, organization_name &lt;chr&gt;,
#   shelter_address &lt;chr&gt;, shelter_city &lt;chr&gt;,
#   program_name &lt;chr&gt;, date &lt;date&gt;</code></pre>
</div>
</div>
<p>For each day we want to know the number in each category. We’re then going to compare this to this time last year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">toronto_shelters_by_day_current <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb38-2">  current_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb38-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We only want rows with occupancy</span></span>
<span id="cb38-4">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>(occupancy) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb38-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We want to know the occupancy by date and sector</span></span>
<span id="cb38-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(date, sector) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb38-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(occupancy), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'drop'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb38-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month_day =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(date), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb38-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy_2021 =</span> occupancy)</span>
<span id="cb38-10"></span>
<span id="cb38-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(toronto_shelters_by_day_current)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  date       sector   occupancy_2021 month_day
  &lt;date&gt;     &lt;chr&gt;             &lt;int&gt; &lt;chr&gt;    
1 2021-01-01 Co-ed               515 1-1      
2 2021-01-01 Families           1128 1-1      
3 2021-01-01 Men                 986 1-1      
4 2021-01-01 Women               377 1-1      
5 2021-01-01 Youth               285 1-1      
6 2021-01-02 Co-ed               511 1-2      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">toronto_shelters_by_day_2020 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb40-2">  toronto_shelters <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We only want rows with occupancy</span></span>
<span id="cb40-4">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>(occupancy, capacity) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We want to know the occupancy by date and sector</span></span>
<span id="cb40-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(changed_date, sector) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(occupancy), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'drop'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(changed_date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">month_day =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">month</span>(changed_date), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">day</span>(changed_date), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Don't have to rename but it makes the join easier</span></span>
<span id="cb40-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> changed_date, </span>
<span id="cb40-12">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">occupancy_2020 =</span> occupancy)</span>
<span id="cb40-13"></span>
<span id="cb40-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(toronto_shelters_by_day_2020)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  date       sector   occupancy_2020 month_day
  &lt;date&gt;     &lt;chr&gt;             &lt;int&gt; &lt;chr&gt;    
1 2020-01-01 Co-ed               744 1-1      
2 2020-01-01 Families           2670 1-1      
3 2020-01-01 Men                1996 1-1      
4 2020-01-01 Women               845 1-1      
5 2020-01-01 Youth               534 1-1      
6 2020-01-02 Co-ed               744 1-2      </code></pre>
</div>
</div>
<p>Now we’re going to combine the datasets so that for each day, say ‘4 January’, we know that in 2020 shelter usage was X and on that day in 2021 we know that shelter usage was Y (Table @ref(tab:jandaily)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">toronto_shelters_by_day_current <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb42-2">  toronto_shelters_by_day_current <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(toronto_shelters_by_day_2020, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month_day"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month_day"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sector"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sector"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> date.x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(date, sector, occupancy_2020, occupancy_2021) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">difference =</span> occupancy_2021 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> occupancy_2020)</span>
<span id="cb42-7"></span>
<span id="cb42-8"></span>
<span id="cb42-9">toronto_shelters_by_day_current <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Date =</span> date,</span>
<span id="cb42-11">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sector =</span> sector,</span>
<span id="cb42-12">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Occupancy in 2020</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> occupancy_2020,</span>
<span id="cb42-13">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Occupancy in 2021</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> occupancy_2021,  </span>
<span id="cb42-14">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Difference =</span> difference) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-15">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comparison of shelter usage in January 2021 with January 2020 by day"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb42-16">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped" data-quarto-postprocess="true">
<caption>Comparison of shelter usage in January 2021 with January 2020 by day</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Occupancy in 2020</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Occupancy in 2021</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2021-01-01</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">744</td>
<td style="text-align: right;">515</td>
<td style="text-align: right;">-229</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-01</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2670</td>
<td style="text-align: right;">1128</td>
<td style="text-align: right;">-1542</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-01</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">986</td>
<td style="text-align: right;">-1010</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-01</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">845</td>
<td style="text-align: right;">377</td>
<td style="text-align: right;">-468</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-01</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">534</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">-249</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-02</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">744</td>
<td style="text-align: right;">511</td>
<td style="text-align: right;">-233</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-02</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2660</td>
<td style="text-align: right;">1122</td>
<td style="text-align: right;">-1538</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-02</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">985</td>
<td style="text-align: right;">-1005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-02</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">838</td>
<td style="text-align: right;">382</td>
<td style="text-align: right;">-456</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-02</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">532</td>
<td style="text-align: right;">282</td>
<td style="text-align: right;">-250</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-03</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">743</td>
<td style="text-align: right;">505</td>
<td style="text-align: right;">-238</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-03</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2645</td>
<td style="text-align: right;">1125</td>
<td style="text-align: right;">-1520</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-03</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1985</td>
<td style="text-align: right;">976</td>
<td style="text-align: right;">-1009</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-03</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">834</td>
<td style="text-align: right;">384</td>
<td style="text-align: right;">-450</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-03</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">534</td>
<td style="text-align: right;">276</td>
<td style="text-align: right;">-258</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-04</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">508</td>
<td style="text-align: right;">-237</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-04</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2636</td>
<td style="text-align: right;">1138</td>
<td style="text-align: right;">-1498</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-04</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1985</td>
<td style="text-align: right;">990</td>
<td style="text-align: right;">-995</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-04</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">848</td>
<td style="text-align: right;">387</td>
<td style="text-align: right;">-461</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-04</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">535</td>
<td style="text-align: right;">276</td>
<td style="text-align: right;">-259</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-05</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">744</td>
<td style="text-align: right;">510</td>
<td style="text-align: right;">-234</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-05</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2621</td>
<td style="text-align: right;">1137</td>
<td style="text-align: right;">-1484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-05</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">984</td>
<td style="text-align: right;">-1007</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-05</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">844</td>
<td style="text-align: right;">383</td>
<td style="text-align: right;">-461</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-05</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">529</td>
<td style="text-align: right;">271</td>
<td style="text-align: right;">-258</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-06</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">742</td>
<td style="text-align: right;">510</td>
<td style="text-align: right;">-232</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-06</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2607</td>
<td style="text-align: right;">1139</td>
<td style="text-align: right;">-1468</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-06</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">987</td>
<td style="text-align: right;">-1004</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-06</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">845</td>
<td style="text-align: right;">388</td>
<td style="text-align: right;">-457</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-06</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">534</td>
<td style="text-align: right;">267</td>
<td style="text-align: right;">-267</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-07</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">742</td>
<td style="text-align: right;">509</td>
<td style="text-align: right;">-233</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-07</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2611</td>
<td style="text-align: right;">1138</td>
<td style="text-align: right;">-1473</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-07</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1986</td>
<td style="text-align: right;">979</td>
<td style="text-align: right;">-1007</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-07</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">848</td>
<td style="text-align: right;">389</td>
<td style="text-align: right;">-459</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-07</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">535</td>
<td style="text-align: right;">268</td>
<td style="text-align: right;">-267</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-08</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">742</td>
<td style="text-align: right;">509</td>
<td style="text-align: right;">-233</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-08</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2618</td>
<td style="text-align: right;">1133</td>
<td style="text-align: right;">-1485</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-08</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">979</td>
<td style="text-align: right;">-1019</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-08</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">848</td>
<td style="text-align: right;">386</td>
<td style="text-align: right;">-462</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-08</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">536</td>
<td style="text-align: right;">269</td>
<td style="text-align: right;">-267</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-09</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">743</td>
<td style="text-align: right;">506</td>
<td style="text-align: right;">-237</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-09</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2638</td>
<td style="text-align: right;">1133</td>
<td style="text-align: right;">-1505</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-09</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">979</td>
<td style="text-align: right;">-1020</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-09</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">840</td>
<td style="text-align: right;">386</td>
<td style="text-align: right;">-454</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-09</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">533</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">-273</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-10</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">-245</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-10</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2627</td>
<td style="text-align: right;">1128</td>
<td style="text-align: right;">-1499</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-10</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">971</td>
<td style="text-align: right;">-1028</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-10</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">838</td>
<td style="text-align: right;">383</td>
<td style="text-align: right;">-455</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-10</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">535</td>
<td style="text-align: right;">263</td>
<td style="text-align: right;">-272</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-11</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">741</td>
<td style="text-align: right;">502</td>
<td style="text-align: right;">-239</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-11</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2616</td>
<td style="text-align: right;">1121</td>
<td style="text-align: right;">-1495</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-11</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">971</td>
<td style="text-align: right;">-1032</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-11</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">835</td>
<td style="text-align: right;">383</td>
<td style="text-align: right;">-452</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-11</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">538</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">-284</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-12</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">740</td>
<td style="text-align: right;">503</td>
<td style="text-align: right;">-237</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-12</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2634</td>
<td style="text-align: right;">1136</td>
<td style="text-align: right;">-1498</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-12</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">965</td>
<td style="text-align: right;">-1031</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-12</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">844</td>
<td style="text-align: right;">383</td>
<td style="text-align: right;">-461</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-12</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">536</td>
<td style="text-align: right;">262</td>
<td style="text-align: right;">-274</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-13</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">741</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">-241</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-13</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2629</td>
<td style="text-align: right;">1146</td>
<td style="text-align: right;">-1483</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-13</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">956</td>
<td style="text-align: right;">-1037</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-13</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">842</td>
<td style="text-align: right;">378</td>
<td style="text-align: right;">-464</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-13</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">532</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">-272</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-14</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">739</td>
<td style="text-align: right;">498</td>
<td style="text-align: right;">-241</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-14</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2635</td>
<td style="text-align: right;">1145</td>
<td style="text-align: right;">-1490</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-14</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">915</td>
<td style="text-align: right;">-1079</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-14</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">842</td>
<td style="text-align: right;">372</td>
<td style="text-align: right;">-470</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-14</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">537</td>
<td style="text-align: right;">265</td>
<td style="text-align: right;">-272</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-15</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">741</td>
<td style="text-align: right;">506</td>
<td style="text-align: right;">-235</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-15</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2655</td>
<td style="text-align: right;">1131</td>
<td style="text-align: right;">-1524</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-15</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1983</td>
<td style="text-align: right;">920</td>
<td style="text-align: right;">-1063</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-15</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">847</td>
<td style="text-align: right;">371</td>
<td style="text-align: right;">-476</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-15</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">539</td>
<td style="text-align: right;">266</td>
<td style="text-align: right;">-273</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-16</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">744</td>
<td style="text-align: right;">511</td>
<td style="text-align: right;">-233</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-16</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2654</td>
<td style="text-align: right;">1133</td>
<td style="text-align: right;">-1521</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-16</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1988</td>
<td style="text-align: right;">918</td>
<td style="text-align: right;">-1070</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-16</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">845</td>
<td style="text-align: right;">370</td>
<td style="text-align: right;">-475</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-16</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">533</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">-269</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-17</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">742</td>
<td style="text-align: right;">513</td>
<td style="text-align: right;">-229</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-17</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2649</td>
<td style="text-align: right;">1130</td>
<td style="text-align: right;">-1519</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-17</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">923</td>
<td style="text-align: right;">-1069</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-17</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">844</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">-478</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-17</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">532</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">-268</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-18</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">743</td>
<td style="text-align: right;">507</td>
<td style="text-align: right;">-236</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-18</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2639</td>
<td style="text-align: right;">1125</td>
<td style="text-align: right;">-1514</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-18</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">923</td>
<td style="text-align: right;">-1076</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-18</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">844</td>
<td style="text-align: right;">371</td>
<td style="text-align: right;">-473</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-18</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">535</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">-271</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-19</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">744</td>
<td style="text-align: right;">504</td>
<td style="text-align: right;">-240</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-19</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2631</td>
<td style="text-align: right;">1106</td>
<td style="text-align: right;">-1525</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-19</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">931</td>
<td style="text-align: right;">-1064</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-19</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">849</td>
<td style="text-align: right;">379</td>
<td style="text-align: right;">-470</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-19</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">536</td>
<td style="text-align: right;">263</td>
<td style="text-align: right;">-273</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-20</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">742</td>
<td style="text-align: right;">503</td>
<td style="text-align: right;">-239</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-20</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2629</td>
<td style="text-align: right;">1081</td>
<td style="text-align: right;">-1548</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-20</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">941</td>
<td style="text-align: right;">-1060</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-20</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">840</td>
<td style="text-align: right;">371</td>
<td style="text-align: right;">-469</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-20</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">536</td>
<td style="text-align: right;">263</td>
<td style="text-align: right;">-273</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-21</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">501</td>
<td style="text-align: right;">-244</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-21</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2647</td>
<td style="text-align: right;">1075</td>
<td style="text-align: right;">-1572</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-21</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">941</td>
<td style="text-align: right;">-1066</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-21</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">839</td>
<td style="text-align: right;">367</td>
<td style="text-align: right;">-472</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-21</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">534</td>
<td style="text-align: right;">263</td>
<td style="text-align: right;">-271</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-22</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">744</td>
<td style="text-align: right;">505</td>
<td style="text-align: right;">-239</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-22</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2648</td>
<td style="text-align: right;">1058</td>
<td style="text-align: right;">-1590</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-22</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">949</td>
<td style="text-align: right;">-1065</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-22</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">843</td>
<td style="text-align: right;">367</td>
<td style="text-align: right;">-476</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-22</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">531</td>
<td style="text-align: right;">267</td>
<td style="text-align: right;">-264</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-23</td>
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">740</td>
<td style="text-align: right;">508</td>
<td style="text-align: right;">-232</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-23</td>
<td style="text-align: left;">Families</td>
<td style="text-align: right;">2653</td>
<td style="text-align: right;">1058</td>
<td style="text-align: right;">-1595</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-23</td>
<td style="text-align: left;">Men</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">959</td>
<td style="text-align: right;">-1049</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-23</td>
<td style="text-align: left;">Women</td>
<td style="text-align: right;">842</td>
<td style="text-align: right;">362</td>
<td style="text-align: right;">-480</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-23</td>
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">530</td>
<td style="text-align: right;">273</td>
<td style="text-align: right;">-257</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Let’s get some average statistics for January by sector (Table @ref(tab:janaverage)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">january_average <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb43-2">  toronto_shelters_by_day_current <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(sector) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Difference =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(difference)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Difference =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(Difference))</span>
<span id="cb43-6"></span>
<span id="cb43-7">january_average <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sector =</span> sector,</span>
<span id="cb43-9">         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Difference this January compared with last</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Difference) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-10">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Overall comparison of shelter usage in January 2021 with January 2020"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb43-11">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped" data-quarto-postprocess="true">
<caption>Overall comparison of shelter usage in January 2021 with January 2020</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Difference this January compared with last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Co-ed</td>
<td style="text-align: right;">-236</td>
</tr>
<tr class="even">
<td style="text-align: left;">Families</td>
<td style="text-align: right;">-1516</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Men</td>
<td style="text-align: right;">-1037</td>
</tr>
<tr class="even">
<td style="text-align: left;">Women</td>
<td style="text-align: right;">-465</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Youth</td>
<td style="text-align: right;">-267</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Let’s look at a comparison graph (Figure @ref(fig:finalgraph)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">toronto_shelters_by_day_current <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>difference) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb44-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupancy_2020"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupancy_2021"</span>),</span>
<span id="cb44-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>,</span>
<span id="cb44-5">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"number"</span></span>
<span id="cb44-6">               ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb44-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'occupancy_2020'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2020'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2021'</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb44-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> number, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> year)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb44-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb44-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(sector)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb44-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb44-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>,</span>
<span id="cb44-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Occupancy in shelters (#)"</span>,</span>
<span id="cb44-14">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb44-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage_files/figure-html/finalgraph-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Comparison of shelter usage in January 2021 with January 2020</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>I estimate that in January, on average, there are roughly 3,517 additional people sleeping outside in below freezing conditions this year compared with last year. That is to say, shelter usage is that much below what it was, and I’m not sure where else they could go. In particular, on Friday night, when it was horrendously cold, I estimate there were 3,634 additional people likely sleeping outside, by comparing the usage of shelters on 22 January 2020 with 22 January 2021.</p>
<p>Even if I’m off by an order of magnitude, the city and province clearly should do more.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Thank you to Monica Alexander for helpful comments.</p>



</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-sharla" class="csl-entry">
Gelfand, Sharla. 2020. <em>Opendatatoronto: Access the City of Toronto Open Data Portal</em>. <a href="https://CRAN.R-project.org/package=opendatatoronto">https://CRAN.R-project.org/package=opendatatoronto</a>.
</div>
<div id="ref-citelubridate" class="csl-entry">
Grolemund, Garrett, and Hadley Wickham. 2011. <span>“Dates and Times Made Easy with <span class="nocase">lubridate</span>.”</span> <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="https://www.jstatsoft.org/v40/i03/">https://www.jstatsoft.org/v40/i03/</a>.
</div>
<div id="ref-citeR" class="csl-entry">
R Core Team. 2020. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-citetidyverse" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
</div></section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2021-01-24-shelter-usage-in-toronto-2017-2021/toronto-shelter-usage.html</guid>
  <pubDate>Sun, 24 Jan 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Getting started with MRP</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/getting-started-with-mrp.html</link>
  <description><![CDATA[ 



<section id="overview" class="level1">
<h1>Overview</h1>
<p>Multi-level regression with post-stratification (MRP) is a popular way to adjust non-representative samples to better analyse opinion and other survey responses. It uses a regression model to relate individual-level survey responses to various characteristics and then rebuilds the sample to better match the population. In this way MRP can not only allow a better understanding of responses, but also allow us to analyse data that may otherwise be unusable. However, it can be a challenge to get started with MRP as the terminology may be unfamiliar, and the data requirements can be onerous.</p>
<p>The purpose of this hands-on workshop is to de-mystify MRP and give participants the ability and confidence to: 1) critically read papers that use it; and 2) apply it in their own work. Examples of how to implement MRP will be illustrated in R using the brms package. No experience with R is required but workshop participants should bring a laptop that is: a) connected to the internet; b) has R and R Studio installed, along with the tidyverse and brms packages (if you have a hassle doing this then come early to the workshop and I can help you).</p>
<p>The GitHub repo that you should download is: https://github.com/RohanAlexander/mrp_workshop.</p>
</section>
<section id="schedule" class="level1">
<h1>Schedule</h1>
<ul>
<li>8:45 - 9:00: (Optional) Help with computer set-up.</li>
<li>9:00 - 9:15: Introduction, motivation, and example.</li>
<li>9:15 - 9:25: Live-coding introductory example.</li>
<li>9:25 - 9:45: Participants pair-code introductory example.</li>
<li>9:45 - 9:55: Live coding extended example.</li>
<li>10:00 - 10:30: Participants pair-code extended example.</li>
<li>10:30 - 10:50: Live example improving the workflow: gathering data from the ABS, improving the model, and communicating results.</li>
<li>10:50 - 11:00: Concluding remarks about strengths, weaknesses, and potential areas of application.</li>
</ul>
</section>
<section id="help-with-computer-set-up." class="level1">
<h1>Help with computer set-up.</h1>
<p>The primary programming language used for MRP tends to be R, but any similar language would be fine. That said, if you are already comfortable with another open source language, such as Python, then it wouldn’t hurt to learn R as well. You are welcome to use whatever language you are most comfortable with, but it will be easiest for you to be able to draw on other examples if you use R. All of the examples in this workshop are in R.</p>
<section id="computing" class="level2">
<h2 class="anchored" data-anchor-id="computing">Computing</h2>
<p>R can be downloaded for free from: http://cran.utstat.utoronto.ca/.</p>
<p>RStudio is an interface that makes using R easier and it can be downloaded for free from: https://rstudio.com/products/rstudio/download/.</p>
<p>We will use brms later in the tutorial. In order to use this your Mac needs to have Xcode and a bunch of other things installed. To do this go to: https://github.com/rmacoslib/r-macos-rtools#how-do-i-use-the-installer and within the ‘assets’ bit of the project’s release page, download ‘macos-rtools-3.1.0.pkg’ and then install that. It’ll take a few minutes because it is downloading and setting up a bunch of things.</p>
</section>
<section id="getting-help" class="level2">
<h2 class="anchored" data-anchor-id="getting-help">Getting help</h2>
<p>At some point your code won’t run or will throw an error. This is normal, and it happens to everyone. It happens to me on a daily, sometimes hourly, basis. Getting frustrated is understandable. There are a few steps that are worthwhile taking when this happens:</p>
<ul>
<li>If you are having issues with a particular function then the Help file for that function can be accessed by adding a ? to the front. e.g.&nbsp;‘?lm’.</li>
<li>If you’re getting an error then try googling it, (I find it can help to include the term ‘R’ and ‘MRP’ or ‘tidyverse’ or the relevant package name).</li>
<li>If your code just isn’t running, then try searching for what you are trying to do, e.g.&nbsp;‘save PDF of graph in R made using ggplot’. Almost always there are relevant blog posts or Stack Overflow answers that will help.</li>
<li>Try to restart R and R Studio and load everything again.</li>
<li>Try to restart your computer.</li>
</ul>
<p>There are a few small mistakes that I often make and may be worth checking in case you make them too:</p>
<ul>
<li>check the class e.g.&nbsp;class(my_dataset$its_column) to make sure that is what it should be;</li>
<li>when you’re using ggplot make sure you use ‘+’ not ‘%&gt;%’;</li>
<li>check whether you are using ‘.’ when you shouldn’t be, or vice versa.</li>
</ul>
<p>It’s almost always helpful to take a break and come back the next day.</p>
</section>
</section>
<section id="introduction-motivation-and-example" class="level1">
<h1>Introduction, motivation, and example</h1>
<p>Multi-level regression with post-stratification (MRP) is a handy approach when dealing with survey data. Essentially, it trains a model based on the survey, and then applies that trained model to another dataset. There are two main, related, advantages:</p>
<ol type="1">
<li>It can allow us to ‘re-weight’ in a way that includes uncertainty front-of-mind and isn’t hamstrung by small samples.</li>
<li>It can allow us to use broad surveys to speak to subsets.</li>
</ol>
<p>From a practical perspective, it tends to be less expensive to collect non-probability samples and so there are benefits of being able to use these types of data. That said, it is not a magic-bullet and the laws of statistics still apply. We will have larger uncertainty around our estimates and they will still be subject to all the usual biases. As <a href="https://twitter.com/jazzystats">Lauren Kennedy</a> points out, ‘MRP has traditionally been used in probability surveys and had potential for non-probability surveys, but we’re not sure of the limitations at the moment.’</p>
<p>One famous example is Wei Wang, David Rothschild, Sharad Goel, and Andrew Gelman, 2014, ‘Forecasting elections with non-representative polls’, <em>International Journal of Forecasting</em>. They used data from the Xbox gaming platform to forecast the 2012 US Presidential Election.</p>
<p>Key facts about the set-up:</p>
<ul>
<li>Data from an opt-in poll which was available on the Xbox gaming platform during the 45 days preceding the 2012 US presidential election.</li>
<li>Each day there were three to five questions, including voter intention: “If the election were held today, who would you vote for?”</li>
<li>Respondents were allowed to answer at most once per day.</li>
<li>First-time respondents were asked to provide information about themselves, including their sex, race, age, education, state, party ID, political ideology, and who they voted for in the 2008 presidential election.</li>
<li>In total, 750,148 interviews were conducted, with 345,858 unique respondents - over 30,000 of whom completed five or more polls</li>
<li>Young men dominate the Xbox population: 18-to-29-year-olds comprise 65 per cent of the Xbox dataset, compared to 19 per cent in the exit poll; and men make up 93 per cent of the Xbox sample but only 47 per cent of the electorate.</li>
</ul>
<p>Given the US electorate, they use a two-stage modelling approach. The details don’t really matter too much, and essentially they model how likely a respondent is to vote for Obama, given various information such as state, education, sex, etc: <img src="https://latex.codecogs.com/png.latex?%0APr%5Cleft(Y_i%20=%20%5Cmbox%7BObama%7D%20%7C%20Y_i%5Cin%5C%7B%5Cmbox%7BObama,%20Romney%7D%5C%7D%5Cright)%20=%20%5Cmbox%7Blogit%7D%5E%7B-1%7D(%5Calpha_0%20+%20%5Calpha_1(%5Cmbox%7Bstate%20last%20vote%20share%7D)%0A+%20%5Calpha_%7Bj%5Bi%5D%7D%5E%7B%5Cmbox%7Bstate%7D%7D%20+%20%5Calpha_%7Bj%5Bi%5D%7D%5E%7B%5Cmbox%7Bedu%7D%7D%20+%20%5Calpha_%7Bj%5Bi%5D%7D%5E%7B%5Cmbox%7Bsex%7D%7D...%0A)%0A"> They run this in R using glmer() from lme4.</p>
<p>Having a trained model that considers the effect of these various independent variables on support for the candidates, they now post-stratify, where each of these “cell-level estimates are weighted by the proportion of the electorate in each cell and aggregated to the appropriate level (i.e., state or national).”</p>
<p>This means that they need cross-tabulated population data. In general, the census would have worked, or one of the other large surveys available in the US, but the difficulty is that the variables need to be available on a cross-tab basis. As such, they use exit polls (not an option for Australia in general).</p>
<p>They make state-specific estimates by post-stratifying to the features of each state. <img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/states.png" class="quarto-discovered-preview-image img-fluid" alt="State estimates from the Xbox paper."></p>
<p>Similarly, they can examine demographic-differences. <img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/demographics.png" class="img-fluid" alt="Demographic differences from the Xbox paper."></p>
<p>Finally, they convert their estimates into electoral college estimates. <img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/electoral_college.png" class="img-fluid" alt="Electoral College estimates from the Xbox paper."></p>
</section>
<section id="live-coding-introductory-example" class="level1 page-columns page-full">
<h1>Live-coding introductory example</h1>
<p>The workflow that we are going to use is:</p>
<ol type="1">
<li>read in the poll;</li>
<li>model the poll;</li>
<li>read in the post-stratification data; and</li>
<li>apply the model to the post-stratification data.</li>
</ol>
<p>First load the packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Uncomment these (by deleting the #) if you need to install the packages</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("broom")</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("here")</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("skimr")</span></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("tidyverse")</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(broom) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helps make the regression results tidier</span></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helps make file referencing easier.</span></span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(skimr) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helps summarise the data</span></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helps make programming with R easier</span></span></code></pre></div>
</div>
<p>Then load some sample polling data to analyse. I have generated this fictitious data so that we have some idea of what to expect from the model. The dependent variable is supports_ALP, which is a binary variable - either 0 or 1. We’ll just use two independent variables here: gender, which is either Female or Male (as that is what is available from the ABS); and age_group, which is one of four groups: ages 18 to 29, ages 30 to 44, ages 45 to 59, ages 60 plus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">example_poll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outputs/data/example_poll.csv"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here we read in a </span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CSV file and assign it to a dataset called 'example_poll'</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(example_poll) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Displays the first 10 rows</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  gender age_group  supports_ALP state
  &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;
1 Male   ages30to44            0 NSW  
2 Female ages45to59            0 NSW  
3 Female ages60plus            1 VIC  
4 Male   ages30to44            1 QLD  
5 Female ages30to44            1 QLD  
6 Female ages18to29            1 VIC  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Look at some summary statistics to make sure the data seem reasonable</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(example_poll) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    gender           age_group          supports_ALP       state          
 Length:5000        Length:5000        Min.   :0.0000   Length:5000       
 Class :character   Class :character   1st Qu.:0.0000   Class :character  
 Mode  :character   Mode  :character   Median :1.0000   Mode  :character  
                                       Mean   :0.5514                     
                                       3rd Qu.:1.0000                     
                                       Max.   :1.0000                     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">skimr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">skim</span>(example_poll)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">example_poll</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">5000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_group</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">state</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">supports_ALP</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">▆▁▁▁▇</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>I generated this polling data to make both made males and older people less likely to vote for the Australian Labor Party; and females and younger people more likely to vote for the Labor Party. Females are over-sampled. As such, we should have an ALP skew on the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The '%&gt;%' is called a 'pipe' and it takes whatever the output is of the </span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># command before it, and pipes it to the command after it.</span></span>
<span id="cb7-3">example_poll <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># So we are taking our example_poll dataset and using it as an </span></span>
<span id="cb7-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># input to 'summarise'.</span></span>
<span id="cb7-5">   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># summarise reduces the dimensions, so here we will get one number from a column.</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">raw_ALP_prop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(supports_ALP) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(example_poll))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  raw_ALP_prop
         &lt;dbl&gt;
1        0.551</code></pre>
</div>
</div>
<p>Now we’d like to see if we can get our results back (we should find females less likely than males to vote for Australian Labor Party and that people are less likely to vote Australian Labor Party as they get older). Our model is: <img src="https://latex.codecogs.com/png.latex?%0A%5Cmbox%7BALP%20support%7D_j%20=%20%5Cmbox%7Bgender%7D_j%20+%20%5Cmbox%7Bage_group%7D_j%20+%20%5Cepsilon_j.%0A"></p>
<p>This model says that the probability that some person, <img src="https://latex.codecogs.com/png.latex?j">, will vote for the Australian Labor Party depends on their gender and their age-group. Based on our simulated data, we would like older age-groups to be less likely to vote for the Australian Labor Party and for males to be less likely to vote for the Australian Labor Party.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here we are running an OLS regression with supports_ALP as the dependent variable </span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and gender and age_group as the independent variables. The dataset that we are </span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using is example_poll. We are then saving that OLS regression to a variable called 'model'.</span></span>
<span id="cb9-4">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(supports_ALP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> age_group, </span>
<span id="cb9-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> example_poll</span>
<span id="cb9-6">            )</span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># broom::tidy just displays the outputs of the regression in a nice table.</span></span>
<span id="cb9-9">broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(model) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  term                estimate std.error statistic   p.value
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)            0.900    0.0131      68.8 0        
2 genderMale            -0.205    0.0142     -14.4 2.69e- 46
3 age_groupages30to44   -0.186    0.0176     -10.6 6.50e- 26
4 age_groupages45to59   -0.402    0.0177     -22.7 8.29e-109
5 age_groupages60plus   -0.585    0.0175     -33.4 5.20e-221</code></pre>
</div>
</div>
<p>Essentially we’ve got our inputs back. We just used regular OLS even though our dependent variable is a binary. (It’s usually fine to start with an OLS model and then iterate toward an approach that may be more appropriate such as logistic regression or whatever, but where the results are a little more difficult to interpret.) If you wanted to do that then the place to start would be glmer() from the R package lme4, and we’ll see that in the next section.</p>
<aside>
<a href="https://www.monicaalexander.com/">Monica</a> is horrified by the use of OLS here, and wants it on the record that she regrets not making not doing this part of our marriage vows.
</aside>
<p>Now we’d like to see if we can use what we found in the poll to get an estimate for each state based on their demographic features.</p>
<p>First read in some real demographic data, on a seat basis, from the ABS (we’ll go into the process of getting this later).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">census_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outputs/data/census_data.csv"</span>)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(census_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  state gender age_group  number cell_prop_of_division_total
  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;dbl&gt;                       &lt;dbl&gt;
1 ACT   Female ages18to29  34683                       0.125
2 ACT   Female ages30to44  42980                       0.155
3 ACT   Female ages45to59  33769                       0.122
4 ACT   Female ages60plus  30322                       0.109
5 ACT   Male   ages18to29  34163                       0.123
6 ACT   Male   ages30to44  41288                       0.149</code></pre>
</div>
</div>
<p>We’re just going to do some rough forecasts. For each gender and age_group we want the relevant coefficient in the example_data and we can construct the estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here we are making predictions using our model with some new data from the </span></span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># census, and we saving the results of those predictions by adding a new column </span></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to the census_data dataset called 'estimate'.</span></span>
<span id="cb13-4">census_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb13-5">  model <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> census_data)</span>
<span id="cb13-7"></span>
<span id="cb13-8">census_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alp_predict_prop =</span> estimate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cell_prop_of_division_total) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alp_predict =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(alp_predict_prop))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
  state alp_predict
  &lt;chr&gt;       &lt;dbl&gt;
1 ACT         0.525
2 NSW         0.495
3 NT          0.541
4 QLD         0.496
5 SA          0.479
6 TAS         0.464
7 VIC         0.503
8 WA          0.503</code></pre>
</div>
</div>
<p>We now have post-stratified estimates for each division. Our model has a fair few weaknesses. For instance small cell counts are going to be problematic. And our approach ignores uncertainty, but now that we have something working we can complicate it.</p>
</section>
<section id="participants-pair-code-introductory-example" class="level1">
<h1>Participants pair-code introductory example</h1>
<p><em>Please break into pairs and with one person ‘driving’ (typing) and the other person ‘navigating’, and attempt to pair-code the introductory example.</em></p>
<p>If you run into issues then I am happy to help point you in the right direction. The full code of the example will be made available after the workshop, so it doesn’t matter if you’re not able to complete the example now.</p>
<p>As a reminder, our workflow is:</p>
<ol type="1">
<li>read in the poll;</li>
<li>model the poll;</li>
<li>read in the post-stratification data;</li>
<li>apply your model to the post-stratification data.</li>
</ol>
<p>Get started by opening the Rproj file from the workshop repo and opening a new R script.</p>
</section>
<section id="live-coding-extended-example" class="level1">
<h1>Live coding extended example</h1>
<p>We’d like to address some of the major issues with our approach, specifically being able to deal with small cell counts, and also taking better account of uncertainty. As we are dealing with survey data, prediction intervals or something similar are crticial, and it’s not appropriate to only report central estimates. To do this we’ll use the same broad approach as before, but just improving bits of our workflow.</p>
<p>First load the packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Uncomment these if you need to install the packages</span></span>
<span id="cb15-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("broom")</span></span>
<span id="cb15-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("brms")</span></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("here") </span></span>
<span id="cb15-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("tidybayes")</span></span>
<span id="cb15-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("tidyverse") </span></span>
<span id="cb15-7"></span>
<span id="cb15-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(broom)</span>
<span id="cb15-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(brms) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used for the modelling</span></span>
<span id="cb15-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb15-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidybayes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used to help understand the modelling estimates</span></span>
<span id="cb15-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse) </span></code></pre></div>
</div>
<p>As before, read in the polling dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">example_poll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outputs/data/example_poll.csv"</span>)</span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(example_poll)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  gender age_group  supports_ALP state
  &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;
1 Male   ages30to44            0 NSW  
2 Female ages45to59            0 NSW  
3 Female ages60plus            1 VIC  
4 Male   ages30to44            1 QLD  
5 Female ages30to44            1 QLD  
6 Female ages18to29            1 VIC  </code></pre>
</div>
</div>
<p>Now, using the same basic model as before, but we move it to a setting that acknowledges the dependent variable as being binary, and in a Bayesian setting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(supports_ALP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> age_group, </span>
<span id="cb18-2">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> example_poll, </span>
<span id="cb18-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bernoulli</span>(),</span>
<span id="cb18-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outputs/model/brms_model"</span></span>
<span id="cb18-5">             )</span>
<span id="cb18-6"></span>
<span id="cb18-7">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_rds</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outputs/model/brms_model.rds"</span>)</span>
<span id="cb18-8"></span>
<span id="cb18-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: bernoulli 
  Links: mu = logit 
Formula: supports_ALP ~ gender + age_group 
   Data: example_poll (Number of observations: 5000) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Population-Level Effects: 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept               2.07      0.09     1.91     2.23 1.00     2240     2194
genderMale             -1.06      0.07    -1.20    -0.91 1.00     3406     2595
age_groupages30to44    -1.10      0.10    -1.29    -0.91 1.00     2483     2805
age_groupages45to59    -2.04      0.10    -2.23    -1.85 1.00     2521     3061
age_groupages60plus    -2.88      0.10    -3.09    -2.68 1.00     2517     2858

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>We’ve moved to the Bernoulli distribution, so we have to do a bit more work to understand our results, but we are broadly getting back what we’d expect.</p>
<p>As before, we’d like an estimate for each state based on their demographic features and start by reading in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">census_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outputs/data/census_data.csv"</span>)</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(census_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  state gender age_group  number cell_prop_of_division_total
  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;dbl&gt;                       &lt;dbl&gt;
1 ACT   Female ages18to29  34683                       0.125
2 ACT   Female ages30to44  42980                       0.155
3 ACT   Female ages45to59  33769                       0.122
4 ACT   Female ages60plus  30322                       0.109
5 ACT   Male   ages18to29  34163                       0.123
6 ACT   Male   ages30to44  41288                       0.149</code></pre>
</div>
</div>
<p>We’re just going to do some rough forecasts. For each gender and age_group we want the relevant coefficient in the example_data and we can construct the estimates (this code is from Monica Alexander, https://www.monicaalexander.com/posts/2019-08-07-mrp/).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">post_stratified_estimates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb22-2">  model <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-3">  tidybayes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_predicted_draws</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> census_data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alp_predict =</span> .prediction) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alp_predict_prop =</span> alp_predict<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cell_prop_of_division_total) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state, .draw) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alp_predict =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(alp_predict_prop)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(alp_predict), </span>
<span id="cb22-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(alp_predict, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>), </span>
<span id="cb22-11">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(alp_predict, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">post_stratified_estimates</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
  state  mean lower upper
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 ACT   0.528 0.243 0.791
2 NSW   0.497 0.214 0.759
3 NT    0.539 0.253 0.852
4 QLD   0.495 0.215 0.767
5 SA    0.479 0.201 0.761
6 TAS   0.466 0.183 0.758
7 VIC   0.503 0.224 0.766
8 WA    0.501 0.219 0.765</code></pre>
</div>
</div>
<p>We now have post-stratified estimates for each division. Our new Bayesian approach will enable us to think more deeply about uncertainty. We could complicate this in a variety of ways including adding more coefficients (but remember that we’d need to get new cell counts), or adding some layers.</p>
</section>
<section id="participants-pair-code-extended-example" class="level1">
<h1>Participants pair-code extended example</h1>
<p><em>Please break into the same pairs as before, but swap who is typing, and attempt to pair-code the extended example.</em></p>
<p>If you run into issues then I am happy to help point you in the right direction. The full code of the example will be made available after the workshop, so it doesn’t matter if you’re not able to complete the example now.</p>
<p>As a reminder, our workflow is:</p>
<ol type="1">
<li>read in the poll;</li>
<li>model the poll;</li>
<li>read in the post-stratification data;</li>
<li>apply your model to the post-stratification data.</li>
</ol>
</section>
<section id="live-coding" class="level1 page-columns page-full">
<h1>Live coding</h1>
<p>I will now briefly demonstrate some other aspects that may be useful to improve three aspects of our MRP workflow:</p>
<ol type="1">
<li>(Workflow step 2) adding some more complexity to our model; and</li>
<li>(Workflow step 3) gathering and preparing some data from the ABS that we could use to post-stratify on.</li>
</ol>
<p>We will also add a fifth stage to our workflow: Communicating our results.</p>
<section id="adding-layers" class="level2">
<h2 class="anchored" data-anchor-id="adding-layers">Adding layers</h2>
<p>We may like to try to add some layers to our model. For instance, we may like a different intercept for each state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">model_states <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(supports_ALP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> age_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>state), </span>
<span id="cb26-2">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> example_poll, </span>
<span id="cb26-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bernoulli</span>(),</span>
<span id="cb26-4">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outputs/model/brms_model_states"</span>,</span>
<span id="cb26-5">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adapt_delta =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span>)</span>
<span id="cb26-6">                    )</span>
<span id="cb26-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model_states)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: bernoulli 
  Links: mu = logit 
Formula: supports_ALP ~ gender + age_group + (1 | state) 
   Data: example_poll (Number of observations: 5000) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Group-Level Effects: 
~state (Number of levels: 8) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.06      0.05     0.00     0.20 1.00     1554     2072

Population-Level Effects: 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept               2.07      0.09     1.90     2.26 1.00     1660     2273
genderMale             -1.06      0.08    -1.21    -0.91 1.00     4109     2833
age_groupages30to44    -1.10      0.10    -1.30    -0.90 1.00     2110     2566
age_groupages45to59    -2.04      0.10    -2.24    -1.84 1.00     2058     2347
age_groupages60plus    -2.89      0.10    -3.10    -2.69 1.00     2201     2581

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">broom.mixed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(model_states, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"varying"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tidy.brmsfit(model_states, par_type = "varying"): some parameter
names contain underscores: term naming may be unreliable!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  effect   component group term            estimate std.error conf.low conf.high
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 fixed    cond      &lt;NA&gt;  (Intercept)       2.07      0.0916  1.90        2.26 
2 fixed    cond      &lt;NA&gt;  genderMale       -1.06      0.0768 -1.21       -0.909
3 fixed    cond      &lt;NA&gt;  age_groupages3…  -1.10      0.102  -1.30       -0.899
4 fixed    cond      &lt;NA&gt;  age_groupages4…  -2.04      0.101  -2.24       -1.84 
5 fixed    cond      &lt;NA&gt;  age_groupages6…  -2.89      0.105  -3.10       -2.69 
6 ran_pars cond      state sd__(Intercept)   0.0592    0.0517  0.00247     0.195</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">broom.mixed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(model_states, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"non-varying"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">robust =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tidy.brmsfit(model_states, par_type = "non-varying", robust = TRUE):
some parameter names contain underscores: term naming may be unreliable!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  effect   component group term            estimate std.error conf.low conf.high
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 fixed    cond      &lt;NA&gt;  (Intercept)       2.07      0.0899  1.90        2.26 
2 fixed    cond      &lt;NA&gt;  genderMale       -1.06      0.0741 -1.21       -0.909
3 fixed    cond      &lt;NA&gt;  age_groupages3…  -1.10      0.104  -1.30       -0.899
4 fixed    cond      &lt;NA&gt;  age_groupages4…  -2.04      0.101  -2.24       -1.84 
5 fixed    cond      &lt;NA&gt;  age_groupages6…  -2.88      0.104  -3.10       -2.69 
6 ran_pars cond      state sd__(Intercept)   0.0474    0.0412  0.00247     0.195</code></pre>
</div>
</div>
<p>One interesting aspect is that our multi-level approach will allow us to deal with small cell counts by borrowing information from other cells.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">example_poll <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(state)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
  state     n
  &lt;chr&gt; &lt;int&gt;
1 ACT     107
2 NSW    1622
3 NT       50
4 QLD     982
5 SA      359
6 TAS     105
7 VIC    1285
8 WA      490</code></pre>
</div>
</div>
<p>At the moment we have 50 respondents in the Northern Territory, 105 in Tasmania, and 107 in the ACT. Even if we were to remove most of the, say, 18 to 29 year old, male respondents from Tasmania our model would still provide estimates. It does this by pooling, in which the effect of these young, male, Tasmanians is partially determined by other cells that do have respondents.</p>
</section>
<section id="gathering-data" class="level2">
<h2 class="anchored" data-anchor-id="gathering-data">Gathering data</h2>
<p>Getting data tends to be the most troublesome aspect. I’ve found that the census is fairly useful although it can require some trade-offs (e.g.&nbsp;if you are doing political work then it’s not exactly the same as the electoral roll even if you restrict it to Australian citizens aged at least 18). Nonetheless, I’ve found the best way to get the sub-cell counts is to use ABS TableBuilder. There are two versions - ‘basic’ which is free, and ‘pro’, which is normally $2,510 per year, but which you can get access to if you’re associated with an Australian university.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/tablebuilder.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">TableBuilder front page.</figcaption><p></p>
</figure>
</div>
<p>Once you create an account then you can access census data for 2006, 2011, and 2016. (The ABS have relatively recently done some linking between censuses so there is actually some linked data, which is exciting).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/census_select_type.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">TableBuilder after logging in.</figcaption><p></p>
</figure>
</div>
<p>The website is a bit cumbersome, but considering what they provide it is worth sticking with it. I usually use ‘Counting Persons, Place of Usual Residence’, but sometimes ‘Counting Persons, Place of Enumeration’ is also handy.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/census_type.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">TableBuilder selecting which census.</figcaption><p></p>
</figure>
</div>
<p>We want to create a new table, and we do this by specifying the columns and rows.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/census_cols.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">TableBuilder selecting columns.</figcaption><p></p>
</figure>
</div>
<p>Once you have the set-up that you want then you can retrieve the data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/census_rows.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">TableBuilder selecting rows.</figcaption><p></p>
</figure>
</div>
<p>You can download the data in various Excel, CSV, and other formats. If your dataset is large then you may need to submit for it to be built, which can take a day or two. Finally, if your sub-cell counts are especially small, then they will be blown around by the randomness that the ABS adds.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/inputs/figures/census_download.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">TableBuilder downloading data and creating custom groups.</figcaption><p></p>
</figure>
</div>
<p>Helpfully you can create custom groupings for geography, say to load specific electorates, and other aspects, such as age-groups. To get started with this, select ‘Custom data’.</p>
</section>
<section id="communication" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="communication">Communication</h2>
<p>There are many interesting aspects that we may like to communicate to others. For instance, we may like to show how the model is affecting the results. We can make a graph that compares the raw estimate with the model estimate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">post_stratified_estimates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>(state), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MRP estimate"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> lower, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> upper), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb36-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion ALP support"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"State"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb36-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> example_poll <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-8">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state, supports_ALP) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-9">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-10">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-11">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop =</span> n<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-12">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(supports_ALP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb36-13">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(state, prop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Raw data"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/getting-started-with-mrp_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Similarly, we may like to plot the distribution of the coefficients.</p>
<aside>
You can work out which coefficients to be pass to gather_draws by using tidybayes::get_variables(model). (In this example I passed ‘b_.’, but the ones of interest to you may be different.)
</aside>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">model <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather_draws</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b_.*</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">regex=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coefficient =</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(.variable, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b_"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coefficient =</span> forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_recode</span>(coefficient,</span>
<span id="cb38-6">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Intercept =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Intercept"</span>,</span>
<span id="cb38-7">                                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Is male</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genderMale"</span>,</span>
<span id="cb38-8">                                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age 30-44</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_groupages30to44"</span>,</span>
<span id="cb38-9">                                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age 45-59</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_groupages45to59"</span>,</span>
<span id="cb38-10">                                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age 60+</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_groupages60plus"</span></span>
<span id="cb38-11">                                           )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb38-12"></span>
<span id="cb38-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># both %&gt;% </span></span>
<span id="cb38-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(coefficient), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb38-15">  ggridges<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density_ridges2</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> ..density..),</span>
<span id="cb38-16">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rel_min_height =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, </span>
<span id="cb38-17">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"density"</span>,</span>
<span id="cb38-18">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribution of estimate"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coefficient"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dataset: "</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb38-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/getting-started-with-mrp_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="concluding-remarks" class="level1">
<h1>Concluding remarks</h1>
<p>In general, MRP is a good way to accomplish specific aims, but it’s not without trade-offs. If you have a good quality survey, then it may be a way to speak to disaggregated aspects of it. Or if you are concerned about uncertainty then it is a good way to think about that. If you have a biased survey then it’s a great place to start, but it’s not a panacea.</p>
<p>There’s not a lot of work that’s been done using Australian data, so there’s plenty of scope for exciting work. I look forward to seeing what you do with it!</p>
</section>
<section id="next-steps" class="level1">
<h1>Next steps</h1>
<p>There are a lot of resources out there that would make great next steps. I recommend having a look at the following resources to see which speaks best to your interests and background.</p>
<ol type="1">
<li>Alexander, Monica, 2019, ‘Analyzing name changes after marriage using a non-representative survey’, available at: https://www.monicaalexander.com/posts/2019-08-07-mrp/.</li>
<li>Kennedy, Lauren, and Jonah Gabry, 2019, ‘MRP with rstanarm’, available at: https://mc-stan.org/rstanarm/articles/mrp.html.</li>
<li>Kennedy, Lauren, and Andrew Gelman, 2019, ‘Know your population and know your model: Using model-based regression and poststratification to generalize findings beyond the observed sample’, available at: https://arxiv.org/abs/1906.11323.</li>
<li>Kastellec, Jonathan, Jeffrey Lax, and Justin Phillips, 2016, ‘Estimating State Public Opinion With Multi-Level Regression and Poststratification using R’, available at: https://scholar.princeton.edu/sites/default/files/jkastellec/files/mrp_primer.pdf.</li>
<li>Hanretty, Chris, 2019, ‘An introduction to multilevel regression and post-stratification for estimating constituency opinion’, available at: https://journals.sagepub.com/doi/abs/10.1177/1478929919864773.</li>
<li>Downes, Marnie, Lyle Gurrin, Dallas English, Jane Pirkis, Dianne Currier, Matthew Spittal, and John Carlin, 2018, ‘Multilevel Regression and Poststratification: A Modeling Approach to Estimating Population Quantities From Highly Selected Survey Samples’, available at: https://www.ncbi.nlm.nih.gov/pubmed/29635276.</li>
<li>Jackman, Simon, Shaun Ratcliff, and Luke Mansillo, 2019, ‘Small area estimates of public opinion: Model-assisted post-stratification of data from voter advice applications’, available at: https://www.cambridge.org/core/membership/services/aop-file-manager/file/5c2f6ebb7cf9ee1118d11c0a/APMM-2019-Simon-Jackman.pdf</li>
<li>(Self-promotion alert) Alexander, Rohan, Patrick Dumont, and Patrick Leslie, 2019, ‘Forecasting Multi-District Election’, available at: https://github.com/RohanAlexander/ForecastingMultiDistrictElections.</li>
</ol>
<p>If you don’t have survey data, then there is some individual-level data available on the Australian Data Archive: https://ada.edu.au. You will need to request access to the datasets, but they are very keen for people to use their data and will help you through the process if needed.</p>


</section>

 ]]></description>
  <guid>https://rohanalexander.com/posts/2019-12-04-getting_started_with_mrp/getting-started-with-mrp.html</guid>
  <pubDate>Tue, 03 Dec 2019 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Gathering and analysing text data</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2019-01-03-gathering-and-analysing-text-data/gathering-and-analysing-text-data.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Text modelling is an exciting area of research. But many guides assume that you already have a nice dataset. Similarly, web scraping is an exciting way to get information, but not many explanations go on to explain what you could do with it. This post attempts to go from scraping text from a website through to modelling the topics. It’s not meant to be an exhaustive post, but should hopefully provide enough that you can get started with your own project and know where to go for more information.</p>
<p>The example that I’m going to use is getting data from the minutes of the RBA board meeting.</p>
</section>
<section id="gathering-data" class="level1">
<h1>Gathering data</h1>
<p>The first step is to get some data. I’m going to use the rvest package to do the web scraping. When you are scraping data you should try to be polite - slow down your requests as much as possible, avoid times you know they’ll have a lot of traffic, and check if the website has an API or a robots.txt file (usually access that at domain.com/robots.txt) that provides guidance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("rvest")</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("tidyverse")</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in the list of the website addresses</span></span>
<span id="cb1-7">data_to_scrape <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inputs/addresses.csv"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Just a list of the URLs </span></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and dates for each minutes.</span></span>
<span id="cb1-9">address_to_visit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_to_scrape<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>address</span>
<span id="cb1-10">save_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_to_scrape<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>save_name</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the function that will visit address_to_visit and save to save_name files</span></span>
<span id="cb1-13">visit_address_and_save_content <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-14">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(name_of_address_to_visit,</span>
<span id="cb1-15">           name_of_file_to_save_as) {</span>
<span id="cb1-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The function takes two inputs</span></span>
<span id="cb1-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(name_of_address_to_visit) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Go to the website and read the html</span></span>
<span id="cb1-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_node</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#content"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the content part</span></span>
<span id="cb1-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_text</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the text of the content part</span></span>
<span id="cb1-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_lines</span>(name_of_file_to_save_as) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save as a text file</span></span>
<span id="cb1-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Done with"</span>, name_of_address_to_visit, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"at"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.time</span>()))  </span>
<span id="cb1-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helpful so that you know progress when running it on all the records</span></span>
<span id="cb1-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.sleep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Space out each request by somewhere between </span></span>
<span id="cb1-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 30 and 60 seconds each so that we don't overwhelm their server</span></span>
<span id="cb1-25">  }</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If there is an error then ignore it and move to the next one</span></span>
<span id="cb1-28">visit_address_and_save_content <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">safely</span>(visit_address_and_save_content)</span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Walk through the addresses and apply the function to each</span></span>
<span id="cb1-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">walk2</span>(address_to_visit,</span>
<span id="cb1-33">      save_name,</span>
<span id="cb1-34">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">visit_address_and_save_content</span>(.x, .y)) </span></code></pre></div>
</div>
<p>The CSV with the addresses and save names that we use looks something like this:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 72%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">address</th>
<th style="text-align: left;">save_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">https://www.rba.gov.au/monetary-policy/rba-board-minutes/2018/2018-11-06.html</td>
<td style="text-align: left;">inputs/minutes/2018-11-06.txt</td>
</tr>
<tr class="even">
<td style="text-align: left;">https://www.rba.gov.au/monetary-policy/rba-board-minutes/2018/2018-10-02.html</td>
<td style="text-align: left;">inputs/minutes/2018-10-02.txt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">https://www.rba.gov.au/monetary-policy/rba-board-minutes/2018/2018-09-04.html</td>
<td style="text-align: left;">inputs/minutes/2018-09-04.txt</td>
</tr>
<tr class="even">
<td style="text-align: left;">https://www.rba.gov.au/monetary-policy/rba-board-minutes/2018/2018-08-07.html</td>
<td style="text-align: left;">inputs/minutes/2018-08-07.txt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">https://www.rba.gov.au/monetary-policy/rba-board-minutes/2018/2018-07-03.html</td>
<td style="text-align: left;">inputs/minutes/2018-07-03.txt</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="analysing-data" class="level1">
<h1>Analysing data</h1>
<p>In this example we’ll use a whole bunch of packages so that you can see what’s available. In general probably stringr, quanteda and stm are the workhorse packages with others used as needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### Workspace set-up ####</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("broom")</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(broom) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used to clean up results</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("devtools")</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(devtools)</span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># devtools::install_github("DavisVaughan/furrr")</span></span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(furrr) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used to do parallel processing with the topic models</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plan</span>(multiprocess)</span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("quanteda")</span></span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(quanteda) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used for data cleaning</span></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("readtext")</span></span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readtext) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used to read in the txt files that were scraped</span></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("stm")</span></span>
<span id="cb2-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stm) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used for more interesting topic models</span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("tictoc")</span></span>
<span id="cb2-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tictoc) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used for timing</span></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("tidytext")</span></span>
<span id="cb2-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidytext)</span>
<span id="cb2-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("tidyverse")</span></span>
<span id="cb2-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used for everything</span></span>
<span id="cb2-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages('topicmodels')</span></span>
<span id="cb2-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(topicmodels) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Used to make basic topic models</span></span>
<span id="cb2-23"></span>
<span id="cb2-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read in the text that we scraped earlier</span></span>
<span id="cb2-25">text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> readtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readtext</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inputs/minutes/*.txt"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># readtext makes this easy, </span></span>
<span id="cb2-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># but could also use the usual base approach of listing files that end in txt etc.</span></span></code></pre></div>
</div>
<p>In general you’ll often need to do a lot of cleaning before you can do the stats bit and get results. Here, I’ll just show two example steps. I’ve found that cleaning the dataset seems to take about 80 per cent of the time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### Clean data ####</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Do some basic cleaning - remove puncuation and change everything to lower case</span></span>
<span id="cb3-3">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_to_lower</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text)</span>
<span id="cb3-4">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[:punct:]"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>)</span></code></pre></div>
</div>
<p>Now that we have a plausibly clean dataset (of course you’d want to come back and clean it more if you were actually interested in analysing the RBA minutes), we can try a topic model. Topic models are essentially just summaries. Instead of a document becoming a collection of words, they become a collection of topics with some probability associated with each topic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### First topic modelling ####</span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert the corpus to a form that the topic model can work with</span></span>
<span id="cb4-3">rba_minutes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> quanteda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">corpus</span>(text) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Minimum viable conversion</span></span>
<span id="cb4-4">  quanteda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dfm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remove_punct =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remove =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopwords</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'en'</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get rid of</span></span>
<span id="cb4-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># punctuation (in case you didn't already do that) and stop words - check </span></span>
<span id="cb4-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># those stop words assumptions</span></span>
<span id="cb4-7">  quanteda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dfm_trim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_termfreq =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove any word that doesn't occur at </span></span>
<span id="cb4-8">                     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># least twice</span></span>
<span id="cb4-9">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_docfreq =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get rid of any word that isn't in at least two documents</span></span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the topic model with 10 topics</span></span>
<span id="cb4-12">dtm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> quanteda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">convert</span>(rba_minutes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topicmodels"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Getting the dfm </span></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># into a form that topicmodels can deal with</span></span>
<span id="cb4-14">lda_topics <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> topicmodels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LDA</span>(dtm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The k is the number of topics - </span></span>
<span id="cb4-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this decision has a big impact</span></span>
<span id="cb4-16"></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Have a look at the terms</span></span>
<span id="cb4-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terms</span>(lda_topics, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Top 10 words for each topic. Topics are just </span></span>
<span id="cb4-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># probability distributions over words so you should look at different numbers of words</span></span></code></pre></div>
</div>
<p>Looking at the words in the topics, it seems as though “per” and “cent” are being treated as separate words. The RBA is proud that it separates “per” and “cent”, and if you’re a grad there that’ll stick with you for a while (see earlier paragraphs), but for our purposes they are one word and we need to combine them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### Clean data ####</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Let's deal with the first issue first.</span></span>
<span id="cb5-3">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"per&nbsp;cent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"per_cent"</span>)</span>
<span id="cb5-4">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"per cent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"per_cent"</span>)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You could run the topic model again if you wanted.</span></span></code></pre></div>
</div>
<p>Right, that issue of per cent has been fixed, but what if there are combinations of words like this that don’t show up very high in the topics? To identify these we need to construct n-grams. Earlier with ‘per’ ‘cent’, we generated a 2-gram. Quanteda and the tidyverse makes it easy to identify popular n-grams (if your dataset is large then I’d work with a sample of it because these can get a little unwieldy, and we only really care about the popular ones anyway). Our text is in sentences, paragraphs, etc, and we first need to break it down into tokens (essentially separate words). There’s a wonderful set of tutorials put together by the quanteda team here: https://tutorials.quanteda.io and the code for this section is from: https://tutorials.quanteda.io/basic-operations/tokens/tokens_ngrams/.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### Adjusting for common co-location ####</span></span>
<span id="cb6-2">toks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tokens</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text)</span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First generate 2-grams</span></span>
<span id="cb6-4">ngrams <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tokens_ngrams</span>(toks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Somewhat annoyingly for our purposes (although understandably given the broader </span></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># picture) quanteda puts tokens into its own class, so we need ot convert in </span></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># order to use the usual tidyverse tools that we may be more familiar with.</span></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># As a side note, I often find it worthwhile to checking class in R when there's </span></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># an issue because often that's part of the issue, in this case: class(ngrams).</span></span>
<span id="cb6-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The tokens class seems to just be a list, so we can unlist it and then put it </span></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># into a more-friendly tibble.</span></span>
<span id="cb6-12">ngram_counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ngrams =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(ngrams)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(ngrams, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb6-14"></span>
<span id="cb6-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We can identify a bunch of obvious replacements. If we start getting a long </span></span>
<span id="cb6-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># list then we can create a file that holds the replacement.</span></span>
<span id="cb6-17">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"assistant governor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"assistant_governor"</span>)</span>
<span id="cb6-18">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reserve bank board"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reserve_bank_board"</span>)</span>
<span id="cb6-19">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unemployment rate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unemployment_rate"</span>)</span>
<span id="cb6-20">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"national accounts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"national_accounts"</span>)</span>
<span id="cb6-21">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"australian dollar"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"australian_dollar"</span>)</span>
<span id="cb6-22">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monetary policy"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monetary_policy"</span>)</span>
<span id="cb6-23">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"united states"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"united_states"</span>)</span>
<span id="cb6-24">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exchange rate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exchange_rate"</span>)</span>
<span id="cb6-25">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glenn stevens"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glenn_stevens"</span>)</span>
<span id="cb6-26">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reserve bank"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reserve_bank"</span>)</span>
<span id="cb6-27">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cash rate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cash_rate"</span>)</span>
<span id="cb6-28">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us dollar"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_dollar"</span>)</span>
<span id="cb6-29">text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"iron ore"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"iron_ore"</span>)</span>
<span id="cb6-30"></span>
<span id="cb6-31"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(toks, ngrams, ngram_counts)</span></code></pre></div>
</div>
<p>Take a look at the topics again. Notice that ‘growth’ is in essentially every topic. So is ‘members’ and a couple of others. It’s not that growth isn’t important (insert standard economist joke here), but the fact that ‘members’ shows up suggests that these may just be due to the way that language is used at the RBA, rather than communicating topics. If you read these minutes, you’ll know that the RBA starts a LOT of sentences with ‘Members noted…’. What does this mean for our purposes? Essentially, if you look at each topic by itself they seem ‘coherent’, but taken as a group it seems as though the topics are too similar. Another way to say that is that the words lack ‘exclusivity’. This is a common tradeoff, and our results suggest that it may be worthwhile for us to reduce some of the coherence in order to increase the exclusivity. At this point, we’ll use a different package for creating topic models - the STM package - because it has a bunch of nice features that you might like to take advantage of in future work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### Introducing STM and quanteda ####</span></span>
<span id="cb7-2">rba_minutes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> quanteda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">corpus</span>(text) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Minimum viable conversion</span></span>
<span id="cb7-3">  quanteda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dfm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remove_punct =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span id="cb7-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remove_numbers =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remove =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopwords</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'en'</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get rid of punctuation (in </span></span>
<span id="cb7-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># case you didn't already do that) and stop words - check those stop words assumptions</span></span>
<span id="cb7-7">  quanteda<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dfm_trim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_termfreq =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove any word that doesn't occur at least twice</span></span>
<span id="cb7-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_docfreq =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get rid of any word that isn't in at </span></span>
<span id="cb7-9">                     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># least 5 per cent of documents</span></span>
<span id="cb7-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_docfreq =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get rid of any word that is in at </span></span>
<span id="cb7-11">                     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># least 90 per cent of documents</span></span>
<span id="cb7-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">docfreq_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prop"</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Above we specified percentages - you </span></span>
<span id="cb7-13">                     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># could specify counts or ranks</span></span>
<span id="cb7-14">                     ) </span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We can run the topic model using STM</span></span>
<span id="cb7-17">topics_stm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stm</span>(rba_minutes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb7-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Looking at the results you can see that the results are fairly similar to </span></span>
<span id="cb7-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># those that we got from the topicmodels package, which is what we want. </span></span>
<span id="cb7-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labelTopics</span>(topics_stm)</span>
<span id="cb7-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(topics_stm)</span>
<span id="cb7-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If we were interested in the results then we might like to pre-process the text </span></span>
<span id="cb7-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a little more, for instance removing the names of months.</span></span></code></pre></div>
</div>
<p>Other than pre-processing decisions, the other major determininat of the outputs of topic models is the number of topics specified. There are a bunch of diagnostic tests that have been developed to help with this decision and we can use some nice code from Julia Silge (https://juliasilge.com/blog/evaluating-stm/) to try a bunch of different values for the number of topics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### Deciding on the number of topics ####</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tic</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"With parallel"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This allows us to time the code</span></span>
<span id="cb8-3">many_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data_frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here we're running four </span></span>
<span id="cb8-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># topic models: 5 topics, 10 topics, 15 topics and 20 topics</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">topic_model =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">future_map</span>(K, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stm</span>(rba_minutes, </span>
<span id="cb8-6">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> .,</span>
<span id="cb8-7">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)))</span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toc</span>()</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You can also try setting K to zero within STM and seeing the number of topics </span></span>
<span id="cb8-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># that it recommends: e,g, choose_topic_num_for_me &lt;- stm(rba_minutes, K = 0, verbose = FALSE)</span></span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We want to compare those models with different numbers of topics using various diagnostics.</span></span>
<span id="cb8-14">heldout <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">make.heldout</span>(rba_minutes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First create a test/training set</span></span>
<span id="cb8-15"></span>
<span id="cb8-16">k_result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> many_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">exclusivity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(topic_model, exclusivity), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># How unique are words to the topics</span></span>
<span id="cb8-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">semantic_coherence =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(topic_model, semanticCoherence, rba_minutes), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># How </span></span>
<span id="cb8-19">         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># much the topics tend to be coherent if we look at them (usually a </span></span>
<span id="cb8-20">         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tradeoff with exclusivity)</span></span>
<span id="cb8-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eval_heldout =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(topic_model, eval.heldout, heldout<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>missing),</span>
<span id="cb8-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">residual =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(topic_model, checkResiduals, rba_minutes),</span>
<span id="cb8-23">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bound =</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(topic_model, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>convergence<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>bound)),</span>
<span id="cb8-24">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lfact =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(topic_model, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lfactorial</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>settings<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>dim<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>K)),</span>
<span id="cb8-25">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lbound =</span> bound <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> lfact,</span>
<span id="cb8-26">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iterations =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(topic_model, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>convergence<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>bound)))</span></code></pre></div>
</div>
<p>Put these diagnostics into a nice summary graph (again code is Julia’s originally).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">k_result <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(K,</span>
<span id="cb9-3">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower bound</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> lbound,</span>
<span id="cb9-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Residuals =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(residual, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dispersion"</span>),</span>
<span id="cb9-5">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Semantic coherence</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(semantic_coherence, mean),</span>
<span id="cb9-6">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Held-out likelihood</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(eval_heldout, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expected.heldout"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(Metric, Value, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>K) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(K, Value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Metric)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Metric, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"K (number of topics)"</span>,</span>
<span id="cb9-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb9-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model diagnostics by number of topics"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2019-01-03-gathering-and-analysing-text-data/gathering-and-analysing-text-data_files/figure-html/diagnosticmeasuregraphs-1.png" class="quarto-discovered-preview-image img-fluid" width="672"></p>
</div>
</div>
<p>In general we are looking for the max/min of parabolas, so our results suggest we may be best with some more topics (go to Julia’s post for to see another example: https://juliasilge.com/blog/evaluating-stm/.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Have a look at that exclusivity to coherence tradeoff</span></span>
<span id="cb10-2">k_result <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(K, exclusivity, semantic_coherence) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(K)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(semantic_coherence, exclusivity)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(K)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Semantic coherence"</span>,</span>
<span id="cb10-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exclusivity"</span>,</span>
<span id="cb10-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comparing exclusivity and semantic coherence"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(exclusivity, semantic_coherence)`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2019-01-03-gathering-and-analysing-text-data/gathering-and-analysing-text-data_files/figure-html/exlusitivty-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Although you’d probably want more, let’s just choose 10 topics for now. What we’re most interested in is getting the betas and gammas so that we can do our usual analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">topic_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> k_result <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(K <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(topic_model) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-4">  .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grab the betas - these are the probability of each term in each topic</span></span>
<span id="cb12-7">td_beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(topic_model, </span>
<span id="cb12-8">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">matrix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>)</span>
<span id="cb12-9"></span>
<span id="cb12-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grab the gammas - these are the probability of each word in each topic</span></span>
<span id="cb12-11">td_gamma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(topic_model, </span>
<span id="cb12-12">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">matrix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>,</span>
<span id="cb12-13">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">document_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(rba_minutes))</span></code></pre></div>
</div>
<p>From here you could look at how the gammas and betas evolve or change using a statistical model. Or even sometimes just looking at them is interesting. Julia Silge has a bunch of code that makes very nice graphs and tables. One of the advantages of the STM package is that it makes it easier to include specific types of additional information. For instance, we know that over our time period there have been two governors: GRS and Phil Lowe. We could associate each date with who the governor is and then allow that to affect the prevalence of certain topics.</p>
<p>You can grab the files and folder set up from GitHub if you’d like.</p>


</section>

 ]]></description>
  <guid>https://rohanalexander.com/posts/2019-01-03-gathering-and-analysing-text-data/gathering-and-analysing-text-data.html</guid>
  <pubDate>Thu, 03 Jan 2019 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Cleaning Hansard: The pay’s not great but the work is hard</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2018-08-13-cleaning-hansard/cleaning-hansard.html</link>
  <description><![CDATA[ 



<p><em>Thanks to Monica for the title.</em></p>
<p>After getting an email along the lines of ‘hey aren’t you doing something with Australia’s Hansard?’ I realised that I’ve been a bit remiss about sharing my Australian Hansard progress. This is the first of a series of posts to fix that.</p>
<p></p>
<p>I haven’t written about what I’ve been doing with Australian Hansard to this point because: 1) my knowledge of the political science literature is piecemeal and I’m sure someone must have already done all this and I just can’t find it; and 2) my coding knowledge is also piecemeal and there’s no doubt a million ways to better do what I’ve done so far. If anyone has advice on either aspect (or anything really!) I’d be keen to hear it - please email.</p>
<p>Best I can tell, Australian Hansard is a treasure-trove of data and it’s hard to believe it hasn’t been more analysed. I’m probably missing a whole bunch of literature (insert standard joke about economists here) but so far I can really only find a handful of papers using Australia’s Hansard.<sup>1</sup> There’s plenty of work using the parliamentary records of other Commonwealth countries such as Canada<sup>2</sup>, NZ<sup>3</sup> and the UK<sup>4</sup>. I think that in Australia it’s really only Patrick Leslie who may be using it at the moment (big thank you to Jill Sheppard for pointing this out), but I’ll update this if I find others.</p>
<p>The good news is that Australia’s Hansard has been digitised and is available on the parliament’s website, so a figurative pseudo-Manhattan-project isn’t required (cf.&nbsp;what was needed in Canada, see: https://www.lipad.ca/). If you just want short, specific, sections then the situation is fine - for pre-1981 go to Tim Sherratt’s brilliant Historic Hansard website (http://historichansard.net); for 1981 to 2006 just use the parliament’s website; and for 2006 onward just use Open Australia. The bad news is that Hansard isn’t really available as a nice corpus for larger scale analysis. Making this nice corpus has been keeping me busy, and will be the subject of this series of posts.</p>
<p>Helpfully, various people/organisations have gone to the Hansard website to get the XML files they provide and made them available as an easy download (note that these tend to have been posted as they were provided by the parliament, so they’re full of typos, transcription errors, and a bunch of other mistakes):</p>
<ul>
<li>1901-1980 Hansard is available as XML from Tim Sherratt’s Historic Hansard Github - https://github.com/wragge/hansard-xml.</li>
<li>1998-2014 Hansard is available from Andrew Turpin’s website at University of Melbourne (https://people.eng.unimelb.edu.au/aturpin/qtCorpus/index.html).</li>
<li>2006-current is available from Open Australia’s website (http://data.openaustralia.org.au/origxml/).</li>
</ul>
<p>These helpful people/organisations were able to get those dates (1901-1980 and 1998-current) because the Hansard provides the XML for those years on their website. The problem is the 1980s and the early/mid 1990s because they don’t have the XML available on the website (and from emails with them - it seems as though they simply don’t have it) - the only choice seems to be either to scrape it manually from the Hansard website or to grab all the PDFs, convert them, and then fix the mistakes. I’ve started on the second option - unsure how wise it is but I don’t know of any alternative.</p>
<p>Future posts:</p>
<ul>
<li>Who has been elected to parliament?</li>
<li>What divisions are relevant?</li>
<li>What parties are relevant?</li>
<li>Hansard pre-1981</li>
<li>Hansard post-1980</li>
</ul>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>For instance: Turpin ‘An Attempt to Measure the Quality of Questions in Question Time of the Australian Federal Parliament’.↩︎</p></li>
<li id="fn2"><p>For instance: Beelen, Thijm, Cochrane, Halvemaan, Hirst, Kimmins, Lijbrink, Marx, Naderi, Rheault, Polyanovsky, Whyte ‘Digitization of the Canadian Parliamentary Debates’.↩︎</p></li>
<li id="fn3"><p>For instance: Curran, Higham, Ortiz, Vasques Filho ‘Look Who’s Talking: Bipartite Networks as Representations of a Topic Model of New Zealand Parliamentary Speeches’.↩︎</p></li>
<li id="fn4"><p>For instance: Abercrombie, Batista-Navarro ‘Aye or No? Speech-level Sentiment Analysis of Hansard UK Parliamentary Debate Transcripts’↩︎</p></li>
</ol>
</section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2018-08-13-cleaning-hansard/cleaning-hansard.html</guid>
  <pubDate>Mon, 13 Aug 2018 04:00:00 GMT</pubDate>
</item>
<item>
  <title>The SQL Is Never As Good As The Original</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2018-07-28-the-sql-is-never-as-good-as-the-original/the-sql-is-never-as-good-as-the-original.html</link>
  <description><![CDATA[ 



<p><em>Thanks to Monica for the title.</em></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>SQL is a popular way of working with data. Advanced users probably do a lot with it alone, but even just having a working knowledge of SQL has increased the number of datasets that I can get data from to then analyse with other tools such as R or Python. You can use SQL within RStudio if you want. The following are a few notes to help future-Rohan when he needs to use SQL. A worked example with a sample of the Hansard data will be included in a future post.</p>
<p><img src="https://rohanalexander.com/posts/2018-07-28-the-sql-is-never-as-good-as-the-original/https:/imgs.xkcd.com/comics/query.png" class="quarto-discovered-preview-image img-fluid"></p>
<p>SQL is fairly straightforward if you’ve used mutate, filter and join in the R tidyverse as the concepts (and sometimes even the verb) are the same. In that case, half the battle is getting used to the terminology, and the other half is getting on top of the order of operations because SQL can be a tad pedantic.</p>
<p>SQL (“see-quell” or “S.Q.L.” - both camps seem fairly insistent on their way…) is used with relational databases. A relational database is just a collection of at least one table, and a table is just some data organized into rows and columns. If there’s more than one table in the database, then there should be some column that links them. Using it feels a bit like HTML/CSS in terms of being halfway between markup and programming. One fun aspect is that line spaces mean nothing: include them or don’t, but always end a SQL command in a semicolon;</p>
</section>
<section id="creating-a-table" class="level1">
<h1>Creating a table</h1>
<p>Create an empty table of three columns of type: int, text, int:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">TABLE</span> table_name (</span>
<span id="cb1-2">  column1 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">INTEGER</span>,</span>
<span id="cb1-3">  column2 TEXT,</span>
<span id="cb1-4">  column3 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">INTEGER</span></span>
<span id="cb1-5">);</span></code></pre></div>
</div>
<p>Add a row of data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">INSERT</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">INTO</span> table_name (column1, column2, column3)</span>
<span id="cb2-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">VALUES</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1234</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gough Menzies'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>);</span></code></pre></div>
</div>
<p>Add a column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ALTER</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">TABLE</span> table_name</span>
<span id="cb3-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ADD</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COLUMN</span> column4 TEXT;</span></code></pre></div>
</div>
</section>
<section id="viewing-the-data" class="level1">
<h1>Viewing the data</h1>
<p>See one column (similar to R’s select):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> column2</span>
<span id="cb4-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>See two columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> column1, column2</span>
<span id="cb5-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>See all columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb6-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>See unique rows in a column (similar to R’s distinct):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">DISTINCT</span> column2</span>
<span id="cb7-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>See the rows that match a criteria (similar idea to R’s which or filter):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb8-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb8-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>;</span></code></pre></div>
</div>
<p>All the usual operators are fine with WHERE: =, !=, &gt;, &lt;, &gt;=, &lt;=. Just make sure the condition evaluates to true/false.</p>
<p>See the rows that are pretty close to a criteria:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb9-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb9-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column2 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">LIKE</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_ough Menzies'</span>;</span></code></pre></div>
</div>
<p>The _ above is a wildcard that matches to any character e.g.&nbsp;‘Cough Menzies’ would be matched here, as would ‘Gough Menzies’. LIKE is not case-sensitive: ‘Gough Menzies’ and ‘gough menzies’ would both match here.</p>
<p>Use % as an anchor to matches pieces:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb10-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb10-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column2 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">LIKE</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%Menzies'</span>;</span></code></pre></div>
</div>
<p>That matches anything ending with ‘Menzies’, so ‘Cough Menzies’, ‘Gough Menzies’, ‘Sir Menzies’ etc, would all be matched here. Use surrounding percentages to match within, e.g.&nbsp;%Menzies% would also match ‘Sir Menzies Jr’ whereas %Menzies would not.</p>
<p>This is wild: NULL values (!) (True/False/NULL) are possible, not just True/False, but they need to be explicitly matched for:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb11-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb11-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column2 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">IS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NULL</span>;</span></code></pre></div>
</div>
<p>This too is wild: There’s an underlying ordering build into number, date and text fields that allows you to use BETWEEN on all those, not just numeric! The following looks for text that starts with a letter between A and M (not including M) so would match ‘Gough Menzies’, but not ‘Sir Gough Menzies’!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb12-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb12-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column2 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'M'</span>;</span></code></pre></div>
</div>
<p>If you look for a numeric (as opposed to text) then BETWEEN is inclusive.</p>
<p>Combine conditions with AND (both must be true to be returned) or OR (at least one must be true):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb13-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb13-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column2 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'M'</span></span>
<span id="cb13-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> column3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>;</span></code></pre></div>
</div>
<p>You can order the result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb14-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb14-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ORDER</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> column3;</span></code></pre></div>
</div>
<p>Ascending is the default, add DESC for alternative:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb15-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb15-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ORDER</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> column3 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">DESC</span>;</span></code></pre></div>
</div>
<p>Restrict the return to a certain number of values by adding LIMIT at the end:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb16-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb16-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ORDER</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> column3 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">DESC</span></span>
<span id="cb16-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">LIMIT</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>;</span></code></pre></div>
</div>
<p>(This doesn’t work all the time - only certain SQL databases.)</p>
</section>
<section id="modifying-data-and-using-logic" class="level1">
<h1>Modifying data and using logic</h1>
<p>Edit a value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UPDATE</span> table_name</span>
<span id="cb17-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SET</span> column3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span></span>
<span id="cb17-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1234</span>;</span></code></pre></div>
</div>
<p>Implement if/else logic:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>,</span>
<span id="cb18-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">CASE</span></span>
<span id="cb18-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> column2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gough Whitlam'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Labor'</span></span>
<span id="cb18-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHEN</span> column2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Robert Menzies'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">THEN</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Liberal'</span></span>
<span id="cb18-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">ELSE</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Who knows'</span></span>
<span id="cb18-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">END</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Party'</span></span>
<span id="cb18-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>This returns a column called ‘Party’ that looks at the name of the person to return a party.</p>
<p>Delete some rows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">DELETE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb19-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> column3 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">IS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NULL</span>;</span></code></pre></div>
</div>
<p>Add an alias to a column name (this just shows in the output):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> column2 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Names'</span></span>
<span id="cb20-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
</section>
<section id="summarising-data" class="level1">
<h1>Summarising data</h1>
<p>We can use COUNT, SUM, MAX, MIN, AVG and ROUND in the place of summarise in R. COUNT counts the number of rows that are not empty for some column by passing the column name, or for all using *:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COUNT</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>)</span>
<span id="cb21-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>Similarly, pass a column to SUM, MAX, MIN, and AVG:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SUM</span>(column1)</span>
<span id="cb22-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>ROUND takes a column and an integer to specify how many decimal places:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ROUND</span>(column1, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb23-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name;</span></code></pre></div>
</div>
<p>SELECT and GROUP BY is similar to group_by in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> column3, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COUNT</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>)</span>
<span id="cb24-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table_name</span>
<span id="cb24-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">GROUP</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> column3;</span></code></pre></div>
</div>
<p>You can GROUP BY column number instead of name e.g.&nbsp;1 instead of column3 in the GROUP BY line or 2 instead of COUNT(*) if that was of interest.</p>
<p>HAVING for aggregates, is similar to filter in R or the WHERE for rows from earlier. Use it after GROUP BY and before ORDER BY and LIMIT.</p>
</section>
<section id="combining-data" class="level1">
<h1>Combining data</h1>
<p>Combine two tables using JOIN or LEFT JOIN:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb25-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> table1_name</span>
<span id="cb25-3">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">JOIN</span> table2_name</span>
<span id="cb25-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ON</span> table1_name.colum1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> table2_name.column1;</span></code></pre></div>
</div>
<p>Be careful to specify the matching columns using dot notation. Primary key columns uniquely identify rows and are: 1) never NULL; 2) unique; 3) only one column per table. A primary key can be primary in one table and foreign in another. Unique columns have a different value for every row and there can be many in one table.</p>
<p>UNION is the equivalent of cbind if the tables are already fairly similar.</p>


</section>

 ]]></description>
  <guid>https://rohanalexander.com/posts/2018-07-28-the-sql-is-never-as-good-as-the-original/the-sql-is-never-as-good-as-the-original.html</guid>
  <pubDate>Sat, 28 Jul 2018 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Topic Modelling - Theory</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2018-06-29-getting_started_with_topic_modelling-theory/topic_modelling-theory.html</link>
  <description><![CDATA[ 



<p><em>These are notes that I put together in the process of trying to understand how topic modelling works with a view to applying it to Australia’s Hansard. There are undoubtedly mistakes and aspects that are unclear. Please get in touch if you have any suggestions.</em></p>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>Each statement in Hansard needs to be classified by its topic. Sometimes Hansard includes titles that make the topic clear. But not every statement has a title and the titles do not always define topics in a well-defined and consistent way. One way to get consistent estimates of the topics of each statement in Hansard is to use the latent Dirichlet allocation (LDA) method of <span class="citation" data-cites="Blei2003latent">Blei, Ng, and Jordan (2003)</span>, as implemented by the R package ‘topicmodels’ by <span class="citation" data-cites="Grun2011">Grün and Hornik (2011)</span>.</p>
<p>The key assumption behind the LDA method is that each statement, ‘a document’, in Hansard is made by a speaker who decides the topics they would like to talk about in that document, and then chooses words, ‘terms’, that are appropriate to those topics. A topic could be thought of as a collection of terms, and a document as a collection of topics. The topics are not specified <em>ex ante</em>; they are an outcome of the method. Terms are not necessarily unique to a particular topic, and a document could be about more than one topic. This provides more flexibility than other approaches such as a strict word count method. The goal is to have the words found in Hansard group themselves to define topics.</p>
</section>
<section id="document-generation-process" class="level1">
<h1>Document generation process</h1>
<p>As applied to Hansard, the LDA method considers each statement to be a result of a process where a politician first chooses the topics they want to speak about. After choosing the topics, the speaker then chooses appropriate words to use for each of those topics.</p>
<p>More generally, the LDA topic model works by considering each document as having been generated by some probability distribution over topics. For instance, if there were five topics and two documents, then the first document may be comprised mostly of the first few topics; the other document may be mostly about the final few topics (Figure @ref(fig:topicsoverdocuments)).</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2018-06-29-getting_started_with_topic_modelling-theory/topic_modelling-theory_files/figure-html/topicsoverdocuments-1.png" class="quarto-discovered-preview-image img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Probability distributions over topics</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2018-06-29-getting_started_with_topic_modelling-theory/topic_modelling-theory_files/figure-html/topicsoverdocuments-2.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Probability distributions over topics</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Similarly, each topic could be considered a probability distribution over terms. To choose the terms used in each document the speaker picks terms from each topic in the appropriate proportion. For instance, if there were ten terms, then one topic could be defined by giving more weight to terms related to immigration; and some other topic may give more weight to terms related to the economy (Figure @ref(fig:topicsoverterms)).</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2018-06-29-getting_started_with_topic_modelling-theory/topic_modelling-theory_files/figure-html/topicsoverterms-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Probability distributions over terms</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2018-06-29-getting_started_with_topic_modelling-theory/topic_modelling-theory_files/figure-html/topicsoverterms-2.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Probability distributions over terms</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Following <span class="citation" data-cites="BleiLafferty2009">Blei and Lafferty (2009)</span>, <span class="citation" data-cites="blei2012">Blei (2012)</span> and <span class="citation" data-cites="GriffithsSteyvers2004">Griffiths and Steyvers (2004)</span>, the process by which a document is generated is more formally considered to be:</p>
<ol type="1">
<li>There are <img src="https://latex.codecogs.com/png.latex?1,%202,%20%5Cdots,%20k,%20%5Cdots,%20K"> topics and the vocabulary consists of <img src="https://latex.codecogs.com/png.latex?1,%202,%20%5Cdots,%20V"> terms. For each topic, decide the terms that the topic uses by randomly drawing distributions over the terms. The distribution over the terms for the <img src="https://latex.codecogs.com/png.latex?k">th topic is <img src="https://latex.codecogs.com/png.latex?%5Cbeta_k">. Typically a topic would be a small number of terms and so the Dirichlet distribution with hyperparameter <img src="https://latex.codecogs.com/png.latex?0%3C%5Ceta%3C1"> is used: <img src="https://latex.codecogs.com/png.latex?%5Cbeta_k%20%5Csim%20%5Cmbox%7BDirichlet%7D(%5Ceta)">.<sup>1</sup> Strictly, <img src="https://latex.codecogs.com/png.latex?%5Ceta"> is actually a vector of hyperparameters, one for each <img src="https://latex.codecogs.com/png.latex?K">, but in practice they all tend to be the same value.</li>
<li>Decide the topics that each document will cover by randomly drawing distributions over the <img src="https://latex.codecogs.com/png.latex?K"> topics for each of the <img src="https://latex.codecogs.com/png.latex?1,%202,%20%5Cdots,%20d,%20%5Cdots,%20D"> documents. The topic distributions for the <img src="https://latex.codecogs.com/png.latex?d">th document are <img src="https://latex.codecogs.com/png.latex?%5Ctheta_d">, and <img src="https://latex.codecogs.com/png.latex?%5Ctheta_%7Bd,k%7D"> is the topic distribution for topic <img src="https://latex.codecogs.com/png.latex?k"> in document <img src="https://latex.codecogs.com/png.latex?d">. Again, the Dirichlet distribution with the hyperparameter <img src="https://latex.codecogs.com/png.latex?0%3C%5Calpha%3C1"> is used here because usually a document would only cover a handful of topics: <img src="https://latex.codecogs.com/png.latex?%5Ctheta_d%20%5Csim%20%5Cmbox%7BDirichlet%7D(%5Calpha)">. Again, strictly <img src="https://latex.codecogs.com/png.latex?%5Calpha"> is vector of length <img src="https://latex.codecogs.com/png.latex?K"> of hyperparameters, but in practice each is usually the same value.</li>
<li>If there are <img src="https://latex.codecogs.com/png.latex?1,%202,%20%5Cdots,%20n,%20%5Cdots,%20N"> terms in the <img src="https://latex.codecogs.com/png.latex?d">th document, then to choose the <img src="https://latex.codecogs.com/png.latex?n">th term, <img src="https://latex.codecogs.com/png.latex?w_%7Bd,%20n%7D">:
<ol type="a">
<li>Randomly choose a topic for that term <img src="https://latex.codecogs.com/png.latex?n">, in that document <img src="https://latex.codecogs.com/png.latex?d">, <img src="https://latex.codecogs.com/png.latex?z_%7Bd,n%7D">, from the multinomial distribution over topics in that document, <img src="https://latex.codecogs.com/png.latex?z_%7Bd,n%7D%20%5Csim%20%5Cmbox%7BMultinomial%7D(%5Ctheta_d)">.</li>
<li>Randomly choose a term from the relevant multinomial distribution over the terms for that topic, <img src="https://latex.codecogs.com/png.latex?w_%7Bd,n%7D%20%5Csim%20%5Cmbox%7BMultinomial%7D(%5Cbeta_%7Bz_%7Bd,n%7D%7D)">.</li>
</ol></li>
</ol>
<p>Given this set-up, the joint distribution for the variables is (<span class="citation" data-cites="blei2012">Blei (2012)</span>, p.6): <img src="https://latex.codecogs.com/png.latex?p(%5Cbeta_%7B1:K%7D,%20%5Ctheta_%7B1:D%7D,%20z_%7B1:D,%201:N%7D,%20w_%7B1:D,%201:N%7D)%20=%20%5Cprod%5E%7BK%7D_%7Bi=1%7Dp(%5Cbeta_i)%20%5Cprod%5E%7BD%7D_%7Bd=1%7Dp(%5Ctheta_d)%20%5Cleft(%5Cprod%5EN_%7Bn=1%7Dp(z_%7Bd,n%7D%7C%5Ctheta_d)p%5Cleft(w_%7Bd,n%7D%7C%5Cbeta_%7B1:K%7D,z_%7Bd,n%7D%5Cright)%20%5Cright)."></p>
<p>Based on this document generation process the analysis problem, discussed in the next section, is to compute a posterior over <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1:K%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Ctheta_%7B1:D%7D">, given <img src="https://latex.codecogs.com/png.latex?w_%7B1:D,%201:N%7D">. This is intractable directly, but can be approximated (<span class="citation" data-cites="GriffithsSteyvers2004">Griffiths and Steyvers (2004)</span> and <span class="citation" data-cites="blei2012">Blei (2012)</span>).</p>
</section>
<section id="analysis-process" class="level1">
<h1>Analysis process</h1>
<p>After the documents are created, they are all that we have to analyse. The term usage in each document, <img src="https://latex.codecogs.com/png.latex?w_%7B1:D,%201:N%7D">, is observed, but the topics are hidden, or ‘latent’. We do not know the topics of each document, nor how terms defined the topics. That is, we do not know the probability distributions of Figures @ref(fig:topicsoverdocuments) or @ref(fig:topicsoverterms). In a sense we are trying to reverse the document generation process – we have the terms and we would like to discover the topics.</p>
<p>If the earlier process around how the documents were generated is assumed and we observe the terms in each document, then we can obtain estimates of the topics (<span class="citation" data-cites="SteyversGriffiths2006">Steyvers and Griffiths (2006)</span>). The outcomes of the LDA process are probability distributions and these define the topics. Each term will be given a probability of being a member of a particular topic, and each document will be given a probability of being about a particular topic. That is, we are trying to calculate the posterior distribution of the topics given the terms observed in each document (<span class="citation" data-cites="blei2012">Blei (2012)</span>, p.7): <img src="https://latex.codecogs.com/png.latex?p(%5Cbeta_%7B1:K%7D,%20%5Ctheta_%7B1:D%7D,%20z_%7B1:D,%201:N%7D%20%7C%20w_%7B1:D,%201:N%7D)%20=%20%5Cfrac%7Bp%5Cleft(%5Cbeta_%7B1:K%7D,%20%5Ctheta_%7B1:D%7D,%20z_%7B1:D,%201:N%7D,%20w_%7B1:D,%201:N%7D%5Cright)%7D%7Bp(w_%7B1:D,%201:N%7D)%7D."></p>
<p>The initial practical step when implementing LDA given a corpus of documents is to remove ‘stop words’. These are words that are common, but that don’t typically help to define topics. There is a general list of stop words such as: “a”; “a’s”; “able”; “about”; “above”… An additional list of words that are commonly found in Hansard, but likely don’t help define topics is added to the general list. These additions include words such as: “act”; “amendment”; “amount”; “australia”; “australian”; “bill”… A full list will be available in a follow up post going through an example with R code. We also remove punctuation and capitalisation. The documents need to then be transformed into a document-term-matrix. This is essentially a table with a column of the number of times each term appears in each document.</p>
<p>After the dataset is ready, the R package ‘topicmodels’ by <span class="citation" data-cites="Grun2011">Grün and Hornik (2011)</span> can be used to implement LDA and approximate the posterior. It does this using Gibbs sampling or the variational expectation-maximization algorithm. Following <span class="citation" data-cites="SteyversGriffiths2006">Steyvers and Griffiths (2006)</span> and <span class="citation" data-cites="Darling2011">Darling (2011)</span>, the Gibbs sampling process attempts to find a topic for a particular term in a particular document, given the topics of all other terms for all other documents. Broadly, it does this by first assigning every term in every document to a random topic, specified by Dirichlet priors with <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%20%5Cfrac%7B50%7D%7BK%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Ceta%20=%200.1"> (<span class="citation" data-cites="SteyversGriffiths2006">Steyvers and Griffiths (2006)</span> recommends <img src="https://latex.codecogs.com/png.latex?%5Ceta%20=%200.01">), where <img src="https://latex.codecogs.com/png.latex?%5Calpha"> refers to the distribution over topics and <img src="https://latex.codecogs.com/png.latex?%5Ceta"> refers to the distribution over terms (<span class="citation" data-cites="Grun2011">Grün and Hornik (2011)</span>, p.7). It then selects a particular term in a particular document and assigns it to a new topic based on the conditional distribution where the topics for all other terms in all documents are taken as given (<span class="citation" data-cites="Grun2011">Grün and Hornik (2011)</span>, p.6): <img src="https://latex.codecogs.com/png.latex?p(z_%7Bd,%20n%7D=k%20%7C%20w_%7B1:D,%201:N%7D,%20z'_%7Bd,%20n%7D)%20%5Cpropto%20%5Cfrac%7B%5Clambda'_%7Bn%5Crightarrow%20k%7D+%5Ceta%7D%7B%5Clambda'_%7B.%5Crightarrow%20k%7D+V%5Ceta%7D%20%5Cfrac%7B%5Clambda'%5E%7B(d)%7D_%7Bn%5Crightarrow%20k%7D+%5Calpha%7D%7B%5Clambda'%5E%7B(d)%7D_%7B-i%7D+K%5Calpha%7D%20"> where <img src="https://latex.codecogs.com/png.latex?z'_%7Bd,%20n%7D"> refers to all other topic assignments; <img src="https://latex.codecogs.com/png.latex?%5Clambda'_%7Bn%5Crightarrow%20k%7D"> is a count of how many other times that term has been assigned to topic <img src="https://latex.codecogs.com/png.latex?k">; <img src="https://latex.codecogs.com/png.latex?%5Clambda'_%7B.%5Crightarrow%20k%7D"> is a count of how many other times that any term has been assigned to topic <img src="https://latex.codecogs.com/png.latex?k">; <img src="https://latex.codecogs.com/png.latex?%5Clambda'%5E%7B(d)%7D_%7Bn%5Crightarrow%20k%7D"> is a count of how many other times that term has been assigned to topic <img src="https://latex.codecogs.com/png.latex?k"> in that particular document; and <img src="https://latex.codecogs.com/png.latex?%5Clambda'%5E%7B(d)%7D_%7B-i%7D"> is a count of how many other times that term has been assigned in that document. Once <img src="https://latex.codecogs.com/png.latex?z_%7Bd,n%7D"> has been estimated, then estimates for the distribution of words into topics and topics into documents can be backed out.</p>
<p>This conditional distribution assigns topics depending on how often a term has been assigned to that topic previously, and how common the topic is in that document (<span class="citation" data-cites="SteyversGriffiths2006">Steyvers and Griffiths (2006)</span>). The initial random allocation of topics means that the results of early passes through the corpus of document are poor, but given enough time the algorithm converges to an appropriate estimate.</p>
</section>
<section id="warnings-and-extensions" class="level1">
<h1>Warnings and extensions</h1>
<p>The choice of the number of topics, <em>k</em>, affects the results, and must be specified <em>a priori</em>. If there is a strong reason for a particular number, then this can be used. Otherwise, one way to choose an appropriate number is to use a test and training set process. Essentially, this means running the process on a variety of possible values for <em>k</em> and then picking an appropriate value that performs well.</p>
<p>One weakness of the LDA method is that it considers a ‘bag of words’ where the order of those words does not matter (<span class="citation" data-cites="blei2012">Blei (2012)</span>). It is possible to extend the model to reduce the impact of the bag-of-words assumption and add conditionality to word order. Additionally, alternatives to the Dirichlet distribution can be used to extend the model to allow for correlation. For instance, in Hansard topics related the army may be expected to be more commonly found with topics related to the navy, but less commonly with topics related to banking.</p>
</section>
<section id="references" class="level1">




</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-blei2012" class="csl-entry">
Blei, David M. 2012. <span>“Probabilistic Topic Models.”</span> <em>Communications of the ACM</em> 55 (4): 77–84.
</div>
<div id="ref-BleiLafferty2009" class="csl-entry">
Blei, David M, and John D Lafferty. 2009. <span>“Topic Models.”</span> In <em>Text Mining</em>, 101–24. Chapman; Hall/CRC.
</div>
<div id="ref-Blei2003latent" class="csl-entry">
Blei, David M, Andrew Y Ng, and Michael I Jordan. 2003. <span>“Latent Dirichlet Allocation.”</span> <em>Journal of Machine Learning Research</em> 3 (Jan): 993–1022.
</div>
<div id="ref-Darling2011" class="csl-entry">
Darling, William M. 2011. <span>“A Theoretical and Practical Implementation Tutorial on Topic Modeling and Gibbs Sampling.”</span> In <em>Proceedings of the 49th Annual Meeting of the Association for Computational Linguistics: Human Language Technologies</em>, 642–47.
</div>
<div id="ref-GriffithsSteyvers2004" class="csl-entry">
Griffiths, Thomas, and Mark Steyvers. 2004. <span>“Finding Scientific Topics.”</span> <em>PNAS</em> 101: 5228–35.
</div>
<div id="ref-Grun2011" class="csl-entry">
Grün, Bettina, and Kurt Hornik. 2011. <span>“<span class="nocase">topicmodels</span>: An <span>R</span> Package for Fitting Topic Models.”</span> <em>Journal of Statistical Software</em> 40 (13): 1–30. <a href="https://doi.org/10.18637/jss.v040.i13">https://doi.org/10.18637/jss.v040.i13</a>.
</div>
<div id="ref-SteyversGriffiths2006" class="csl-entry">
Steyvers, Mark, and Tom Griffiths. 2006. <span>“Probabilistic Topic Models.”</span> In <em>Latent Semantic Analysis: A Road to Meaning</em>, edited by T. Landauer, D McNamara, S. Dennis, and W. Kintsch.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The Dirichlet distribution is a variation of the beta distribution that is commonly used as a prior for categorical and multinomial variables. If there are just two categories, then the Dirichlet and the beta distributions are the same. In the special case of a symmetric Dirichlet distribution, <img src="https://latex.codecogs.com/png.latex?%5Ceta=1">, it is equivalent to a uniform distribution. If <img src="https://latex.codecogs.com/png.latex?%5Ceta%3C1">, then the distribution is sparse and concentrated on a smaller number of the values, and this number decreases as <img src="https://latex.codecogs.com/png.latex?%5Ceta"> decreases. A hyperparameter is a parameter of a prior distribution.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <guid>https://rohanalexander.com/posts/2018-06-29-getting_started_with_topic_modelling-theory/topic_modelling-theory.html</guid>
  <pubDate>Fri, 29 Jun 2018 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Getting started with LaTeX</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2017-09-14-getting-started-with-latex/getting-started-with-latex.html</link>
  <description><![CDATA[ 



<p><em>Thank you to Janet Bradly and Maria Racionero for their support of this workshop. These notes are based on ones prepared by Zac Cranko and I for a presentation in 2015 and those that I put together for a 2016 presentation. Zac’s work is used with permission.</em></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>LaTeX makes it easier to produce papers that look great, but it can be overwhelming at the start. These notes help you get up-and-running with LaTeX.</p>
<p>By the end you will have created an example paper and slides that include a title, author, affiliation, abstract, sections, tables, figures and references that looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">include_graphics</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/LaTeX_first_example.png"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2017-09-14-getting-started-with-latex/images/LaTeX_first_example.png" class="quarto-discovered-preview-image img-fluid" width="507"></p>
</div>
</div>
<p>It is best to type everything out yourself, but you can download the tex file from here: https://github.com/RohanAlexander/blogdown_website/blob/master/static/img/paper.tex</p>
</section>
<section id="writing-papers" class="level1">
<h1>Writing papers</h1>
<section id="hello-world" class="level2">
<h2 class="anchored" data-anchor-id="hello-world">Hello world!</h2>
<p>You can treat LaTeX as a markup language. You mark your text with commands depending on how you want it to look, and then compile it to produce an output such as a PDF. Get started by downloading LaTeX, for free, from: https://www.latex-project.org/get/.</p>
<p>Use the default settings. You will likely end up installing a bunch of programs. (There is now a smaller version of MacTeX available, but for now it is probably best to stick with the original version for now.)</p>
<p>Let’s make a document. Open ‘TeXShop’ if you’re using a Mac, and ‘TeXStudio’ if you’re using a PC.</p>
<p>In TeXShop/TeXStudio type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb2-1">\documentclass{article}</span>
<span id="cb2-2">\begin{document}</span>
<span id="cb2-3">Hello world!</span>
<span id="cb2-4">\end{document}</span></code></pre></div>
</div>
<p>Then click ‘Typeset’. A bunch of miscellaneous files are produced in the process of compiling. Don’t worry about these – all they do is make your directory ugly. The two important files are the tex file, which contains your markup, and the pdf file, which contains your output.</p>
<p>Square brackets are optional in LaTeX, but it is worth specifying the paper size and the font for the <tt>documentclass</tt> command. If you wanted to specify A4 paper and 12pt text by default then our ‘Hello world!’ becomes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb3-1">\documentclass<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[a4paper, 12pt]</span>{article}</span>
<span id="cb3-2">\begin{document}</span>
<span id="cb3-3">Hello world!</span>
<span id="cb3-4">\end{document}</span></code></pre></div>
</div>
<p>The type of document that you want goes in the braces. We used ‘article’, which is good for producing papers. There are many classes of document, including ‘book’, ‘letter’, and ‘beamer’ which is for presentations, but ‘article’ is probably the one that you will most commonly use.</p>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>Packages expand the basics of LaTeX. There are a few that you should load every time because they’re often used when writing economics papers:</p>
<ul>
<li>amsmath;</li>
<li>amsthm;</li>
<li>amssymb; and</li>
<li>graphicx.</li>
</ul>
<p>Load these packages by adding the following after <tt>documentclass[a4paper, 12pt]{article}</tt>, but before <tt>begin document</tt>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb4-1">\usepackage{amsmath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amsthm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amssymb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> graphicx}</span></code></pre></div>
</div>
<p>Then click ‘Typeset’. Nothing should change in the output, we are just typesetting it to make sure that we have not introduced an error. The first three packages help when writing maths. The fourth helps with including graphs.</p>
<p>Everything before <tt>begin document</tt> is called the preamble, and everything after it is called the content.</p>
</section>
<section id="title-author-and-affiliation" class="level2">
<h2 class="anchored" data-anchor-id="title-author-and-affiliation">Title, author, and affiliation</h2>
<p>You can add a title, author and affiliation to your paper by adding the following to the content:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">\title{An Introduction To \LaTeX}</span>
<span id="cb5-2">\author{Rohan Alexander}</span>
<span id="cb5-3">\date{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span> September <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span>}</span>
<span id="cb5-4">\maketitle</span></code></pre></div>
</div>
<p>Click ‘Typeset’ and a title should be added to your paper.</p>
<p>Add an affiliation by changing the <tt>author</tt> markup to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">\author{Rohan Alexander\\</span>
<span id="cb6-2">\textit{Australian National University}}</span></code></pre></div>
</div>
<p>The <tt>textit</tt> command makes the text italic. You don’t need to make the affiliation italic, but many people seem to. You could make your text bold using <tt>textbf</tt>.</p>
<p>Finally, add an acknowledgements section by changing the <tt>author</tt> markup to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb7-1">\author{Rohan Alexander\thanks{Thank you to my primary supervisor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> John Tang<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> All correspondence to rohan<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.alexander</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">@anu</span>.edu.au.}\\</span>
<span id="cb7-2">\textit{Australian National University}}</span></code></pre></div>
</div>
<p>If you don’t include <tt>date{A specific date}</tt> then LaTeX will add today’s date. If you don’t want the date then add <tt>date{}</tt> instead.</p>
</section>
<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>If you want an abstract, then LaTeX will do the formatting for you if you use the abstract tags. Add this markup just below <tt>maketitle</tt>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb8-1">\begin{abstract}</span>
<span id="cb8-2">The point of this document is to introduce you to \LaTeX<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> There are many examples that you can grab and use in your own work<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb8-3">\end{abstract}</span></code></pre></div>
</div>
<p>To summarise what your tex file should look like to this point:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb9-1">\documentclass<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[a4paper, 12pt]</span>{article}</span>
<span id="cb9-2"></span>
<span id="cb9-3">\usepackage{amsmath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amsthm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amssymb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> graphicx}</span>
<span id="cb9-4"></span>
<span id="cb9-5">\begin{document}</span>
<span id="cb9-6"></span>
<span id="cb9-7">\title{An Introduction To \LaTeX}</span>
<span id="cb9-8">\author{Rohan Alexander\thanks{Thank you to my primary supervisor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> John Tang<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> All correspondence to rohan<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.alexander</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">@anu</span>.edu.au.}\\</span>
<span id="cb9-9">\textit{Australian National University}}</span>
<span id="cb9-10">\date{14 September<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> 2017}</span>
<span id="cb9-11">\maketitle</span>
<span id="cb9-12"></span>
<span id="cb9-13">\begin{abstract}</span>
<span id="cb9-14">The point of this document is to introduce you to \LaTeX<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> There are many examples that you can grab and use in your own work<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb9-15">\end{abstract}</span>
<span id="cb9-16"></span>
<span id="cb9-17">\end{document}</span></code></pre></div>
</div>
</section>
<section id="sections" class="level2">
<h2 class="anchored" data-anchor-id="sections">Sections</h2>
<p>The main section commands are: <tt>section</tt>, <tt>subsection</tt>, and <tt>subsubsection</tt>. These produce headings of decreasing importance and are numbered automatically. That can be turned off using an asterisk, for instance: <tt>section*</tt>.</p>
<p>For now let’s add numbered introduction, model, and data sections to our document by adding the following markup after the abstract:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb10-1">\section{Introduction}</span>
<span id="cb10-2">\section{Model}</span>
<span id="cb10-3">\section{Data}</span></code></pre></div>
</div>
</section>
<section id="maths" class="level2">
<h2 class="anchored" data-anchor-id="maths">Maths</h2>
<p>Now let’s add some maths into the model section of our paper. Type the following under the model section:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb11-1">Using $\alpha$ to indicate the outcome of interest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> the estimate becomes <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-2">$$ \hat{\alpha} = \frac{\sum^J_{j=1}\beta_j}{\int^{\infty}_{0}f(k)} $$</span></code></pre></div>
</div>
<p>When you compile your tex file you should get this equation:</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%5Chat%7B%5Calpha%7D%20=%20%5Cfrac%7B%5Csum%5EJ_%7Bj=1%7D%5Cbeta_j%7D%7B%5Cint%5E%7B%5Cinfty%7D_%7B0%7Df(k)%7D%20"></p>
<p>We will now go through the pieces of this.</p>
<section id="greek-limits-infinity-and-integrals" class="level3">
<h3 class="anchored" data-anchor-id="greek-limits-infinity-and-integrals">Greek, limits, infinity, and integrals</h3>
<p>We invoked ‘maths mode’ by using double dollar signs. That put the maths that you write on its own line. If you wanted to have your maths content without breaking the line, such as <img src="https://latex.codecogs.com/png.latex?x%20=%205">, then just use single dollar signs.</p>
<p>Within maths mode you can get many greek letters by backslash followed by their name. The examples above were <tt>alpha</tt> and <tt>beta</tt>.</p>
<p>Limits, infinity and integrals are built into LaTeX math mode, and can be access with the command <tt>lim</tt>, <tt>infty</tt>, and <tt>int</tt>. You can use accents and underbars if you need to denote what the limit refers to or upper and lower bounds. For instance, add the following markup underneath the formula:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb12-1">And when $\lim_{k\rightarrow0}f(k)/k = \infty$ it is the case that $\int^{\infty}_{0}f(k) = 100$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span></code></pre></div>
</div>
<p>When you compile this it should looks like:</p>
<p>And when <img src="https://latex.codecogs.com/png.latex?%5Clim_%7Bk%5Crightarrow0%7Df(k)/k%20=%20%5Cinfty"> it is the case that <img src="https://latex.codecogs.com/png.latex?%5Cint%5E%7B%5Cinfty%7D_%7B0%7Df(k)%20=%20100">.</p>
</section>
<section id="probability-expectations-real-numbers-integrals" class="level3">
<h3 class="anchored" data-anchor-id="probability-expectations-real-numbers-integrals">Probability, expectations, real numbers, integrals</h3>
<p>The <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D">, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D">, and <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BR%7D"> that you may be used to seeing to denote probability, expectation, and the real numbers are made by a call to mathbb within maths mode. For instance add the following to your paper:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">Often we care about probability, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>\mathbb{P}<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>, because of expectations, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>\mathbb{E}<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>, over real numbers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>\mathbb{R}<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>.</span></code></pre></div>
</div>
<p>When you compile it should look like this:</p>
<p>Often we care about probability, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D">, because of expectations, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D">, over real numbers <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BR%7D">.</p>
<p>You can also make a call to mathcal, for instance in naming sets <tt><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BA%7D"></tt>, <tt><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BB%7D"></tt>, <tt><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BC%7D"></tt> or for a nice Lagrangian <tt><img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BL%7D"></tt>.</p>
</section>
<section id="fractions" class="level3">
<h3 class="anchored" data-anchor-id="fractions">Fractions</h3>
<p>Fractions are built into math mode using <tt>frac{}{}</tt> and you can nest them if you need to. For instance add the following to your paper:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb14-1">It can be surprising when you first learn that $\frac{\frac{x}{y}}{y} = \frac{x}{y^2}$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span></code></pre></div>
</div>
<p>This should compile to:</p>
<p>It can be surprising when you first learn that <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cfrac%7Bx%7D%7By%7D%7D%7By%7D%20=%20%5Cfrac%7Bx%7D%7By%5E2%7D">.</p>
<p>Be careful when using brackets and fractions because sometimes the sizes need to be aligned. You can do it manually, but alternative specify left and right, for instance, compare with and without:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">$</span>\<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left</span>(\frac{\frac{x}{y}}{y}\right) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> (\frac{\frac{x}{y}}{y})<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">$</span>.</span></code></pre></div>
</div>
<p>which compiles to:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cleft(%5Cfrac%7B%5Cfrac%7Bx%7D%7By%7D%7D%7By%7D%5Cright)%20=%20(%5Cfrac%7B%5Cfrac%7Bx%7D%7By%7D%7D%7By%7D)">.</p>
</section>
<section id="theorems-definitions-and-proofs" class="level3">
<h3 class="anchored" data-anchor-id="theorems-definitions-and-proofs">Theorems, definitions and proofs</h3>
<p>Theorems and proofs draw on the amsthm package that was loaded earlier. You need to declare the name that you’ll use to refer to it in the preamble. After that you can call a theorem, proposition, description, whatever it was you defined, throughout the document.</p>
<p>First, add this to the preamble:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb16-1">\newtheorem{theorem}{Theorem}</span></code></pre></div>
</div>
<p>Then add this to the content:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb17-1">\begin{theorem}</span>
<span id="cb17-2">Often we want to construct and prove theorems in economics<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb17-3">\end{theorem}</span></code></pre></div>
</div>
<p>In this case, I defined a theorem and LaTeX will print Theorem when compiled You could add another for propositions, etc.</p>
<p>Proofs are similar, but don’t need to be defined in the preamble:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">\begin{proof}</span>
<span id="cb18-2">My proof of the proposition.</span>
<span id="cb18-3">\end{proof}</span></code></pre></div>
</div>
<p>Your tex file should now look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb19-1">\documentclass<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[a4paper, 12pt]</span>{article}</span>
<span id="cb19-2"></span>
<span id="cb19-3">\usepackage{amsmath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amsthm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amssymb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> graphicx}</span>
<span id="cb19-4"></span>
<span id="cb19-5">\newtheorem{theorem}{Theorem}</span>
<span id="cb19-6"></span>
<span id="cb19-7">\begin{document}</span>
<span id="cb19-8"></span>
<span id="cb19-9">\title{An Introduction To \LaTeX}</span>
<span id="cb19-10">\author{Rohan Alexander\thanks{Thank you to my primary supervisor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> John Tang<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> All correspondence to rohan<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.alexander</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">@anu</span>.edu.au.}\\</span>
<span id="cb19-11">\textit{Australian National University}}</span>
<span id="cb19-12">\date{14 September<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> 2017}</span>
<span id="cb19-13">\maketitle</span>
<span id="cb19-14"></span>
<span id="cb19-15">\begin{abstract}</span>
<span id="cb19-16">The point of this document is to introduce you to \LaTeX<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> There are many examples that you can grab and use in your own work<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb19-17">\end{abstract}</span>
<span id="cb19-18"></span>
<span id="cb19-19">\section{Introduction}</span>
<span id="cb19-20"></span>
<span id="cb19-21">\section{Model}</span>
<span id="cb19-22"></span>
<span id="cb19-23">Using $\alpha$ to indicate the outcome of interest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> the estimate becomes :</span>
<span id="cb19-24">$$ \hat{\alpha} = \frac{\sum^J_{j=1}\beta_j}{\int^{\infty}_{0}f(k)} $$</span>
<span id="cb19-25"></span>
<span id="cb19-26">And when $\lim_{k\rightarrow0}f(k)/k = \infty$ it is the case that $\int^{\infty}_{0}f(k) = 100$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb19-27"></span>
<span id="cb19-28">Often we care about probability<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> $\mathbb{P}$<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> because of expectations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> $\mathbb{E}$<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> over real numbers $\mathbb{R}$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb19-29"></span>
<span id="cb19-30">It can be surprising when you first learn that $\frac{\frac{x}{y}}{y} = \frac{x}{y^2}$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb19-31"></span>
<span id="cb19-32">\begin{theorem}</span>
<span id="cb19-33">Often we want to construct and prove theorems in economics<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb19-34">\end{theorem}</span>
<span id="cb19-35">\begin{proof}</span>
<span id="cb19-36">My proof of the proposition<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb19-37">\end{proof}</span>
<span id="cb19-38"></span>
<span id="cb19-39">\section{Data}</span>
<span id="cb19-40"></span>
<span id="cb19-41">\end{document}</span></code></pre></div>
</div>
</section>
</section>
<section id="text" class="level2">
<h2 class="anchored" data-anchor-id="text">Text</h2>
<section id="paragraphs" class="level3">
<h3 class="anchored" data-anchor-id="paragraphs">Paragraphs</h3>
<p>LaTeX was designed for maths, but it does text well too. To start a new paragraph, just leave a blank line in your editor, LaTeX will take care of spacing. For instance add the following to your introduction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb20-1">My father's father was a Methodist minister<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> He was a tall<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> handsome<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> noble-looking man; he had a deep beautiful voice<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> My father was an ardent atheist and admirer of Clarence Darrow<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> He skipped grades the way other boys skip class<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> he lectured my grandfather's flock on carbon 14 and the origin of species<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> and he won a full scholarship to Harvard at the age of 15<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb20-2"></span>
<span id="cb20-3">He took the letter from Harvard to his father<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb20-4"></span>
<span id="cb20-5">Something looked through my grandfather's beautiful eyes<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> Something spoke with his beautiful voice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> and it said<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: It</span>'s only fair to give the other side a chance<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span></code></pre></div>
</div>
<p>There are a few aspects to be aware of:</p>
<ul>
<li>To get ‘a quote’, you need to use the key next to the ‘1’ on your keyboard for the opening mark and then the normal quotation mark for the end mark.</li>
<li>You can makes words italic using <tt>textit{some italic words}</tt>, or make them bold using <tt>textbf{some bold words}</tt>.</li>
<li>Because the dollar sign is used to invoke maths mode, if you want to refer to prices, say $4, then you need to use a slash before the dollar sign. This is the same for the per cent symbol, %.</li>
</ul>
<p>Some people prefer different formatting on the paragraphs. Although it can cause some issues, you can change this by adding to the preamble:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb21-1">\usepackage{parskip}</span></code></pre></div>
</div>
</section>
<section id="lists" class="level3">
<h3 class="anchored" data-anchor-id="lists">Lists</h3>
<p>There are two main types of lists: <tt>itemize</tt> and <tt>enumerate</tt>.</p>
<p>Add the following to your data section:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb22-1">Our datasets were downloaded from<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb22-2">\begin{itemize}</span>
<span id="cb22-3">\item the ABS; and</span>
<span id="cb22-4">\item the RBA<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb22-5">\end{itemize}</span>
<span id="cb22-6"></span>
<span id="cb22-7">We had two priorities<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb22-8">\begin{enumerate}</span>
<span id="cb22-9">\item reproducibility; and</span>
<span id="cb22-10">\item ease of use<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb22-11">\end{enumerate}</span></code></pre></div>
</div>
</section>
<section id="tables" class="level3">
<h3 class="anchored" data-anchor-id="tables">Tables</h3>
<p>Tables are often annoying in LaTeX. Fortunately, many programs will automatically format their table outputs with LaTeX markup for your to copy-and-paste into your tex file, and there are websites that can help.</p>
<p>Simple tables are not a problem. For instance, add the following to your data section:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb23-1">\begin{tabular}{ l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> r }</span>
<span id="cb23-2">  \hline</span>
<span id="cb23-3">  1 &amp; 2 &amp; 3 \\</span>
<span id="cb23-4">  4 &amp; 5 &amp; 6 \\</span>
<span id="cb23-5">  7 &amp; 8 &amp; 9 \\</span>
<span id="cb23-6">  \hline  </span>
<span id="cb23-7">\end{tabular}</span></code></pre></div>
</div>
<p>But it gets complicated. If you commonly use tables then it is easier to get your statistics program to output tables that have been formatted for LaTeX, or use an online table generator, such as http://www.tablesgenerator.com/.</p>
<p>In R, there is a package ‘Huxtable’.</p>
</section>
<section id="graphs-and-pictures" class="level3">
<h3 class="anchored" data-anchor-id="graphs-and-pictures">Graphs and pictures</h3>
<p>To include graphs or pictures in your document, add the file to the same folder that your tex file is in. From there you can add it. Many adjustments are possible in terms of size and layout. Fortunately, all the labelling is done for us. For instance, download the following image into the folder where your tex file is saved: https://github.com/RohanAlexander/blogdown_website/blob/master/static/img/me.png</p>
<p>Then add this markup into your data section:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb24-1">\begin{figure}<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[h!]</span></span>
<span id="cb24-2">\caption{My first image}</span>
<span id="cb24-3">\center</span>
<span id="cb24-4">\includegraphics<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[width</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0.80\textwidth</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span>{me<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.png</span>}\label{australia_map}</span>
<span id="cb24-5">\end{figure}</span>
<span id="cb24-6"></span>
<span id="cb24-7">Income inequality in Australia is illustrated in Figure \ref{australia_map}<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span></code></pre></div>
</div>
<p>Your tex file should look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb25-1">\documentclass<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[a4paper, 12pt]</span>{article}</span>
<span id="cb25-2"></span>
<span id="cb25-3">\usepackage{amsmath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amsthm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amssymb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> graphicx}</span>
<span id="cb25-4"></span>
<span id="cb25-5">\newtheorem{theorem}{Theorem}</span>
<span id="cb25-6"></span>
<span id="cb25-7"></span>
<span id="cb25-8">\begin{document}</span>
<span id="cb25-9"></span>
<span id="cb25-10">\title{An Introduction To \LaTeX}</span>
<span id="cb25-11">\author{Rohan Alexander\\</span>
<span id="cb25-12">\textit{Australian National University}}</span>
<span id="cb25-13">\date{14 September<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> 2017}</span>
<span id="cb25-14">\maketitle</span>
<span id="cb25-15"></span>
<span id="cb25-16"></span>
<span id="cb25-17">\begin{abstract}</span>
<span id="cb25-18">The point of this document is to introduce you to \LaTeX<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> There are many examples that you can grab and use in your own work<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-19">\end{abstract}</span>
<span id="cb25-20"></span>
<span id="cb25-21"></span>
<span id="cb25-22">\section{Introduction}</span>
<span id="cb25-23">My father's father was a Methodist minister<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> He was a tall<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> handsome<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> noble-looking man; he had a deep beautiful voice<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> My father was an ardent atheist and admirer of Clarence Darrow<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> He skipped grades the way other boys skip class<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> he lectured my grandfather's flock on carbon 14 and the origin of species<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> and he won a full scholarship to Harvard at the age of 15<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-24"></span>
<span id="cb25-25">He took the letter from Harvard to his father<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-26"></span>
<span id="cb25-27">Something looked through my grandfather's beautiful eyes<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> Something spoke with his beautiful voice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> and it said<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: It</span>'s only fair to give the other side a chance<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-28"></span>
<span id="cb25-29"></span>
<span id="cb25-30">\section{Model}</span>
<span id="cb25-31">Using $\alpha$ to indicate the outcome of interest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> the estimate becomes <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb25-32">$$ \hat{\alpha} = \frac{\sum^J_{j=1}\beta_j}{\int^{\infty}_{0}f(k)} $$</span>
<span id="cb25-33"></span>
<span id="cb25-34">And when $\lim_{k\rightarrow0}f(k)/k = \infty$ it is the case that $\int^{\infty}_{0}f(k) = 100$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-35"></span>
<span id="cb25-36">Often we care about probability<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> $\mathbb{P}$<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> because of expectations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> $\mathbb{E}$<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> over real numbers $\mathbb{R}$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-37"></span>
<span id="cb25-38">It can be surprising when you first learn that $\frac{\frac{x}{y}}{y} = \frac{x}{y^2}$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-39"></span>
<span id="cb25-40">\begin{theorem}</span>
<span id="cb25-41">Often we want to construct and prove theorems in economics<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-42">\end{theorem}</span>
<span id="cb25-43">\begin{proof}</span>
<span id="cb25-44">My proof of the proposition<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-45">\end{proof}</span>
<span id="cb25-46"></span>
<span id="cb25-47"></span>
<span id="cb25-48">\section{Data}</span>
<span id="cb25-49">Our datasets were downloaded from<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb25-50">\begin{itemize}</span>
<span id="cb25-51">\item the ABS; and</span>
<span id="cb25-52">\item the RBA<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-53">\end{itemize}</span>
<span id="cb25-54"></span>
<span id="cb25-55">We had two priorities<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb25-56">\begin{enumerate}</span>
<span id="cb25-57">\item reproducibility; and</span>
<span id="cb25-58">\item ease of use<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-59">\end{enumerate}</span>
<span id="cb25-60"></span>
<span id="cb25-61">\begin{tabular}{ l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> r }</span>
<span id="cb25-62">  \hline</span>
<span id="cb25-63">  1 &amp; 2 &amp; 3 \\</span>
<span id="cb25-64">  4 &amp; 5 &amp; 6 \\</span>
<span id="cb25-65">  7 &amp; 8 &amp; 9 \\</span>
<span id="cb25-66">  \hline  </span>
<span id="cb25-67">\end{tabular}</span>
<span id="cb25-68">  </span>
<span id="cb25-69">\begin{figure}<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[h!]</span></span>
<span id="cb25-70">\caption{My first image}</span>
<span id="cb25-71">\center</span>
<span id="cb25-72">\includegraphics<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[width</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0.80\textwidth</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span>{me<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.png</span>}\label{australia_map}</span>
<span id="cb25-73">\end{figure}</span>
<span id="cb25-74"></span>
<span id="cb25-75">Income inequality in Australia is illustrated in Figure \ref{australia_map}<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb25-76"></span>
<span id="cb25-77">\end{document}</span></code></pre></div>
</div>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>LaTeX uses Bibtex for references. To use this open a new file in TeXShop/TeXStudio and add the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb26-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">@Book</span>{DeWitt2000<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-2">    author = {Helen DeWitt}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-3">    title = {The Last Samurai}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-4">    publisher = {Hyperion Books}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-5">    place = {United State of America}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-6">    year = {2000}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-7">  }</span></code></pre></div>
</div>
<p>Save it as first_bibliography.bib in the same folder as your tex file. Then add the following at the end of the paragraphs in your Introduction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb27-1">\cite{DeWitt2000}</span></code></pre></div>
</div>
<p>And add the following at the end of your document, on the line above <tt>end{document}</tt>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb28-1">\bibliography{first_bibliography}</span></code></pre></div>
</div>
<p>Then typeset as BibTeX, (you’ll only need to do this once each time you update your bib file), and then typeset as normal with LaTeX.</p>
<p>Your tex file should look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb29-1">\documentclass<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[a4paper, 12pt]</span>{article}</span>
<span id="cb29-2"></span>
<span id="cb29-3">\usepackage{amsmath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amsthm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amssymb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> graphicx}</span>
<span id="cb29-4"></span>
<span id="cb29-5">\newtheorem{theorem}{Theorem}</span>
<span id="cb29-6"></span>
<span id="cb29-7"></span>
<span id="cb29-8">\begin{document}</span>
<span id="cb29-9"></span>
<span id="cb29-10">\title{An Introduction To \LaTeX}</span>
<span id="cb29-11">\author{Rohan Alexander\\</span>
<span id="cb29-12">\textit{Australian National University}}</span>
<span id="cb29-13">\date{14 September<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> 2017}</span>
<span id="cb29-14">\maketitle</span>
<span id="cb29-15"></span>
<span id="cb29-16"></span>
<span id="cb29-17">\begin{abstract}</span>
<span id="cb29-18">The point of this document is to introduce you to \LaTeX<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> There are many examples that you can grab and use in your own work<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-19">\end{abstract}</span>
<span id="cb29-20"></span>
<span id="cb29-21"></span>
<span id="cb29-22">\section{Introduction}</span>
<span id="cb29-23">My father's father was a Methodist minister<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> He was a tall<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> handsome<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> noble-looking man; he had a deep beautiful voice<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> My father was an ardent atheist and admirer of Clarence Darrow<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> He skipped grades the way other boys skip class<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> he lectured my grandfather's flock on carbon 14 and the origin of species<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> and he won a full scholarship to Harvard at the age of 15<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-24"></span>
<span id="cb29-25">He took the letter from Harvard to his father<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-26"></span>
<span id="cb29-27">Something looked through my grandfather's beautiful eyes<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> Something spoke with his beautiful voice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> and it said<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: It</span>'s only fair to give the other side a chance \cite{DeWitt2000}<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span> </span>
<span id="cb29-28"></span>
<span id="cb29-29"></span>
<span id="cb29-30">\section{Model}</span>
<span id="cb29-31">Using $\alpha$ to indicate the outcome of interest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> the estimate becomes <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb29-32">$$ \hat{\alpha} = \frac{\sum^J_{j=1}\beta_j}{\int^{\infty}_{0}f(k)} $$</span>
<span id="cb29-33"></span>
<span id="cb29-34">And when $\lim_{k\rightarrow0}f(k)/k = \infty$ it is the case that $\int^{\infty}_{0}f(k) = 100$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-35"></span>
<span id="cb29-36">Often we care about probability<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> $\mathbb{P}$<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> because of expectations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> $\mathbb{E}$<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> over real numbers $\mathbb{R}$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-37"></span>
<span id="cb29-38">It can be surprising when you first learn that $\frac{\frac{x}{y}}{y} = \frac{x}{y^2}$<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-39"></span>
<span id="cb29-40">\begin{theorem}</span>
<span id="cb29-41">Often we want to construct and prove theorems in economics<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-42">\end{theorem}</span>
<span id="cb29-43">\begin{proof}</span>
<span id="cb29-44">My proof of the proposition<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-45">\end{proof}</span>
<span id="cb29-46"></span>
<span id="cb29-47"></span>
<span id="cb29-48">\section{Data}</span>
<span id="cb29-49">Our datasets were downloaded from<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb29-50">\begin{itemize}</span>
<span id="cb29-51">\item the ABS; and</span>
<span id="cb29-52">\item the RBA<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-53">\end{itemize}</span>
<span id="cb29-54"></span>
<span id="cb29-55">We had two priorities<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb29-56">\begin{enumerate}</span>
<span id="cb29-57">\item reproducibility; and</span>
<span id="cb29-58">\item ease of use<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-59">\end{enumerate}</span>
<span id="cb29-60"></span>
<span id="cb29-61">\begin{tabular}{ l <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> r }</span>
<span id="cb29-62">  \hline</span>
<span id="cb29-63">  1 &amp; 2 &amp; 3 \\</span>
<span id="cb29-64">  4 &amp; 5 &amp; 6 \\</span>
<span id="cb29-65">  7 &amp; 8 &amp; 9 \\</span>
<span id="cb29-66">  \hline  </span>
<span id="cb29-67">\end{tabular}</span>
<span id="cb29-68">  </span>
<span id="cb29-69">\begin{figure}<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[h!]</span></span>
<span id="cb29-70">\caption{My first image}</span>
<span id="cb29-71">\center</span>
<span id="cb29-72">\includegraphics<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[width</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0.80\textwidth</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span>{me<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.png</span>}\label{australia_map}</span>
<span id="cb29-73">\end{figure}</span>
<span id="cb29-74"></span>
<span id="cb29-75">Income inequality in Australia is illustrated in Figure \ref{australia_map}<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb29-76"></span>
<span id="cb29-77">\bibliographystyle{unsrt}</span>
<span id="cb29-78">\bibliography{first_bibliography<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.bib</span>}</span>
<span id="cb29-79"></span>
<span id="cb29-80"></span>
<span id="cb29-81">\end{document}</span></code></pre></div>
</div>
</section>
</section>
<section id="slides" class="level1">
<h1>Slides</h1>
<p>Making slides is similar to writing a paper in that the markup can be the same. But you need to specify when the content of a slide should start and stop and also what the title should be.</p>
<p>To get started, open a new file in TeXShop/TeXStudio and add the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb30-1">\documentclass{beamer}</span>
<span id="cb30-2"></span>
<span id="cb30-3">\usepackage{amsmath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amsthm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amssymb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> graphicx}</span>
<span id="cb30-4"></span>
<span id="cb30-5">\begin{document}</span>
<span id="cb30-6"></span>
<span id="cb30-7">\end{document}</span></code></pre></div>
</div>
<p>You’ll notice that the only difference is that the document class has been changed to beamer.</p>
<p>Copy the title, author and date, etc markup from your paper, and then paste it between <tt>begin{frame}</tt> and <tt>end{frame}</tt>. So your file should look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb31-1">\documentclass{beamer}</span>
<span id="cb31-2"></span>
<span id="cb31-3">\usepackage{amsmath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amsthm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> amssymb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> graphicx}</span>
<span id="cb31-4"></span>
<span id="cb31-5">\begin{document}</span>
<span id="cb31-6"></span>
<span id="cb31-7">\begin{frame}</span>
<span id="cb31-8">\title{An Introduction To \LaTeX}</span>
<span id="cb31-9">\author{Rohan Alexander\\</span>
<span id="cb31-10">\textit{Australian National University}}</span>
<span id="cb31-11">\date{14 September<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> 2017}</span>
<span id="cb31-12">\maketitle</span>
<span id="cb31-13">\end{frame}</span>
<span id="cb31-14"></span>
<span id="cb31-15">\end{document}</span></code></pre></div>
</div>
<p>When you save and compile this you should get slides.</p>
<p>You can add a content slide by adding the following after that first slide:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb32-1">\begin{frame}</span>
<span id="cb32-2">\frametitle{Main results}</span>
<span id="cb32-3">\begin{itemize}</span>
<span id="cb32-4">\item I find that income inequality is increasing<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb32-5">\item This is because of slower income growth in country areas<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb32-6">\end{itemize}</span>
<span id="cb32-7">\end{frame}</span></code></pre></div>
</div>
<p>I’ve chosen to include a list, but you could include paragraphs, or images or tables using the same markup that you have in your paper.</p>
</section>
<section id="misc" class="level1">
<h1>Misc</h1>
<section id="learning-more-and-getting-help" class="level2">
<h2 class="anchored" data-anchor-id="learning-more-and-getting-help">Learning more and getting help</h2>
<ul>
<li>Check that there is an <tt>end</tt> for every <tt>begin</tt>, and similarly that all braces that are opened are also closed.</li>
<li>Compile frequently so that you have a better idea of where the error is.</li>
<li>Stack Overflow is helpful if you want specific changes or features.</li>
<li>The wikibooks guide - https://en.wikibooks.org/wiki/LaTeX - is an excellent resource to improve your knowledge.</li>
</ul>
</section>
<section id="sharelatex" class="level2">
<h2 class="anchored" data-anchor-id="sharelatex">ShareLaTeX</h2>
<p>These days I more commonly use LaTeX in the cloud instead of on my local computer, via: https://www.sharelatex.com/. The advantage is that it brings google-docs-style collaboration tools.</p>


</section>
</section>

 ]]></description>
  <guid>https://rohanalexander.com/posts/2017-09-14-getting-started-with-latex/getting-started-with-latex.html</guid>
  <pubDate>Thu, 14 Sep 2017 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Reproducing a Grattan Institute map</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2017-08-11-reproducing-a-grattan-map/reproducing-a-grattan-map.html</link>
  <description><![CDATA[ 



<p><em>Thank you to Monica for her helpful edits.</em></p>
<p><em>Geoffrey Liu found an error in how I deal with the postcodes data that I haven’t fixed yet.</em></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The Grattan Institute is an Australian think tank that produces reports about public policy. Last week they released <a href="https://grattan.edu.au/report/regional-patterns-of-australias-economy-and-population/">‘Regional patterns of Australia’s economy and population’</a>. That report looks into the differences between geographic areas across various economic and demographic variables. It includes interactive maps made using Carto. The Grattan Institute also released the datasets that underpin the report’s maps and graphs.</p>
<p>I was interested to see if I could reproduce one of their interactive maps - <a href="https://grattan.carto.com/me">Annual income growth per person (FY04 - FY15)</a> - in an hour using R and the Leaflet package. A day later I found the underlying dataset did not correspond with the map that the Grattan Institute published. But following the methodology in the report I was able to create a dataset that seems pretty close to the values illustrated on their map.</p>
<p>The final map that I produced is below (it’ll take about 5 seconds to load) and this note records what I did to produce it in R using the Leaflet package.</p>
<div class="cell">
<iframe src="https://rohanalexander.shinyapps.io/grattan/?showcase=0" width="672" height="600px" data-external="1">
</iframe>
</div>
</section>
<section id="workspace" class="level1">
<h1>Workspace</h1>
<p>The first step was to set-up the workspace. Mostly this just meant loading packages. The <tt>tidyverse</tt> and <tt>magrittr</tt> packages help with general data manipulation tasks; <tt>zoo</tt> helps with the rolling average needed later; and <tt>leaflet</tt>, <tt>rgdal</tt>, and <tt>rmapshaper</tt> are specific to mapping.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(magrittr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(zoo)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(leaflet)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rgdal)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rmapshaper)</span></code></pre></div>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>I decided to reproduce Figure 2.4 of the report. This shows the average annual growth in real taxable income per tax filer between the financial years 2003/04 and 2014/15 for the 2011 SA3 areas. To do this I needed the incomes data that the Grattan Institute mapped and the geographic data that defines the areas.</p>
<section id="incomes" class="level2">
<h2 class="anchored" data-anchor-id="incomes">Incomes</h2>
<p>The Grattan Institute released the datasets that they said had been mapped. It was straightforward to download this file and export the relevant sheet as a csv file. The Excel file is available at https://grattan.edu.au/report/regional-patterns-of-australias-economy-and-population/ (in the left panel).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import the income data that has been taken from the Grattan data download, sheet 'Figure 2.4' (which was saved as a csv).</span></span>
<span id="cb2-2">incomes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/890-Regional-patterns-chart-data.csv"</span>)</span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove some debris columns</span></span>
<span id="cb2-4">incomes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> incomes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SA3"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Growth_mean_income_FY04_FY15"</span>)</span></code></pre></div>
</div>
</section>
<section id="geographies" class="level2">
<h2 class="anchored" data-anchor-id="geographies">Geographies</h2>
<p>The other dataset that I needed was the geographies that the Grattan Institute had used. I initially wasted a lot of time using the 2016 SA3 release. Eventually I realised they were using the SA3 release from 2011. This is available from the ABS website at: http://www.abs.gov.au/AUSSTATS/abs@.nsf/DetailsPage/1270.0.55.001July%202011?OpenDocument and I used the zipped file: ‘Statistical Area Level 3 (SA3) ASGS Ed 2011 Digital Boundaries in ESRI Shapefile Format’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2011 SA3 boundaries</span></span>
<span id="cb3-2">old_boundaries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readOGR</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dsn =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/1270055001_sa3_2011_aust_shape"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layer =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SA3_2011_AUST"</span>)</span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the income data into the boundaries dataset</span></span>
<span id="cb3-4">old_boundaries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(old_boundaries, incomes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SA3_NAME11"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SA3"</span>)</span></code></pre></div>
</div>
<p>Comparing the incomes data with the 2011 geographies data indicates the incomes data is missing two SA3 areas: ‘Illawarra Catchment Reserve’ and ‘Blue Mountains - South’. I also found these areas had been left as NA in the Grattan Institute’s interactive map. This made me confident that the Grattan Institute was using the 2011 boundaries (I may have missed it but I don’t think this was documented).</p>
</section>
</section>
<section id="map" class="level1">
<h1>Map</h1>
<p>Making the map was not complicated once the pieces were in place. I called Leaflet and specified a black and white base map. After that I adjusted the default view and then added the patchwork quilt that shows the incomes dataset by SA3 area.</p>
<p>I didn’t spend too much time on the colours because the inferno palette got fairly close. I just copied their published bins to reproduce the breaks that the Grattan Institute used. Box 1 in Appendix A of the Grattan Institute’s report specifies how they came up with these bins. Give my purposes I didn’t worry too much about this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the color scheme </span></span>
<span id="cb4-2">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorBin</span>(</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inferno"</span>,</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">domain =</span> old_boundaries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Growth_mean_income_FY04_FY15,</span>
<span id="cb4-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.005</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.012</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.015</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.017</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.019</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.022</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.029</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.07</span>),</span>
<span id="cb4-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb4-7">  )</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the map</span></span>
<span id="cb4-10">Australia_incomes_map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leaflet</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Base map</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addProviderTiles</span>(providers<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Stamen.TonerLite, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Toner Lite"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setView</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lng =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">133.7751</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.2744</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Specify where the map is initially focused</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addPolygons</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> old_boundaries, </span>
<span id="cb4-16">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pal</span>(old_boundaries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Growth_mean_income_FY04_FY15), </span>
<span id="cb4-17">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb4-18">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stroke =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb4-19">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smoothFactor =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb4-20">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fillOpacity =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, </span>
<span id="cb4-21">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Area name (SA3):"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(old_boundaries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>SA3_NAME11), </span>
<span id="cb4-22">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean annual growth:"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(old_boundaries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Growth_mean_income_FY04_FY15)),</span>
<span id="cb4-23">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlightOptions =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">highlightOptions</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#666"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bringToFront =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addLegend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottomright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pal =</span> pal, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> old_boundaries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Growth_mean_income_FY04_FY15,</span>
<span id="cb4-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean annual income growth (FY04 - FY15)"</span>,</span>
<span id="cb4-26">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">opacity =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb4-27">  )</span>
<span id="cb4-28"></span>
<span id="cb4-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Call the map</span></span>
<span id="cb4-30">Australia_incomes_map</span></code></pre></div>
</div>
<p>There were many small changes that could be made to better reproduce the Grattan Institute’s map, but at this stage I realised there was something going on with the data. I decided to spend more time with that than tweaking the remaining aspects.</p>
</section>
<section id="comparison" class="level1">
<h1>Comparison</h1>
<section id="issues" class="level2">
<h2 class="anchored" data-anchor-id="issues">Issues</h2>
<p>Comparing screenshots of the maps shows some of the issues:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2017-08-11-reproducing-a-grattan-map/images/grattan.png" class="quarto-discovered-preview-image img-fluid figure-img" width="944"></p>
<p></p><figcaption class="figure-caption">Grattan’s map</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2017-08-11-reproducing-a-grattan-map/images/me.png" class="img-fluid figure-img" width="1135"></p>
<p></p><figcaption class="figure-caption">My map</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>For instance there are areas where my map has a lot more variation such as:</p>
<ul>
<li>the northern SA3 areas of Queensland; and</li>
<li>the SA3 areas in the south west of Western Australia.</li>
</ul>
<p>And there are also some areas where the colours are fairly different (notwithstanding the fact that I didn’t match theirs exactly), such as:</p>
<ul>
<li>west of Melbourne where my values are a lot higher.</li>
</ul>
</section>
<section id="triage" class="level2">
<h2 class="anchored" data-anchor-id="triage">Triage</h2>
<p>I checked that I was using the dataset that I had meant to use. While I was checking this dataset (which is the one that the Grattan Institute makes available) I noticed that the numbers in the Grattan Institute’s dataset were not always the ones that were being mapped. This was easy to see because they included a static version of the map next to the dataset, so I was confident it was meant to be the same.</p>
<p>I couldn’t work out how to download the actual dataset underlying the interactive Carto map. But I was able to check some on an area-by-area basis because the value was displayed on mouse-hover. I found that the figure that was displayed did line up with the colour of the area, but not the dataset that they offered as underpinning the map.</p>
<p>The following table summarises some of the SA3 areas in north Queensland.</p>
<table class="table">
<thead>
<tr class="header">
<th>SA3 Area</th>
<th>Grattan Carto value</th>
<th>Grattan data value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cairns - South</td>
<td>1.73</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>Charters Towers - Ayr - Ingham</td>
<td>2.35</td>
<td>1.6</td>
</tr>
<tr class="odd">
<td>Far North</td>
<td>2.66</td>
<td>3.0</td>
</tr>
<tr class="even">
<td>Outback - North</td>
<td>2.33</td>
<td>1.7</td>
</tr>
<tr class="odd">
<td>Port Douglas - Daintree</td>
<td>1.73</td>
<td>1.4</td>
</tr>
<tr class="even">
<td>Tablelands (East) - Kuranda</td>
<td>2.23</td>
<td>1.6</td>
</tr>
</tbody>
</table>
<p>The key issue was whether it was the Carto map or the dataset that was wrong.</p>
</section>
</section>
<section id="down-the-rabbit-hole" class="level1">
<h1>Down the rabbit hole</h1>
<p>By this stage it was after dinner, and I’d had a glass or three of wine. But the only way to work out whether it was the dataset or the map that was wrong was to recreate the dataset myself. To do this I needed:</p>
<ul>
<li>incomes data for financial years 2003-04 and 2014-15;</li>
<li>an inflation rate over this time to make the 2003-04 data real; and</li>
<li>a correspondence from postcodes to the 2011 SA3 areas.</li>
</ul>
<p>Without their code it would be hard to be certain, but the Grattan Institute provided enough information in the report that I was confident I could get reasonably close to what they’d done.</p>
<section id="incomes-1" class="level2">
<h2 class="anchored" data-anchor-id="incomes-1">Incomes</h2>
<p>The incomes data is from Table 8 of the ATO’s 2015 tax stats which is available here: https://data.gov.au/dataset/taxation-statistics-2014-15/resource/02e58971-ddee-4f77-af15-5c45de569ed6</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import the tax data</span></span>
<span id="cb5-2">tax_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/taxstats2015individual08medianaveragetaxableincomestateterritorypostcode.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove the debris rows</span></span>
<span id="cb5-4">tax_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tax_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2254</span>,]</span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grattan says we only need postcode, the 2003/04 data and the 2014/15 data, so drop the rest of the variables</span></span>
<span id="cb5-6">tax_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tax_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(X2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>X5, X11<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>X13)</span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fix the column names</span></span>
<span id="cb5-9">tax_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(tax_data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"postcode"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"population_0304"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X3, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"median_inc_0304"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X4, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ave_inc_0304"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X5, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"population_1415"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X11, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"median_inc_1415"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X12, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ave_inc_1415"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X13)</span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Finally, change the classes to numeric (need to remove the comma first)</span></span>
<span id="cb5-11">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_0304 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_0304)</span>
<span id="cb5-12">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_0304 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_0304)</span>
<span id="cb5-13">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_0304 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_0304)</span>
<span id="cb5-14">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_1415 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_1415)</span>
<span id="cb5-15">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_1415 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_1415)</span>
<span id="cb5-16">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_1415 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_1415)</span>
<span id="cb5-17">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>postcode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>postcode)</span>
<span id="cb5-18">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_0304 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_0304)</span>
<span id="cb5-19">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_0304 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_0304)</span>
<span id="cb5-20">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_0304 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_0304)</span>
<span id="cb5-21">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_1415 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>population_1415)</span>
<span id="cb5-22">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_1415 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>median_inc_1415)</span>
<span id="cb5-23">tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_1415 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(tax_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ave_inc_1415)</span></code></pre></div>
</div>
</section>
<section id="inflation" class="level2">
<h2 class="anchored" data-anchor-id="inflation">Inflation</h2>
<p>I needed to change the financial year 2003-04 incomes into 2014-15 dollars. In the Grattan Institute’s report (p.&nbsp;34) they say:</p>
<blockquote class="blockquote">
<p>Nominal income for the 2003-04 financial year was adjusted to real 2014-15 dollars, using a yearly average of ABS quarterly data on the Consumer Price Index, starting from the 2003 September quarter.</p>
</blockquote>
<p>I downloaded the inflation data that they specified from: http://www.abs.gov.au/AUSSTATS/abs@.nsf/DetailsPage/6401.0Mar%202017?OpenDocument (it is Series A2325846C which is in Tables 1 and 2 of the release). I wasn’t exactly sure how the Grattan Institute constructed its measure, but I decided to just go with the RBA formula (http://www.rba.gov.au/calculator/) which is: (Average of the four quarters in the final year / average of the four quarters in the first year - 1) *100, although I didn’t need to worry about removing one or the multiplying.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import the inflation data</span></span>
<span id="cb6-2">inflation_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/640101.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grab the series they use: A2325846C</span></span>
<span id="cb6-4">inflation_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> inflation_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(X1, X10)</span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fix the column names</span></span>
<span id="cb6-7">inflation_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(inflation_data, </span>
<span id="cb6-8">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarter"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X1,</span>
<span id="cb6-9">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index_value"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X10</span>
<span id="cb6-10">)</span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To use the RBA formula we need the average index number over the four quarters</span></span>
<span id="cb6-12">inflation_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> inflation_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_index_over_year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rollmean</span>(index_value, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'right'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb6-15">  )</span>
<span id="cb6-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now we just use (final_year_ave / first_year_ave) (don't need to bother with removing the 1 or multiplying by 100 because we are just going to multiply the first year data up to get in terms of final year)</span></span>
<span id="cb6-17">inflation_rate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-18">  ((inflation_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>average_index_over_year[inflation_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>quarter <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jun-2015"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> inflation_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>average_index_over_year[inflation_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>quarter <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jun-2004"</span>]))</span></code></pre></div>
</div>
<p>The inflation adjustment turned out to be about 1.34. I also worked out the annual inflation rates and then chained them, and also tried just using the start and end quarter index numbers (not averaged). They came to similar values, so even though I wasn’t exactly sure what the Grattan Institute had done, I was confident that small differences wouldn’t matter too much.</p>
</section>
<section id="growth" class="level2">
<h2 class="anchored" data-anchor-id="growth">Growth</h2>
<p>I then needed to create the annual growth rate that the Grattan Institute used (p.&nbsp;34):</p>
<blockquote class="blockquote">
<p>Growth in taxable income is calculated as a compound annual growth rate from the 2003-04 financial year to the 2014-15 financial year.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Data manipulation - create the new interest variable that is of interest - 11 years?</span></span>
<span id="cb7-2">tax_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tax_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">real_ave_inc_0304 =</span> ave_inc_0304 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> inflation_rate,</span>
<span id="cb7-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">real_median_inc_0304 =</span> median_inc_0304 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> inflation_rate,</span>
<span id="cb7-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annual_ave_growth =</span> (ave_inc_1415<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>real_ave_inc_0304)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>),</span>
<span id="cb7-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">annual_median_growth =</span> (median_inc_1415<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>real_median_inc_0304)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb7-8">  )</span></code></pre></div>
</div>
</section>
<section id="correspondence" class="level2">
<h2 class="anchored" data-anchor-id="correspondence">Correspondence</h2>
<p>The incomes data that the ATO makes available is on a postcode basis. I needed to convert this into 2011 SA3 levels and the ABS makes a correspondence for this purpose. This is available at: http://www.abs.gov.au/AUSSTATS/abs@.nsf/DetailsPage/1270.0.55.006July%202011?OpenDocument where the correct table is the zipped file ‘Postcode 2011 to Statistical Area Level 3 2011’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import the correspondence</span></span>
<span id="cb8-2">correspondence <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/1270055006_CG_POSTCODE_2011_SA3_2011.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skip =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb8-3">correspondence <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> correspondence <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(X2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>X6)</span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fix the column names</span></span>
<span id="cb8-6">correspondence <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(correspondence, </span>
<span id="cb8-7">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"postcode"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X2,</span>
<span id="cb8-8">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SA3_CODE_2011"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X3,</span>
<span id="cb8-9">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SA3_NAME_2011"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X4,</span>
<span id="cb8-10">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ratio"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X5,</span>
<span id="cb8-11">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percentage"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> X6</span>
<span id="cb8-12">)</span>
<span id="cb8-13"></span>
<span id="cb8-14">correspondence <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(correspondence, tax_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"postcode"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by.y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"postcode"</span>)</span>
<span id="cb8-15">match</span>
<span id="cb8-16"></span>
<span id="cb8-17">correspondence <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> correspondence <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb8-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">contribution_ave =</span> ratio <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> annual_ave_growth,</span>
<span id="cb8-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">contribution_median =</span> ratio <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> annual_median_growth</span>
<span id="cb8-21">  )</span>
<span id="cb8-22"></span>
<span id="cb8-23">sa3_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> correspondence <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(SA3_NAME_2011) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb8-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ave_growth =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weighted.mean</span>(annual_ave_growth, ratio, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T),</span>
<span id="cb8-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">median_growth =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weighted.mean</span>(annual_median_growth, ratio, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T)</span>
<span id="cb8-28">  )</span></code></pre></div>
</div>
</section>
<section id="putting-it-all-together" class="level2">
<h2 class="anchored" data-anchor-id="putting-it-all-together">Putting it all together</h2>
<p>This result of all this is that I created a dataset that seems pretty much the same as the one that the Grattan Institute mapped, but not the one that they released.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#load("sa3_data.Rda")</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#head(sa3_data, n = 20)</span></span></code></pre></div>
</div>
<p>My dataset can be downloaded as a csv here: https://github.com/RohanAlexander/blogdown_website/blob/master/content/post/sa3_data.csv</p>
<p>The values underlying the Grattan Carto map and the values that I generated are the same for the five 2011 SA3 areas in the earlier table:</p>
<table class="table">
<thead>
<tr class="header">
<th>SA3 Area</th>
<th>Grattan Carto value</th>
<th>Grattan data value</th>
<th>My value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cairns - South</td>
<td>1.73</td>
<td>2.0</td>
<td>1.73</td>
</tr>
<tr class="even">
<td>Charters Towers - Ayr - Ingham</td>
<td>2.35</td>
<td>1.6</td>
<td>2.35</td>
</tr>
<tr class="odd">
<td>Far North</td>
<td>2.66</td>
<td>3.0</td>
<td>2.66</td>
</tr>
<tr class="even">
<td>Outback - North</td>
<td>2.33</td>
<td>1.7</td>
<td>2.33</td>
</tr>
<tr class="odd">
<td>Port Douglas - Daintree</td>
<td>1.73</td>
<td>1.4</td>
<td>1.73</td>
</tr>
<tr class="even">
<td>Tablelands (East) - Kuranda</td>
<td>2.23</td>
<td>1.6</td>
<td>2.23</td>
</tr>
</tbody>
</table>
<p>After having compared my values with theirs I think that in their Excel dataset the Grattan Institute ordered the columns for the SA3 areas and the incomes data separately instead of together.</p>
</section>
<section id="reconciliation" class="level2">
<h2 class="anchored" data-anchor-id="reconciliation">Reconciliation</h2>
<p>I’ve reached out to the Grattan Institute and will update this post based on what they say.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The Grattan Institute is probably Australia’s most important think tank in terms of not being overly associated with one side of politics but still making a contribution to thinking on policy. It is good that they are being more open about their datasets, but it would be much better if they made their code available. Using tools like Leaflet and ggmap instead of Carto would help with this.</p>
<p>It was fun to spend the day in the data-analyst’s version of a treasure chase. But hopefully the next time I decide to reproduce a Grattan Institute map common sense prevails before I go too far down the rabbit hole.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://rohanalexander.com/posts/2017-08-11-reproducing-a-grattan-map/https:/imgs.xkcd.com/comics/duty_calls.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">I regret nothing :)</figcaption><p></p>
</figure>
</div>
<p><em>Disclosures: In the interest of transparency I’ll point out that I applied unsuccessfully for a job at the Grattan Institute about five years ago. One friend works as a research assistant for them on a casual basis; and there are a few friends-of-friends who work there full time, but I haven’t talked about this post with any of them.</em></p>


</section>

 ]]></description>
  <guid>https://rohanalexander.com/posts/2017-08-11-reproducing-a-grattan-map/reproducing-a-grattan-map.html</guid>
  <pubDate>Fri, 11 Aug 2017 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Getting started with Blogdown</title>
  <dc:creator>Rohan Alexander</dc:creator>
  <link>https://rohanalexander.com/posts/2017-07-21-getting-started-with-blogdown/getting-started-with-blogdown.html</link>
  <description><![CDATA[ 



<p><em>Thank you to Minhee Chae and Peter Gibbard for helpful comments.</em></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Blogdown is a package that allows you to make websites (not just blogs, notwithstanding its name) largely within R Studio. It builds on Hugo, which is a popular tool for making websites.</p>
<p>Blogdown lets you freely and quickly get a website up-and-running. It is easy to add content from time-to-time. It integrates with R Markdown which lets you easily share your work. And the separation of content and styling allows you to relatively quickly change your website’s design.</p>
<p>That said, using Blogdown is more work than Google sites or Squarespace. It requires a little more knowledge than using a basic Wordpress site. And if you want to customise many aspects of your website, or need everything to be ‘just so’ then Blogdown may not be for you.</p>
<p>Blogdown is still under active development and various aspects may break in future releases. That said, the investment of time required to set up a Blogdown website is unlikely to be wasted. Even if Blogdown were shuttered tomorrow most of the content could be repurposed for a regular Hugo website.</p>
<p>A Blogdown user-guide is being written by Yihui Xie, Amber Thomas, and Alison Presmanes Hill. The current draft can be viewed here: https://bookdown.org/yihui/blogdown/. Alison Presmanes Hill also has a very helpful post on getting started: https://apreshill.rbind.io/post/up-and-running-with-blogdown/.</p>
<p>This post is a simplified version of those two resources. It sticks to the basics and doesn’t require much decision-making. The purpose is to allow someone without much experience to use Blogdown to get a website up-and-running. Head to those two resources once you’ve got a website working and want to dive a bit deeper.</p>
</section>
<section id="software-installation" class="level1">
<h1>Software installation</h1>
<section id="software" class="level2">
<h2 class="anchored" data-anchor-id="software">Software</h2>
<p>To use Blogdown you need R and R Studio.</p>
<ul>
<li>To download R go to https://cran.csiro.au/ and download the version of R for your operating system. Follow the instructions to install R.</li>
<li>To download R Studio go to https://www.rstudio.com/products/rstudio/download/, scroll down to ‘Installers for Supported Platform’ and download the version of R Studio for your operating system (likely one of the first two links: Windows or Mac). Follow the instructions to install R Studio.</li>
</ul>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>You need to install the following packages: devtools, blogdown. To do this open R Studio and type the following into the console, hitting enter at the end of each line to run the command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"devtools"</span>)</span>
<span id="cb1-2">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rstudio/blogdown"</span>)</span></code></pre></div>
</div>
</section>
</section>
<section id="folder-management" class="level1">
<h1>Folder management</h1>
<p>This section follows Alison Presmanes Hill’s <a href="https://apreshill.rbind.io/post/up-and-running-with-blogdown/">post</a> closely. Go there for more information.</p>
<section id="github" class="level2">
<h2 class="anchored" data-anchor-id="github">GitHub</h2>
<p>It will be easier to put your website on the internet if you have a GitHub account. To create a GitHub account, go to https://github.com/ and sign-up for a free account. This restricts you to making everything public, but as we are using GitHub for a public website that’s fine. Once you have an account, create a new repository by clicking on the plus and call it ‘my_website’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">include_graphics</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/blogdown_github_1.png"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2017-07-21-getting-started-with-blogdown/images/blogdown_github_1.png" class="quarto-discovered-preview-image img-fluid" width="1076"></p>
</div>
</div>
<p>Don’t worry about including a readme or gitignore. Once you get to the ‘Quick setup’ page, copy the website address.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">include_graphics</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/blogdown_github_2.png"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2017-07-21-getting-started-with-blogdown/images/blogdown_github_2.png" class="img-fluid" width="1057"></p>
</div>
</div>
</section>
<section id="terminal" class="level2">
<h2 class="anchored" data-anchor-id="terminal">Terminal</h2>
<p>Open Terminal (either <tt>cmd + space</tt> then search for ‘Terminal’ or find it in your Applications). Use a combination of typing <tt>ls</tt> followed by ‘return’ and typing <tt>cd</tt> followed by ‘return’, to navigate to your ‘Documents’ folder. This is where your website will live for now.</p>
<p>Type <tt>git clone</tt> and paste the address you copied earlier and follow by ‘return’. This links that folder to your GitHub account.</p>
</section>
</section>
<section id="website-building" class="level1">
<h1>Website building</h1>
<section id="creation" class="level2">
<h2 class="anchored" data-anchor-id="creation">Creation</h2>
<p>Open R Studio and install Hugo via the blogdown package with the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">blogdown<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_hugo</span>()</span></code></pre></div>
</div>
<p>In R Studio create a new project in the folder that you just created ‘my_website’. To do this click on: <tt>File -&gt; New Project -&gt; Existing Directory</tt>. Then navigate to the folder ‘my_website’. This will open a new R Studio session. Creating a project just adds a .proj file in the folder that makes it easier to come back to your website later.</p>
<p>Using that new R Studio session create your website with the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">blogdown<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_site</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gcushen/hugo-academic"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme_example =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>This will:</p>
<ul>
<li>download files into your ‘my_website’ folder;</li>
<li>open a R Markdown file that you can close for now; and</li>
<li>begin serving the site in your R Studio viewer.</li>
</ul>
<p>The console and viewer of your R Studio session should look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">include_graphics</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/blogdown_serve_site.png"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://rohanalexander.com/posts/2017-07-21-getting-started-with-blogdown/images/blogdown_serve_site.png" class="img-fluid" width="1180"></p>
</div>
</div>
</section>
<section id="initial-editing" class="level2">
<h2 class="anchored" data-anchor-id="initial-editing">Initial editing</h2>
<p>At this point, the default website is being ‘served’ locally. This means that changes you make will be reflected in the website that you see in your R Studio Viewer. To see the website in a web browser click the ‘show in new window’ button on the top left of the Viewer. This is circled in the above image. That will open the website using the address that the R Studio also tells you.</p>
<section id="headshot" class="level3">
<h3 class="anchored" data-anchor-id="headshot">Headshot</h3>
<p>The first change to make is to update the headshot. In your folder, go to my_website -&gt; static -&gt; img. Replace ‘portrait.jpg’ with your own square headshot jpg. If you do this correctly then when you go back to your website the image will have updated.</p>
</section>
<section id="personal-details-contacts-and-main-menu" class="level3">
<h3 class="anchored" data-anchor-id="personal-details-contacts-and-main-menu">Personal details, contacts, and main menu</h3>
<p>To update the biography and other details in that first pane, go to <tt>File -&gt; Open File</tt> in the R Studio menu and open <tt>config.toml</tt> which is in <tt>my_website -&gt; config.toml</tt>. This file will either open in a text editor or in R Studio – it doesn’t matter which. When you save the file the changes will be reflected in the website.</p>
<p>Search for ‘title’ or go to line 2. It should say:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'title = "Academic"'</span></span></code></pre></div>
</div>
<p>Change that to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'title = "Your Name"'</span></span></code></pre></div>
</div>
<p>Search for ‘[params]’ or go to line 21. There you can update parameters such as name, role, and contact details. If you don’t want a particular parameter to show up on your website then set it equal to ““. (An example of this is on line 33.)</p>
<p>Once you’ve updated these parameters, search for ‘[[params.social]]’ or go to line 126. There you can update your contact details, such as email, twitter, etc. Just delete or comment out the full four lines if you don’t want a particular contact type displayed on your website. You can always add more later.</p>
<p>Finally, search for ‘[[menu.main]]’ or go to line 152. There you can change the menu items that are displayed on the top right of your website. For instance if you don’t want a blog then delete or comment out the four lines:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">[[menu.main]]</span>
<span id="cb9-2">  name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posts"</span></span>
<span id="cb9-3">  url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#posts"</span></span>
<span id="cb9-4">  weight <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span></code></pre></div>
</div>
<p>If you want to change the order of the items then change the ‘weight’. Ascending values from left to right.</p>
</section>
<section id="biography" class="level3">
<h3 class="anchored" data-anchor-id="biography">Biography</h3>
<p>In your folder, go to <tt>my_website -&gt; content -&gt; home -&gt; about.md</tt>. That should open in R Studio or your text editor. Any changes that you save should immediately show up in your website.</p>
<p>Search for ‘# List your academic interests.’ or go to line 12. There you can change your academic interests. If you don’t want this to show up on your website then you can just delete or comment out lines 12-18.</p>
<p>Search for ‘# List your qualifications (such as academic degrees).’ or go to line 20. There you can change your academic qualification. If you don’t want this to show up on your website then you can just delete or comment out these lines.</p>
<p>The ‘year’ is a numeric field. If you’d prefer to include duration (e.g.&nbsp;2013 – 2017), then replace the ‘2012’ with ‘“2013 – 2017”’ (the “” are important). Or similarly, if you are expecting a degree then you could replace the ‘year’ with ‘“Expected month year”’.</p>
<p>Search for ‘# Biography’ or go to line 43. There you can add a brief biography.</p>
</section>
<section id="teaching" class="level3">
<h3 class="anchored" data-anchor-id="teaching">Teaching</h3>
<p>Most of the other files in <tt>my_website -&gt; content -&gt; home</tt> just display content from elsewhere. This is because of the setup of the website. The exception is teaching.md. Open that and edit everything after line 15.</p>
</section>
<section id="publications" class="level3">
<h3 class="anchored" data-anchor-id="publications">Publications</h3>
<p>In your folder, go to <tt>my_website -&gt; content -&gt; publication</tt>. There are two default publications added there. You can edit those and then copy them to add extra publications.</p>
</section>
<section id="posts" class="level3">
<h3 class="anchored" data-anchor-id="posts">Posts</h3>
<p>If you want a blog in your website then the content is saved in: <tt>my_website -&gt; content -&gt; post</tt>. If you don’t want a blog then just delete this folder and comment out the posts menu item from <tt>my_website -&gt; config.toml</tt> file so it doesn’t show up in the menu.</p>
<p>Once your website is working, if you want a new blog post, then you can simply use the R Studio menu bar: <tt>Tools -&gt; Addins -&gt; New Post</tt>.</p>
</section>
<section id="etc" class="level3">
<h3 class="anchored" data-anchor-id="etc">Etc</h3>
<p>Go through the different parts and change it as you need.</p>
</section>
</section>
<section id="subsequent-editing" class="level2">
<h2 class="anchored" data-anchor-id="subsequent-editing">Subsequent editing</h2>
<p>To come back to editing your website once you’ve closed R Studio, go to the ‘my_website’ folder and then double-click on the Rproj file, ‘blogdown_test.Rproj’. That will open a new instance of R Studio.</p>
<p>From there you can type ‘blogdown:::serve_site()’ into the console to serve your site and then continue editing, or you could use the R Studio menu bar: <tt>Tools -&gt; Addins -&gt; Serve Site.</tt></p>
</section>
</section>
<section id="making-your-website-public" class="level1">
<h1>Making your website public</h1>
<section id="commit" class="level2">
<h2 class="anchored" data-anchor-id="commit">Commit</h2>
<p>So far everything has happened on your own computer. The first step to making your website public is to commit these changes to GitHub. To do this open Terminal again and as before use <tt>cd</tt> and <tt>ls</tt> to navigate to ‘my_website’.</p>
<p>Once there, type each of the following lines (adding your own description) and follow each by ‘return’</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">git add <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>A</span>
<span id="cb10-2">git commit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>m <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DESCRIBE THE CHANGE YOU ARE ADDING"</span></span>
<span id="cb10-3">git push</span></code></pre></div>
</div>
<p>(You may be asked for your GitHub password. Terminal is a bit tricky to type passwords into because you don’t know how many characters you’ve typed, but have a go and follow it by ‘return’.)</p>
</section>
<section id="your_domain.netlify.com" class="level2">
<h2 class="anchored" data-anchor-id="your_domain.netlify.com">your_domain.netlify.com</h2>
<p>There are many ways to make your website public, but the best at the moment is to use Netlify. I don’t have anything to change from the instructions of Alison Presmanes Hill and you can follow those here: https://apreshill.rbind.io/post/up-and-running-with-blogdown/#deploy-in-netlify.</p>


</section>
</section>

 ]]></description>
  <guid>https://rohanalexander.com/posts/2017-07-21-getting-started-with-blogdown/getting-started-with-blogdown.html</guid>
  <pubDate>Fri, 21 Jul 2017 04:00:00 GMT</pubDate>
</item>
</channel>
</rss>
