<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rohan Alexander - Experimental design for data science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Rohan Alexander</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-events" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Events</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-events">    
        <li>
    <a class="dropdown-item" href="./events-tdw.html">
 <span class="dropdown-text">Toronto Data Workshop</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./events-llms_colloquium.html">
 <span class="dropdown-text">Colloquium on Applications of LLMs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./events-reproducibility.html">
 <span class="dropdown-text">Toronto Workshop on Reproducibility</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./events-software.html">
 <span class="dropdown-text">Conference on statistical software</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teaching" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Teaching</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-teaching">    
        <li>
    <a class="dropdown-item" href="./teaching-applications_of_llms.html">
 <span class="dropdown-text">Applications of LLMs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-inf3104.html">
 <span class="dropdown-text">Data science foundations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-ethics_and_ds.html">
 <span class="dropdown-text">Ethics and data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-inf2178.html">
 <span class="dropdown-text">Experimental design for data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-history_of_statistics.html">
 <span class="dropdown-text">History of statistics and data sciences</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-sta302.html">
 <span class="dropdown-text">Methods of Data Analysis I</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-modeling.html">
 <span class="dropdown-text">Introduction to Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-nlp.html">
 <span class="dropdown-text">Natural Language Processing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-sta304.html">
 <span class="dropdown-text">Surveys, sampling, and observational data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./teaching-inf312.html">
 <span class="dropdown-text">Worlds become data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-misc" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Misc</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-misc">    
        <li>
    <a class="dropdown-item" href="./bookshelf.html">
 <span class="dropdown-text">Bookshelf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./blog.html">
 <span class="dropdown-text">Blog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./recs.html">
 <span class="dropdown-text">Recommendations</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./pdfs/cv-academic-Rohan_Alexander.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/RohanAlexander"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/RohanAlexander"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:rohan.alexander@utoronto.ca"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#how-to-succeed" id="toc-how-to-succeed" class="nav-link" data-scroll-target="#how-to-succeed">How to succeed</a></li>
  <li><a href="#how-well-work" id="toc-how-well-work" class="nav-link" data-scroll-target="#how-well-work">How we’ll work</a></li>
  <li><a href="#advice-from-past-students" id="toc-advice-from-past-students" class="nav-link" data-scroll-target="#advice-from-past-students">Advice from past students</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#past-iterations" id="toc-past-iterations" class="nav-link" data-scroll-target="#past-iterations">Past iterations</a></li>
  </ul></li>
  <li><a href="#content" id="toc-content" class="nav-link" data-scroll-target="#content">Content</a>
  <ul class="collapse">
  <li><a href="#week-1" id="toc-week-1" class="nav-link" data-scroll-target="#week-1">Week 1</a></li>
  <li><a href="#week-2" id="toc-week-2" class="nav-link" data-scroll-target="#week-2">Week 2</a></li>
  <li><a href="#week-3" id="toc-week-3" class="nav-link" data-scroll-target="#week-3">Week 3</a></li>
  <li><a href="#week-4" id="toc-week-4" class="nav-link" data-scroll-target="#week-4">Week 4</a></li>
  <li><a href="#week-5" id="toc-week-5" class="nav-link" data-scroll-target="#week-5">Week 5</a></li>
  <li><a href="#week-6" id="toc-week-6" class="nav-link" data-scroll-target="#week-6">Week 6</a></li>
  <li><a href="#week-7" id="toc-week-7" class="nav-link" data-scroll-target="#week-7">Week 7</a></li>
  <li><a href="#week-8" id="toc-week-8" class="nav-link" data-scroll-target="#week-8">Week 8</a></li>
  <li><a href="#week-9" id="toc-week-9" class="nav-link" data-scroll-target="#week-9">Week 9</a></li>
  <li><a href="#week-10" id="toc-week-10" class="nav-link" data-scroll-target="#week-10">Week 10</a></li>
  <li><a href="#week-11" id="toc-week-11" class="nav-link" data-scroll-target="#week-11">Week 11</a></li>
  <li><a href="#week-12" id="toc-week-12" class="nav-link" data-scroll-target="#week-12">Week 12</a></li>
  </ul></li>
  <li><a href="#assessment" id="toc-assessment" class="nav-link" data-scroll-target="#assessment">Assessment</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#weekly-quizzes" id="toc-weekly-quizzes" class="nav-link" data-scroll-target="#weekly-quizzes">Weekly quizzes</a></li>
  <li><a href="#professional-conduct" id="toc-professional-conduct" class="nav-link" data-scroll-target="#professional-conduct">Professional conduct</a></li>
  <li><a href="#paper-1" id="toc-paper-1" class="nav-link" data-scroll-target="#paper-1">Paper #1</a></li>
  <li><a href="#paper-2" id="toc-paper-2" class="nav-link" data-scroll-target="#paper-2">Paper #2</a></li>
  <li><a href="#paper-3" id="toc-paper-3" class="nav-link" data-scroll-target="#paper-3">Paper #3</a></li>
  <li><a href="#final-paper" id="toc-final-paper" class="nav-link" data-scroll-target="#final-paper">Final Paper</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Experimental design for data science</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="preamble" class="level2">
<h2 class="anchored" data-anchor-id="preamble">Preamble</h2>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>INF2178 is a masters-level course at the University of Toronto’s Faculty of Information.</p>
<p>Experimental design has a long and robust tradition within traditional applications such as agriculture, medicine, physics, and chemistry. It allows us to speak of causality with confidence. Typically, these are situations in which control groups can be established, randomization is appropriate, and ethical concerns can be assuaged. Unfortunately, such a set-up is rarely possible in the full extent of the modern applications where we want to understand causality.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://imgs.xkcd.com/comics/statistics.png" class="img-fluid figure-img" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
<p>Source: https://xkcd.com/2400/</p>
<p>This course covers the traditional approaches and statistical methods, but focuses on what to do when traditional experimental design methods cannot be implemented or are not appropriate (i.e.&nbsp;what feels like most of the time these days). We cover experiments in their modern guise especially the concerns that we might have when we can run them; but also methods that can provide some causal understanding even when we cannot conduct traditional experiments. Importantly, these approaches do not rely on ‘big data’ or fancy statistics, but instead on thoroughly interrogating the data that are available to get understanding through as simple means as possible.</p>
<p>This is a hands-on course in which you will conduct research projects using real-world data. This means that you will: obtain and clean relevant datasets; develop your own research questions; use the statistical techniques that you are introduced to in class to answer those questions; and finally communicate your results in a meaningful way. This course is designed around approaches that are used extensively in academia, government, and industry. Furthermore, it includes many aspects, such as data cleaning and preparation, that are critical, but rarely taught.</p>
<p>This course is different to many other courses at the University of Toronto. At the end of this course, you will have a portfolio of work that you could show off to a potential employer. You will have developed the skills to work successfully as an applied statistician or data scientist. And you will know how to fill gaps in your knowledge yourself. A lot of scholarships and jobs these days ask for GitHub and blog links etc to show off a portfolio of your work. This is the class that gives you a chance to develop these. It’s very important to having something that shows off what you can do, and that needs to go beyond what is done in a normal class.</p>
<!-- The syllabus is available [here](pdfs/2021-01-11-INF2178-syllabus.pdf). -->
</section>
<section id="how-to-succeed" class="level3">
<h3 class="anchored" data-anchor-id="how-to-succeed">How to succeed</h3>
<p>In this course you will work in a self-directed, open-ended manner. Identify relevant areas of interest and then learn the skills that you need to explore those areas.</p>
<p>To successfully complete this course, you should expect to spend a large portion of your time reading and writing (both code and text). Deeply engage with the materials. Find a small study group and keep each other motivated and focused. At the start of the week, read the course notes, all compulsory materials and some recommended materials based on your interest. After doing that, but before the ‘lecture’ time you should complete the weekly quiz. During ‘lectures’ I’ll live-code, discuss materials in the course notes, talk about an experiment, and you’ll have a chance to discuss the materials with me.</p>
<p>You need to be more active in your learning in this course than others - read the notes and related materials - and then go out there and teach yourself more and apply it. You will not be spoon-fed in this course. Each week try to write reproducible, understandable, R code surrounded by beautifully crafted text that motivates, backgrounds, explains, discusses and criticizes. Make steady progress toward the assessment.</p>
<p>This is not a ‘bird course’. Typically, after the term is finished, students say that the course is difficult but rewarding. The TAs and I are always available to answer any questions. Please come to office hours!</p>
</section>
<section id="how-well-work" class="level3">
<h3 class="anchored" data-anchor-id="how-well-work">How we’ll work</h3>
<p>This webpage will provide almost all the guiding materials that you need and links to the relevant parts of the notes. The course notes are available here: https://www.tellingstorieswithdata.com. Those contain notes and other material that you could go over. There is a course Slack for discussion. We’ll use Quercus really only for assessment submission and grading. I expect you to work professionally, and so we’ll try to use professional tools to the extent possible.</p>
<p>A rough weekly flow for the course would be something like:</p>
<ol type="1">
<li>Read the week’s course notes.</li>
<li>Read/watch/listen to the compulsory materials.</li>
<li>Complete the weekly quiz.</li>
<li>Attend the lecture.</li>
<li>Attend the lab.</li>
<li>Make progress on a paper.</li>
</ol>
</section>
<section id="advice-from-past-students" class="level3">
<h3 class="anchored" data-anchor-id="advice-from-past-students">Advice from past students</h3>
<p>Successful past students have the following advice (completely unedited by me):</p>
<ul>
<li>‘Read the rubrics and treat INF2178 as a storytelling with data course rather than INF1344 part 2. Let the point distribution rubric guide what parts of the paper to focus on/expand. And pay attention to the “telling stories” part of the site URL. The point of the papers isn’t to chuck every statistical method and cool R trick you know in there, it’s to practice building data-driven arguments that different audiences might actually care about. Last, the piece of advice I wish I had followed for the class: keep a log of things that you find confusing/cool/useful.’</li>
<li>‘Allocate as much time as you realistically can to projects. It all takes longer than expected (particularly debugging) so be a friend to your future self and don’t leave work to the last minute. Really.’</li>
<li>‘Read the paper rubrics very carefully! The papers will always take longer than you think they will so try to start early and put enough time before submitting to make sure you sort out any issues with formatting and knitting your pdf because there will almost always be issues (especially if you’re doing it for the first time). Write the papers with an external audience in mind, not just as a school paper that only Rohan will read. Consider the papers to be personal projects that your peers and potential employers will be reading, and try to write something you feel could be published. Also, comment your code and thank yourself later :)’</li>
<li>‘Do the readings even though there are a lot and don’t be afraid to ask questions no matter how stupid you think they are (unless the answer can easily be found, ie “is assignment 1 group or solo”). Also, Rohan is not as intimidating as he initially seems. Also, if you did poorly on assignment 1, don’t drop the class. There’s still so much to learn and the chance of making it up with the other two assignments.’</li>
<li>‘You’re going to have to practice solving your own code problems, reviewing and keeping track of detailed assignment requirements, critical thinking about data, and editing your own work. It will take more time than you think.’’</li>
<li>‘1) Try to keep up week to week as best as possible; watching the lectures is more rewarding that way because you have some understanding, especially if you watch asynchronously and can’t just ask the professor questions. Sometimes that means even skimming what readings you can if time is tight, otherwise you may feel quite lost. 2) R documentation is your best friend when you don’t wholly understand the examples in the course notes, or you’re looking for other viable solutions. Stack Overflow is also a great help, but don’t forget to cite everything you’ve taken from there so you remember where it came from when wondering, “How does this even work? It works, but how?” 3) Sometimes, your code will infuriate you. Take breaks. Step away for a half hour, do something else entirely for a while, or even come back tomorrow. Don’t beat yourself up too much over it. You can also ask for assistance in the course Slack, because odds are someone else has already encountered this issue and arrived at a solution. 4) Trust Rohan and his process. It’s going to rely on your efforts to learn on your own -and it’s going to feel like a harsh bootcamp- but you’ll learn to make friends with data and coding. 5) Practice the examples on your own before class. 6) Don’t be afraid or intimidated by other’s who seem to know more than you. 7) Attend Toronto Data Workshop whenever you can. 8) Form a study group early on’</li>
<li>‘Don’t stop at just the assignment prompt. Have fun with your topic and see how you can take it further’</li>
</ul>
</section>
<section id="acknowledgements" class="level3">
<h3 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h3>
<p>Thanks to the following who helped develop this course: Monica Alexander, Kelly Lyons, Sharla Gelfand, Faria Khandaker, Hidaya Ismail, A Mahfouz, Paul Hodgetts, Thomas Rosenthal.</p>
</section>
<section id="past-iterations" class="level3">
<h3 class="anchored" data-anchor-id="past-iterations">Past iterations</h3>
<ul>
<li>2020
<ul>
<li><a href="pdfs/inf2178-2020-evals.pdf">Student evals</a></li>
</ul></li>
<li>2021
<ul>
<li><a href="pdfs/inf2178-2021-syllabus.pdf">Syllabus</a></li>
<li><a href="pdfs/inf2178-2021-evals.pdf">Student evals</a></li>
</ul></li>
</ul>
</section>
</section>
<section id="content" class="level2">
<h2 class="anchored" data-anchor-id="content">Content</h2>
<p>Each week you should go through the course notes and all compulsory materials. During the lecture I will live-code various aspects. I will also discuss a case study, typically a paper. During the lab, a TA will either lead small group discussions or similarly lead other work. The lecture will be recorded and posted here, but again, it’s not enough to just watch that - you need to read and write yourself.</p>
<section id="week-1" class="level3">
<h3 class="anchored" data-anchor-id="week-1">Week 1</h3>
<p>‘Drinking from a fire hose’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/drinking-from-a-fire-hose.html">Drinking from a fire hose</a>, <a href="https://www.tellingstorieswithdata.com/r-essentials.html">R Essentials</a>.</li>
<li>Case Study: <a href="https://www.tellingstorieswithdata.com/hunting-data.html#case-study---fishers-tea-party">Fisher’s Lady Tasting Tea</a>.</li>
<li>Lab: Go through first four modules of DoSS Toolkit and discuss any issues with the TA.</li>
</ul>
</section>
<section id="week-2" class="level3">
<h3 class="anchored" data-anchor-id="week-2">Week 2</h3>
<p>‘Science-ing’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/workflow.html">Workflow</a>, <a href="https://www.tellingstorieswithdata.com/static-communication.html">Static communication</a>.</li>
<li>Case Study: <a href="https://www.tellingstorieswithdata.com/hunting-data.html#case-study---tuskegee-syphilis-study">Tuskegee Syphilis Study</a>.</li>
<li>Lab: Go through modules five to eight of DoSS Toolkit and discuss any issues with the TA.</li>
</ul>
</section>
<section id="week-3" class="level3">
<h3 class="anchored" data-anchor-id="week-3">Week 3</h3>
<p>‘Why, if ever I did fall off—which there’s no chance of—but if I did–’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/hunting-data.html#experiments-and-randomised-controlled-trials">Experiments, and treatment effects</a>.</li>
<li>Case Study: <a href="https://www.tellingstorieswithdata.com/hunting-data.html#case-study---the-oregon-health-insurance-experiment">The Oregon Health Insurance Experiment in the United States</a>.</li>
<li>Special guest: <a href="https://youtu.be/qYh6Nzv3RWs">Greg Wilson on how to run a meeting</a>.</li>
<li>Lab:
<ul>
<li>Please pretend that you work as a junior analyst for a large consulting firm. Further, pretend that your consulting firm has taken a contract to put together a facial recognition model for the Canada Border Services Agency’s Inland Enforcement branch. Write five or six points with regard to your thoughts on this matter. What would you do and why? Then split into small groups and compare your points with others. Do you think the model would end up being implemented?</li>
<li>With the help of the TA, please conduct ‘face-to-face’ surveys (via Zoom). For this exercise, you will be randomly split into groups of two. You have two minutes in each group and will then be swapped to another group. One person is to survey the other person asking the following questions: i) ‘What is your gender?’, ii) ‘What is your age?’, iii) ‘What is your marital status?’, iv) ‘What is your income?’, v) ‘If an election were held today who would you vote for?’. After one person is done, then switch roles. When you are the questioner you should record all responses using a small CSV (but not the person’s name please). When you are the respondent you are welcome to not respond. You will cycle through this multiple times. At the end, please write a small reflection about: 1) as a respondent, how you felt answering these questions and the implications that you think this feeling may have for how survey questions are answered more generally; and 2) as a questioner, how difficult it was to code responses and the implications this may have for the dataset that we analyse.</li>
</ul></li>
</ul>
</section>
<section id="week-4" class="level3">
<h3 class="anchored" data-anchor-id="week-4">Week 4</h3>
<p>‘Gathering data’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/gather-data.html">Gathering data</a>.</li>
<li>Case Study: <a href="https://www.tellingstorieswithdata.com/hunt-data.html#case-study---student-coaching-how-far-can-technology-go">Student Coaching: How Far Can Technology Go?</a></li>
<li>Lab:
<ul>
<li>Please pretend you work for Netflix and you want to know more about why people subscribe (or don’t!) when prices change. Please design an experiment, discuss its key features and how you would implement it. Please pay special attention to sampling issues. Then simulate an outcome.</li>
<li>Following the guidance of the TA, please scrape some data and discuss some ethical considerations around the dataset that you created. You may like to write a short blog post discussing the difference between data being public but scattered, and a consolidated dataset being public with reference to Kirkegaard and Bjerrekær, 2016, and Politou, Alepis, and Patsakis, 2018 (if you do that please do email a link to me out of interest).</li>
</ul></li>
</ul>
</section>
<section id="week-5" class="level3">
<h3 class="anchored" data-anchor-id="week-5">Week 5</h3>
<p>‘Whoops, I forgot EDA’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/exploratory-data-analysis.html">Exploratory Data Analysis</a>.</li>
<li>Case Study: <a href="https://www.tellingstorieswithdata.com/hunt-data.html#case-study---civic-honesty-around-the-globe">Civic honesty around the globe</a></li>
<li>Lab:
<ul>
<li>Pretend that you work for Loblaws as a data scientist and it is late March 2020. As part of normal monitoring, you have noticed that purchases of flour and pasta have increased substantially. You had been planning to increase the price of these items in April as part of a trial, but now your manager is not sure whether it is appropriate to conduct the trial. Please write five or six points with regard to your thoughts on this matter. What would you do and why?</li>
<li>Analyse the Toronto AirBNB dataset with guidance from the TA.</li>
</ul></li>
</ul>
</section>
<section id="week-6" class="level3">
<h3 class="anchored" data-anchor-id="week-6">Week 6</h3>
<p>‘IJALM - It’s Just A Linear Model’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/its-just-a-linear-model.html">Linear and logistic regression and <code>tidymodels</code></a></li>
<li>Case Study: <a href="https://www.tellingstorieswithdata.com/hunt-data.html#case-study---upworthy">Upworthy A/B tests of headlines</a>.</li>
<li>Special guest: <a href="https://youtu.be/UYzXElJTovg">Kathy Ge on experiments at Uber</a>.</li>
<li>Lab recording:
<ul>
<li>Following the guidance of the TA, please use Blogdown to create a simple website and then design and execute a simple A/B test for your website using Netlify.</li>
</ul></li>
</ul>
</section>
<section id="week-7" class="level3">
<h3 class="anchored" data-anchor-id="week-7">Week 7</h3>
<p>‘Celestial Navigation’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/r-essentials.html#simulating-data">Simulation</a>, <a href="https://www.tellingstorieswithdata.com/its-just-a-linear-model.html#on-p-values">power</a>, <a href="https://www.tellingstorieswithdata.com/hunt-data.html#experiments-and-randomised-controlled-trials">RCTs</a>, <a href="https://www.tellingstorieswithdata.com/hunt-data.html#ab-testing">A/B testing</a>.</li>
<li>Case Study: Please pick one chapter from Catherine D’Ignazio and Lauren F. Klein, <em>Data Feminism</em>, that is of interest to you and read it (freely available: https://data-feminism.mitpress.mit.edu).</li>
<li>Lab:
<ul>
<li>Following the guidance of the TA, please make a Shiny app that bundles a little data and some code and post it to shinyapps.com.</li>
</ul></li>
</ul>
</section>
<section id="week-8" class="level3">
<h3 class="anchored" data-anchor-id="week-8">Week 8</h3>
<p>‘Such a shame they’ll never meet’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/causality-from-observational-data.html#difference-in-differences">Matching and difference in differences</a>.</li>
<li>Case Study: <a href="https://www.tellingstorieswithdata.com/causality-from-observational-data.html#case-study---funding-of-clinical-trials-and-reported-drug-efficacy">Funding of Clinical Trials and Reported Drug Efficacy</a></li>
<li>Special guest: <a href="https://youtu.be/VP3BBZ7poc0">Emily Riederer on observational causal inference</a>.</li>
<li>Special guest: <a href="https://youtu.be/DdnpWS9Km5U">Tamar Oostrom on funding of clinical trials</a>.</li>
<li>Lab:
<ul>
<li>Following the guidance of the TA, please look at McClelland, Alexander, 2019, ‘“Lock This Whore Up”: Legal Violence and Flows of Information Precipitating Personal Violence against People Criminalised for HIV-Related Crimes in Canada’, <em>European Journal of Risk Regulation</em>, 10 (1), pp.&nbsp;132-147.</li>
<li>Then look at Policing the Pandemic - https://www.policingthepandemic.ca/. Look into how they gathered their dataset and what it took to put this together. What is in the dataset and why? What is missing and why? How could this affect the results? How might similar biases enter into other datasets that you have used or read about?</li>
<li>Put together a brief model. You may like to write a short blog post about the biases and influences that are in this dataset (if you do that please do email a link to me out of interest).</li>
</ul></li>
</ul>
</section>
<section id="week-9" class="level3">
<h3 class="anchored" data-anchor-id="week-9">Week 9</h3>
<p>‘Why does it always rain on me?’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/causality-from-observational-data.html#regression-discontinuity-design">Regression discontinuity</a> and <a href="https://www.tellingstorieswithdata.com/causality-from-observational-data.html#instrumental-variables">instrumental variables</a>.</li>
<li>Case Study:
<ul>
<li>James H. Ware, 1989, ‘Investigating Therapies of Potentially Great Benefit: ECMO’, <em>Statistical Science</em>, available <a href="https://projecteuclid.org/journals/statistical-science/volume-4/issue-4/Investigating-Therapies-of-Potentially-Great-Benefit-ECMO/10.1214/ss/1177012384.full">here</a>.</li>
<li>Donald A. Berry, 1989, ‘Comment: Ethics and ECMO’, <em>Statistical Science</em>, available <a href="https://projecteuclid.org/journals/statistical-science/volume-4/issue-4/Investigating-Therapies-of-Potentially-Great-Benefit--ECMO--Comment/10.1214/ss/1177012385.full">here</a>.</li>
</ul></li>
<li>Lab:
<ul>
<li>Following the guidance of the TA, please make an R package that bundles a little data and some code and add it to your GitHub. Don’t forget to include at least one test.</li>
</ul></li>
</ul>
</section>
<section id="week-10" class="level3">
<h3 class="anchored" data-anchor-id="week-10">Week 10</h3>
<p>‘Post Hoc, Ergo Propter Hoc’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/causality-from-observational-data.html#dags-and-trying-not-to-be-tricked-by-the-data">DAGs, bias, and paradoxes</a>.</li>
<li>Case Study: Joshua Kalla and David Broockman, 2016, ‘Campaign Contributions Facilitate Access to Congressional Officials: A Randomized Field Experiment’</li>
<li>Lab:
<ul>
<li>Following the guidance of the TA, please look back on the case studies that we’ve covered so far. Please break up into small groups and create DAGs for each. Then write some notes about the potential for confounding, selection bias and measurement bias. Pick one person in your group to make a brief 2-minute presentation about what you did.</li>
</ul></li>
</ul>
</section>
<section id="week-11" class="level3">
<h3 class="anchored" data-anchor-id="week-11">Week 11</h3>
<p>‘But it works on my machine’.</p>
<ul>
<li>Content: Shiny, <a href="https://www.tellingstorieswithdata.com/cloud.html">cloud</a>, and <a href="https://www.tellingstorieswithdata.com/deploy.html">deploying</a>.</li>
<li>Case Study: Alexander, M., Wildeman, C., Roehrkasse, A., and Rudlang-Perman, K., 2020, ‘Forecasting child welfare outcomes in the United States’, <a href="https://monica-alexander.shinyapps.io/foster_care/">Shiny app</a>; <a href="https://www.monicaalexander.com/pdf/fc.pdf">Technical model summary</a>.</li>
<li>Lab:
<ul>
<li>Following the guidance of the TA, and thinking about what we covered in lectures, please read, compare, and discuss:
<ul>
<li>Bendavid, E., Mulaney, B., Sood, N., Shah, S., Ling, E., Bromley-Dulfano, R., …, and Tversky, D, 2020, ‘COVID-19 Antibody Seroprevalence in Santa Clara County, California’, <em>MedRxiv</em>, https://www.medrxiv.org/content/10.1101/2020.04.14.20062463v1.full.pdf.</li>
<li>Gelman, Andrew, 2020, ‘Concerns with that Stanford study of coronavirus prevalence’, Statistical Modeling, Causal Inference, and Social Science, 19 April, https://statmodeling.stat.columbia.edu/2020/04/19/fatal-flaws-in-stanford-study-of-coronavirus-prevalence/.</li>
<li>Eisen, Michael B., and Robert Tibshirani, 2020, ‘How to Identify Flawed Research Before It Becomes Dangerous’, <em>New York Times</em>, 20 July, https://www.nytimes.com/2020/07/20/opinion/coronavirus-preprints.html.</li>
<li>Gelman, Andrew and Bob Carpenter, 2020, ‘Bayesian analysis of tests with unknown specificity and sensitivity’, 8 July, http://www.stat.columbia.edu/~gelman/research/published/specificity.pdf.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="week-12" class="level3">
<h3 class="anchored" data-anchor-id="week-12">Week 12</h3>
<p>‘Lorem ipsum’.</p>
<ul>
<li>Content: <a href="https://www.tellingstorieswithdata.com/text-as-data.html">Text-as-data</a>.</li>
<li>Case Study: Kevin Munger, Patrick Egan, Jonathan Nagler, Jonathan Ronen, and Joshua A. Tucker, 2017, ‘Political Knowledge and Misinformation in the Era of Social Media: Evidence From the 2015 UK Election’.</li>
<li>Lab:
<ul>
<li>Please form small groups and discuss, ‘to what extent do quantitative methods merely project forward the past, and what implications does this have for our conduct as practitioners and consumers?’</li>
</ul></li>
</ul>
</section>
</section>
<section id="assessment" class="level2">
<h2 class="anchored" data-anchor-id="assessment">Assessment</h2>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<table class="table">
<colgroup>
<col style="width: 39%">
<col style="width: 42%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Item</th>
<th style="text-align: right;">Weight (%)</th>
<th style="text-align: right;">Due date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Weekly quiz</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">Weekly before the lecture</td>
</tr>
<tr class="even">
<td>Professional conduct</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">Anytime during the teaching term</td>
</tr>
<tr class="odd">
<td>Paper 1</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">End of Week 3</td>
</tr>
<tr class="even">
<td>Paper 2</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">End of Week 6</td>
</tr>
<tr class="odd">
<td>Paper 3</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">End of Week 9</td>
</tr>
<tr class="even">
<td>Final Paper (initial submission)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">End of Week 12</td>
</tr>
<tr class="odd">
<td>Final Paper (peer review)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">Three days after that</td>
</tr>
<tr class="even">
<td>Final Paper</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">Ten days after that</td>
</tr>
</tbody>
</table>
</section>
<section id="weekly-quizzes" class="level3">
<h3 class="anchored" data-anchor-id="weekly-quizzes">Weekly quizzes</h3>
<ul>
<li>Due date: Weekly before the lecture.</li>
<li>Weight: 20 per cent (no quiz in Week 1 or Week 12 and only best eight out of ten count.)</li>
<li>Task: Please complete a weekly quiz in Quercus.</li>
<li>Questions: The questions that form the quiz are drawn from those in the course notes.</li>
</ul>
</section>
<section id="professional-conduct" class="level3">
<h3 class="anchored" data-anchor-id="professional-conduct">Professional conduct</h3>
<ul>
<li>Due date: Anytime during the teaching term.</li>
<li>Weight: 1 per cent</li>
<li>Task: We (optionally) use Slack to interact in this class. At some point during the teaching term, please use Slack to answer another student’s question or otherwise similarly be generally helpful in a professional manner. When you do that, please share the comment into the ‘Professional conduct’ channel and @ me (hover on the message, click share message, type in the channel ‘profession_conduct’, add a message that @‘s me, and click ’share’). You’ll get the full mark just for one helpful interaction. (If you are opting out of using Slack - which is entirely fine - then instead, at some point in the term send me an email with a link that is relevant to the course materials and that I should add to the course notes. Please be clear that this is your ‘professional conduct’ submission by stating that in the subject line.)</li>
</ul>
</section>
<section id="paper-1" class="level3">
<h3 class="anchored" data-anchor-id="paper-1">Paper #1</h3>
<ul>
<li>Due date: End of Week 3.</li>
<li>Weight: 25 per cent (for Papers #1-#3 the best two of three count).</li>
<li>Task: <a href="https://www.tellingstorieswithdata.com/papers.html#mandatory-minimums">‘Mandatory minimums’</a></li>
</ul>
</section>
<section id="paper-2" class="level3">
<h3 class="anchored" data-anchor-id="paper-2">Paper #2</h3>
<ul>
<li>Due date: End of Week 6.</li>
<li>Weight: 25 per cent (for Papers #1-#3 the best two of three counts).</li>
<li>Task: <a href="https://www.tellingstorieswithdata.com/papers.html#these-numbers-mean-dial-it-up">‘These numbers mean dial it up’</a></li>
</ul>
</section>
<section id="paper-3" class="level3">
<h3 class="anchored" data-anchor-id="paper-3">Paper #3</h3>
<ul>
<li>Due date: End of Week 9.</li>
<li>Weight: 25 per cent (for Papers #1-#3 the best two of three counts).</li>
<li>Task: <a href="https://www.tellingstorieswithdata.com/papers.html#the-short-list">‘The Short List’</a>.</li>
</ul>
</section>
<section id="final-paper" class="level3">
<h3 class="anchored" data-anchor-id="final-paper">Final Paper</h3>
<ul>
<li>Due dates:
<ul>
<li>Initial submission: End of Week 12.</li>
<li>Peer review: Three days after that.</li>
<li>Final Paper: Ten days after that.</li>
</ul></li>
<li>Weight: 29 per cent (4 per cent of this is for initial submission and peer review conducted a week before).
<ul>
<li>Initial submission: 1 per cent</li>
<li>Peer review: 3 per cent</li>
<li>Final Paper: 25 per cent</li>
</ul></li>
<li>Task: <a href="https://www.tellingstorieswithdata.com/papers.html#two-cathedrals">‘Two Cathedrals’</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rohanalexander\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>